import{d as M,r as T,x as $,w as F,j as _,o as p,F as L,k,t as B,O,L as R,m as i,y as f,_ as P,S as W,i as x,c as z,D as E,B as N}from"./Pd6RrLp1.js";import{u as Z}from"./UMgXyzVE.js";import{u as G}from"./B64m7KbU.js";import{u as H}from"./CiYsyl20.js";import{s as A}from"./km7Iw1uL.js";const J=["autofocus","value","onKeyup"],Q={key:0,class:"ui-otp_errors"},X=M({__name:"UiOtp",props:{modelValue:{},errors:{},change:{type:Function},submit:{type:Function}},emits:["change","submit","update:modelValue"],setup(c,{emit:h}){const e=c,l=h,g=T(null),v=$(()=>e.modelValue?[e.modelValue[0]||"",e.modelValue[1]||"",e.modelValue[2]||"",e.modelValue[3]||""]:["","","",""]);function C(r,t){var u,d,m,V;const o=r.target.value;v.value[t]=o;const a=v.value.join("");if(l("update:modelValue",a),l("change",r),r.key==="Backspace"){t>0&&((d=(u=g.value)==null?void 0:u.querySelector(`input:nth-child(${t})`))==null||d.focus());return}r.key!=="Delete"&&t<v.value.length&&((V=(m=g.value)==null?void 0:m.querySelector(`input:nth-child(${t+2})`))==null||V.focus())}function w(r){var o;const t=((o=r.clipboardData)==null?void 0:o.getData("text"))||"";l("update:modelValue",t.substring(0,4)),l("change",r)}return F(()=>e.modelValue,()=>{e.modelValue.length>=4&&l("submit")}),(r,t)=>{var o,a;return p(),_(L,null,[k("label",{ref_key:"inputsWrapper",ref:g,class:O(["ui-otp",{error:(o=r.errors)==null?void 0:o.length}])},[(p(!0),_(L,null,R(i(v),(u,d)=>(p(),_("input",{key:d,autofocus:d===0,class:"ui-otp_input",type:"text",value:u,placeholder:" ",onPaste:w,onKeyup:m=>C(m,d)},null,40,J))),128))],2),(a=r.errors)!=null&&a.length?(p(),_("div",Q,[(p(!0),_(L,null,R(r.errors,u=>(p(),_("span",{key:u},f(u),1))),128))])):B("",!0)],64)}}}),Y=P(X,[["__scopeId","data-v-e17b4836"]]),ee="data:image/svg+xml,%3csvg%20width='21'%20height='20'%20viewBox='0%200%2021%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10.4993%2018.3327C15.1017%2018.3327%2018.8327%2014.6017%2018.8327%209.99935C18.8327%205.39698%2015.1017%201.66602%2010.4993%201.66602C5.89698%201.66602%202.16602%205.39698%202.16602%209.99935C2.16602%2014.6017%205.89698%2018.3327%2010.4993%2018.3327Z'%20stroke='%23121212'%20stroke-opacity='0.74902'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M13%2013.3333L10.9883%2011.3217C10.6758%2011.0092%2010.5001%2010.5853%2010.5%2010.1433V5'%20stroke='%23121212'%20stroke-opacity='0.74902'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3c/svg%3e",y=W({resendSms:[]}),te=()=>{const c=T(60);let h=null;const e=t=>{h=A(()=>{t.timer===0?clearInterval(h):t.timer--},1e3)},l=t=>$(()=>y.resendSms.find(o=>o.phoneNumber===t)??0),g=t=>{clearInterval(h),y.resendSms=y.resendSms.filter(o=>o.phoneNumber!==t)},v=(t,o=c.value)=>{const a=y.resendSms.find(u=>u.phoneNumber===t);if(a===void 0){y.resendSms.push({phoneNumber:t,timer:o});const u=y.resendSms.find(d=>d.phoneNumber===t);e(u)}else a.timer===0&&(a.timer=o,e(a))},C=t=>{var o;return((o=l(t).value)==null?void 0:o.timer)===0},w=(t=c.value)=>(c.value=t,new Promise(o=>{const a=A(()=>{c.value===0?(clearInterval(a),o(!0)):c.value-=1},1e3)})),r=$(()=>c.value);return{resetResendCodeTimer:g,setResendCodeTimer:v,getResendCodeTimer:l,startLocalTimer:w,canResendCode:C,getLocalTimer:r}},ne={class:"enter-code"},oe={class:"enter-code_title"},se={class:"enter-code_text"},re={class:"enter-code_code-wrapper"},ae={key:0,class:"enter-code_code-description enter-code_timer"},le={key:1,class:"enter-code_code-description enter-code_repeat-code"},ue={__name:"enter-code-content",props:{loginValue:{type:String,required:!0},code:{type:String,default:""},deleteAccountType:{type:Boolean,default:!1}},emits:["change","success"],setup(c,{emit:h}){const e=c,l=h,{getUser:g}=Z(),{signIn:v,sendCode:C,deleteAccount:w}=G(),{isLoading:r,startLoading:t,stopLoading:o}=H(),{setResendCodeTimer:a,resetResendCodeTimer:u,getResendCodeTimer:d}=te(),m=T(e.code),V=T([]),I=T(0),U=$(()=>!e.loginValue&&!g.value?"":e.loginValue||g.value.email||g.value.phone),b=$(()=>{var s;return(s=d(e.loginValue).value)==null?void 0:s.timer}),j=async()=>{var s;if(V.value=[],!r.value){t();try{let n;e.deleteAccountType?n=await w(e.code):n=await v({verification_code:e.code,login:e.loginValue}),(n==null?void 0:n.status)==="success"||((s=n==null?void 0:n.status)==null?void 0:s.value)==="success"?l("success"):(l("change",""),I.value+=1,V.value=n,m.value="",u(e.loginValue))}catch(n){console.error(n)}finally{o()}}},D=async()=>{var n;t();const s=await C(e.loginValue);((n=s==null?void 0:s.status)==null?void 0:n.value)==="success"&&(l("change",""),I.value+=1,V.value=[],a(e.loginValue)),o()},q=s=>{l("change",s)};return F(()=>e.loginValue,()=>{a(e.loginValue)}),x(()=>{e.loginValue&&a(e.loginValue)}),(s,n)=>{const K=Y;return p(),_("div",ne,[k("p",oe,f(s.$t("enter_the_code")),1),k("p",se,f(s.$t("enter_the_code_sent_to"))+" "+f(i(U)),1),k("div",re,[(p(),z(K,{key:i(I),modelValue:i(m),"onUpdate:modelValue":[n[0]||(n[0]=S=>E(m)?m.value=S:null),n[1]||(n[1]=S=>s.$emit("change",i(m)))],errors:i(V),onChange:n[2]||(n[2]=S=>q(S)),onSubmit:n[3]||(n[3]=S=>j())},null,8,["modelValue","errors"]))]),i(b)?(p(),_("p",ae,[n[4]||(n[4]=k("img",{src:ee},null,-1)),N(" "+f(s.$t("resending_after"))+" 00:"+f(i(b)<10?`0${i(b)}`:i(b)),1)])):B("",!0),i(b)?B("",!0):(p(),_("div",le,[N(f(s.$t("did_not_get_a_code"))+"? ",1),k("button",{class:"enter-code_resend",onClick:D},f(s.$t("send_again")),1)]))])}}},ge=P(ue,[["__scopeId","data-v-c4578167"]]);export{ge as _};
