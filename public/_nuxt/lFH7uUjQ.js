import{_ as de,I as $e}from"./qKLLgZOX.js";import{_ as Pe}from"./Bh9jfPsV.js";import{_ as De}from"./QJ3VVsaT.js";import{_ as Oe}from"./BZsyuj-b.js";import{u as Ie}from"./Defl8kng.js";import{u as we}from"./CMtmRunp.js";import{_ as se,b as me,j as v,o as m,k as h,c as Y,t as O,m as a,y as $,l as R,O as W,h as Te,r as te,x as A,a3 as Be,B as q,F as V,L as oe,d as Ae,ak as Me,Q as Ce,aa as ue,ad as je,Y as Ue,U as qe,H as Ne,T as Fe,w as ee,q as Re,i as Le,N as ke,z as ne,D as ie,S as he,g as xe,A as Ee,R as Ve,ah as ze}from"./Pd6RrLp1.js";import{u as Ze}from"./BSts32E-.js";import{f as Je}from"./DV533Gpo.js";import{u as ye,_ as We,a as be}from"./BoW1LxkV.js";import{_ as Ye}from"./C3QHuKV1.js";import{C as He}from"./BslN7nPp.js";import{_ as Qe}from"./1OVHT2GX.js";import{u as Ke}from"./CasWryfL.js";import{_ as Xe}from"./2WVDaFKk.js";const Ge={class:"checkout-product_info"},et={class:"checkout-product_image-container"},tt={class:"checkout-product_quantity"},at={class:"checkout-product_name"},nt={key:0,class:"checkout-product_date"},ot={key:0},rt={key:1},st={class:"checkout-product_price-container"},ct={class:"checkout-product_price"},lt={__name:"checkout-product",props:{product:{type:Object,default:()=>{}},currency:{type:String,default:""}},setup(e){const c=e,{formatToDayAndMonth:s}=Ie(),{totalPrice:o,totalPriceDiscountValue:u,priceCat4:r}=we(c.product),{locale:n}=me();return(p,S)=>{var j,U,B,P,_,d,k,N,Z,K,g,b,J,t;const I=De,w=Oe;return m(),v("div",{class:W(["checkout-product",{"checkout-product__out-of-stock":!e.product.available_quantity}])},[h("div",Ge,[h("div",et,[(j=e.product)!=null&&j.photo_url?(m(),Y(I,{key:0,src:(U=e.product)==null?void 0:U.photo_url,alt:((P=(B=e.product)==null?void 0:B.name)==null?void 0:P[a(n)])||((d=(_=e.product)==null?void 0:_.name)==null?void 0:d.en),class:"checkout-product_image"},null,8,["src","alt"])):O("",!0),h("span",tt,$((k=e.product)==null?void 0:k.ordered_quantity),1)]),h("div",null,[h("p",at,$(((Z=(N=e.product)==null?void 0:N.name)==null?void 0:Z[a(n)])||((g=(K=e.product)==null?void 0:K.name)==null?void 0:g.en)),1),(b=e.product)!=null&&b.is_npi_state?(m(),v("p",nt,[(J=e.product)!=null&&J.preorder_date?(m(),v("span",ot,$(p.$t("preorder"))+" "+$(a(s)(e.product.preorder_date))+". ",1)):O("",!0),(t=e.product)!=null&&t.delivery_date?(m(),v("span",rt,$(p.$t("availible"))+" "+$(a(s)(e.product.delivery_date))+". ",1)):O("",!0)])):O("",!0)])]),h("div",st,[h("div",ct,[R(w,{currency:e.currency,"total-price":a(o),"total-price-discount":a(u),cat4:a(r)},null,8,["currency","total-price","total-price-discount","cat4"])])])],2)}}},it=se(lt,[["__scopeId","data-v-3dba85d7"]]),ut={key:0,class:"checkout-products_title"},dt={class:"checkout-products_button"},mt={class:"checkout-products_button-text"},pt={key:1,class:"checkout-products_header-price"},_t={class:"checkout-products_prices-text"},ht={class:"checkout-products_prices-value"},ft={class:"checkout-products_prices-text"},yt={class:"checkout-products_prices-value"},gt={key:0,class:"checkout-products_prices-text"},vt={class:"checkout-products_prices-value"},kt={class:"checkout-products_prices-text"},bt={key:0,class:"checkout-products_prices-value"},$t={key:1,class:"checkout-products_prices-value"},Ct={key:1},St={key:0,class:"checkout-products_prices-text checkout-products_price-total"},Pt={class:"checkout-products_prices-value"},Dt={key:1,class:"checkout-products_trade-in-hint"},Ot={__name:"checkout-products",props:{order:{type:Object,default:()=>{}},isOrderSummaryTop:{type:Boolean,default:!1},isOpenContent:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!1},showTotal:{type:Boolean,default:!0},maxWidth:{type:Boolean,default:!1},noMarginBottom:{type:Boolean,default:!1},isRepeatPayment:{type:Boolean,default:!1},isTradeIn:{type:Boolean,default:!1}},setup(e){const c=e,{userDevicesTotalPrice:s,userDevicesTopUp:o,resetStore:u}=Te(),{formatPriceWithSpaces:r}=Ze(),n=te(!0),p=te(c.isOpenContent),S=A(()=>{var g;return Je((g=c.order)==null?void 0:g.products)}),I=A(()=>{var g,b;return(b=(g=c.order)==null?void 0:g.total)==null?void 0:b.ordered_quantity}),w=A(()=>{var g,b;return(b=(g=c.order)==null?void 0:g.payment)==null?void 0:b.currency}),j=A(()=>{var g,b;return(b=(g=c.order)==null?void 0:g.total)==null?void 0:b.total_price_with_discount}),U=A(()=>{var g,b,J,t;return((b=(g=c.order)==null?void 0:g.total)==null?void 0:b.total_trade_in_grade_price_with_topup)-((t=(J=c.order)==null?void 0:J.total)==null?void 0:t.total_trade_in_grade_price)||o.value}),B=A(()=>{var g,b;return((b=(g=c.order)==null?void 0:g.total)==null?void 0:b.total_trade_in_grade_price)||s.value-o.value}),P=A(()=>B.value?`-${r(B.value)}`:0),_=A(()=>c.isTradeIn?j.value>B.value?j.value-B.value-U.value:1:j.value),d=A(()=>{var g,b;return(b=(g=c.order)==null?void 0:g.delivery)==null?void 0:b.type}),k=A(()=>{var g,b;return(b=(g=c.order)==null?void 0:g.total)==null?void 0:b.delivery_price}),N=A(()=>{var g,b;return(b=(g=c.order)==null?void 0:g.total)==null?void 0:b.total_price_with_discount_without_delivery}),Z=A(()=>c.isOrderSummaryTop?p.value?"hide_order_summary":"show_order_summary":n.value?"hide":"show"),K=()=>{c.isOrderSummaryTop?p.value=!p.value:n.value=!n.value};return Be(()=>{u()}),(g,b)=>{const J=de,t=Pe,i=it;return a(S)?(m(),v("div",{key:0,class:W(["checkout-products",{"checkout-products__border":e.isOrderSummaryTop&&a(p)}])},[e.showHeader?(m(),v("div",{key:0,class:W(["checkout-products_header",{"checkout-products_header__show-border":e.isOrderSummaryTop,"checkout-products_header__vertical-padding":e.isOrderSummaryTop}])},[h("div",{class:W(["checkout-products_header-wrapper",{"checkout-products_header-wrapper__with-padding":e.isOrderSummaryTop}])},[h("button",{class:"checkout-products_header-content",onClick:K},[e.isOrderSummaryTop?O("",!0):(m(),v("span",ut,$(g.$t("order_summary")),1)),h("div",dt,[h("span",mt,$(g.$t(a(Z))),1),R(J,{class:W(["checkout-products_button-icon",{rotate:e.isOrderSummaryTop?!a(p):!a(n)}]),icon:"arrowTop"},null,8,["class"])]),e.isOrderSummaryTop?(m(),v("span",pt,[q($(a(r)(a(_)))+" ",1),R(t,{currency:a(w),"use-default":""},null,8,["currency"])])):O("",!0)])],2)],2)):O("",!0),h("div",{class:W(["checkout-products_content",{"checkout-products_content__show":a(p),"checkout-products_content__hide":!a(p),"checkout-products_content__max-width":e.maxWidth}])},[h("div",{class:W(["checkout-products_content-wrapper",{"checkout-products_content-wrapper__padding":e.isOrderSummaryTop}])},[h("div",{class:W(["checkout-products_list-products",{"checkout-products_list-products__show":a(n),"checkout-products_list-products__hide":!a(n)}])},[(m(!0),v(V,null,oe(a(S),C=>(m(),v("div",{key:C.slug},[R(i,{product:C,currency:a(w)},null,8,["product","currency"]),C.bundle_pairing_cms_id&&C.bundle_pairing.products?(m(!0),v(V,{key:0},oe(C.bundle_pairing.products,(M,L)=>(m(),Y(i,{key:`bundle-${C.crm_id}-${L}`,product:M,currency:a(w)},null,8,["product","currency"]))),128)):O("",!0)]))),128))],2),h("div",{class:W(["checkout-products_additional-prices",{"checkout-products_additional-prices__no-margin-bottom":e.noMarginBottom}])},[h("p",_t,[q($(g.$t("subtotal"))+" ",1),a(I)>1?(m(),v(V,{key:0},[q(" â€¢ "+$(a(I))+" "+$(g.$t("subtotal_pieces")),1)],64)):O("",!0),h("span",ht,[q($(a(r)(a(N)))+" ",1),R(t,{currency:a(w),"use-default":""},null,8,["currency"])])]),e.isTradeIn?(m(),v(V,{key:0},[h("p",ft,[q($(g.$t("trade_in_benefit"))+" ",1),h("span",yt,[q($(a(P))+" ",1),R(t,{currency:a(w),"use-default":""},null,8,["currency"])])]),a(U)>0?(m(),v("p",gt,[q($(g.$t("trade_in_additional_benefit"))+" ",1),h("span",vt,[q($(`-${a(r)(a(U))}`)+" ",1),R(t,{currency:a(w),"use-default":""},null,8,["currency"])])])):O("",!0)],64)):O("",!0),h("p",kt,[q($(g.$t("shipping"))+" ",1),a(d)||e.isRepeatPayment?(m(),v(V,{key:0},[a(k)?(m(),v("span",bt,[q($(a(r)(a(k)))+" ",1),R(t,{currency:a(w),"use-default":""},null,8,["currency"])])):(m(),v("span",$t,$(g.$t("free")),1))],64)):(m(),v("span",Ct,$(g.$t("enter_shipping_address")),1))])],2),e.showTotal?(m(),v("p",St,[q($(g.$t(e.isTradeIn?"preliminary_total_cost":"total"))+" ",1),h("span",Pt,[q($(a(r)(a(_)))+" ",1),R(t,{currency:a(w),"use-default":""},null,8,["currency"])])])):O("",!0),e.isTradeIn?(m(),v("p",Dt,$(g.$t("trade_in_benefit_message")),1)):O("",!0)],2)],2)],2)):O("",!0)}}},Va=se(Ot,[["__scopeId","data-v-92424cef"]]),It=["id","name","disabled","value"],wt=["for"],Tt={key:0,class:"radio-accordion_content"},Bt={key:1,class:"radio-accordion_errors"},At=Ae({__name:"UiRadioAccordion",props:{value:{},modelValue:{},name:{},errors:{},disabled:{type:Boolean},type:{}},emits:["update:modelValue","change"],setup(e,{emit:c}){const s=Me(),o=c;function u(r){let n=r.target.value;n==="true"&&(n=!0),n==="false"&&(n=!1),o("update:modelValue",n),o("change",n)}return(r,n)=>{var p;return m(),v("div",{class:W(["radio-accordion",{error:(p=r.errors)==null?void 0:p.length}])},[h("input",Ce({...r.$attrs},{id:String(r.value),class:"radio-accordion_input",type:"radio",name:r.name,disabled:r.disabled,value:r.value,onChange:u}),null,16,It),h("label",{class:"radio-accordion_label",for:String(r.value)},[ue(r.$slots,"label",{},void 0,!0)],8,wt),s.content?(m(),v("div",Tt,[ue(r.$slots,"content",{},void 0,!0)])):O("",!0),r.errors?(m(),v("div",Bt,[(m(!0),v(V,null,oe(r.errors,S=>(m(),v("span",{key:S},$(S),1))),128))])):O("",!0)],2)}}}),Mt=se(At,[["__scopeId","data-v-bf44a8db"]]),jt={class:"checkout-tooltip_content"},Ut={__name:"checkout-tooltip",props:{paymentsLength:{type:Number,required:!0}},setup(e){const c=te(!1);return(s,o)=>(m(),v("div",{class:W(["checkout-tooltip",{"checkout-tooltip_one-payment":e.paymentsLength===1}]),onMouseleave:o[2]||(o[2]=u=>c.value=!1)},[h("div",{class:W(["checkout-tooltip_wrapper",{active:a(c)}])},[h("div",jt,[ue(s.$slots,"content",{},void 0,!0)]),o[3]||(o[3]=h("div",{class:"checkout-tooltip_arrow-down"},null,-1))],2),h("div",{class:"checkout-tooltip_button",onMouseenter:o[0]||(o[0]=u=>c.value=!0),onClick:o[1]||(o[1]=je(u=>c.value=!a(c),["prevent"]))},[ue(s.$slots,"button",{},void 0,!0)],32)],34))}},qt=se(Ut,[["__scopeId","data-v-b616ae03"]]),fe={CY:[4,5],PL:[5],UZ:[5,6],KZ:[5,6]},Nt={CY:"#####",PL:"##-###",UZ:"######",KZ:"######",AZ:"######"},Ft=()=>{var u;const e=Ue(),{currentCountry:c}=e.public,s=r=>fe[c].includes(r==null?void 0:r.length);return{getCityByZipCode:async r=>{if(s(r)===!1)return null;const n=r.replace(/[^+\d]/g,"");try{const{data:p}=await He.getCitiesByZipCode(n),S=p.data;if(S.length){const I=S[0].name;return I===void 0?null:I}return null}catch(p){return console.error(p),null}},zipCodeMask:Nt[c],zipCodeMaxLength:(u=fe[c])!=null&&u.length?Math.max(...fe[c]):1/0}},Rt={class:"checkout-payment-form"},Lt={__name:"checkout-payment-form",props:{defaultForm:{type:Object,default:()=>{}},formConfig:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1},validate:{type:Object,default:()=>{}}},emits:["input"],setup(e,{emit:c}){const s=e,o=c,{getErrors:u}=ye(),r=w=>u(s.validate[w]),{zipCodeMask:n}=Ft(),p=te({...s.defaultForm}),S=(w,j)=>{o("input",{value:w.target.value,name:j})},I=w=>{var j;return(j=w.validations)!=null&&j.length?w.validations.some(U=>(U==null?void 0:U.rule)==="required"):!1};return(w,j)=>{const U=We,B=Ye,P=qe("maska");return m(),v("div",Rt,[(m(!0),v(V,null,oe(e.formConfig.fields,_=>(m(),v("div",{key:_.name},[_.name==="phone"?(m(),Y(U,{key:0,modelValue:a(p)[_.name],"onUpdate:modelValue":d=>a(p)[_.name]=d,type:"phone",label:_.name,disabled:e.loading,errors:r(_.name),height:55,required:I(_),onBlur:d=>{var k;return(k=e.validate[_.name])==null?void 0:k.$touch()},onInput:d=>S(d,_.name)},null,8,["modelValue","onUpdate:modelValue","label","disabled","errors","required","onBlur","onInput"])):O("",!0),_.name==="email"?(m(),Y(B,{key:1,modelValue:a(p)[_.name],"onUpdate:modelValue":d=>a(p)[_.name]=d,type:"email",label:_.name,errors:r(_.name),height:55,disabled:e.loading,required:I(_),onBlur:d=>{var k;return(k=e.validate[_.name])==null?void 0:k.$touch()},onInput:d=>S(d,_.name)},null,8,["modelValue","onUpdate:modelValue","label","errors","disabled","required","onBlur","onInput"])):O("",!0),_.name==="post_index"?Ne((m(),Y(B,{key:2,modelValue:a(p)[_.name],"onUpdate:modelValue":d=>a(p)[_.name]=d,height:55,maxlength:"6",autocomplete:_.name,errors:r(_.name),type:"number",label:_.name,disabled:e.loading,required:I(_),onBlur:d=>{var k;return(k=e.validate[_.name])==null?void 0:k.$touch()},onInput:d=>S(d,_.name)},null,8,["modelValue","onUpdate:modelValue","autocomplete","errors","label","disabled","required","onBlur","onInput"])),[[P,a(n)]]):O("",!0),_.name!=="email"&&_.name!=="phone"&&_.name!=="post_index"?(m(),Y(B,{key:3,modelValue:a(p)[_.name],"onUpdate:modelValue":d=>a(p)[_.name]=d,height:55,label:_.name,autocomplete:_.name,errors:r(_.name),disabled:e.loading,type:"text",maxlength:100,required:I(_),onBlur:d=>{var k;return(k=e.validate[_.name])==null?void 0:k.$touch()},onInput:d=>S(d,_.name)},null,8,["modelValue","onUpdate:modelValue","label","autocomplete","errors","disabled","required","onBlur","onInput"])):O("",!0)]))),128))])}}},xt=se(Lt,[["__scopeId","data-v-b15e19f7"]]),Et={class:"checkout-payment-item"},Vt={class:"checkout-payment-item_label"},zt={key:0,class:"checkout-payment-item_icon"},Zt={__name:"checkout-payment-item",props:{payment:{type:Object,required:!0}},setup(e){const c=e,{t:s,te:o}=me(),u=A(()=>{var n,p,S;return Math.min(...(S=(p=(n=c.payment)==null?void 0:n.credit_params)==null?void 0:p.programs)==null?void 0:S.map(I=>I==null?void 0:I.bank_commission_percent))}),r=A(()=>{const p=o("credit_percent")?`${u.value}${s("credit_percent")}`:"";return`${s("payment_credit")} ${p}`});return(n,p)=>{const S=de;return m(),v("div",Et,[h("span",Vt,[e.payment.type==="credit"?(m(),v(V,{key:0},[q($(a(r)),1)],64)):O("",!0),q(" "+$(n.$t(`payment_${e.payment.name}`)),1)]),a($e)[e.payment.name]?(m(),v("div",zt,[R(S,{icon:e.payment.name,"container-size":""},null,8,["icon"])])):O("",!0)])}}},Jt=se(Zt,[["__scopeId","data-v-948f93df"]]),Wt=()=>{const e=d=>{const k=typeof localStorage<"u"?localStorage.getItem(d):null;return k?JSON.parse(k):null};return{saveCountryData:d=>{typeof localStorage<"u"&&localStorage.setItem("countrySaveData",JSON.stringify(d))},saveSearchData:d=>{typeof localStorage<"u"&&localStorage.setItem("searchSaveData",JSON.stringify(d))},saveDeliveryData:d=>{typeof localStorage<"u"&&localStorage.setItem("deliverySaveData",JSON.stringify(d))},saveClientData:d=>{typeof localStorage<"u"&&localStorage.setItem("clientSaveData",JSON.stringify(d))},saveBaseData:d=>{typeof localStorage<"u"&&localStorage.setItem("baseSaveData",JSON.stringify(d))},savePaymentData:d=>{typeof localStorage<"u"&&localStorage.setItem("paymentSaveData",JSON.stringify(d))},getSearchData:()=>e("searchSaveData"),getBaseData:()=>e("baseSaveData"),getPaymentData:()=>e("paymentSaveData"),getDeliveryData:()=>e("deliverySaveData"),getClientData:()=>e("clientSaveData"),getCountryData:()=>e("countrySaveData"),getRedirectUrl:(d,k,N)=>{if(!N||typeof N!="object"||(N==null?void 0:N.status)==="error")return`/checkout/${d}?contact_id=${k}`;switch(N.type){case null:case"init_brokerage_kz_widget":return`/checkout/${d}?contact_id=${k}`;case"generate_qr_with_logo":return`/checkout/${d}?contact_id=${k}`;case"liq_apple_pay":return`/checkout/${d}/apple?contact_id=${k}`;default:return`/checkout/${d}/redirect?contact_id=${k}`}},saveLocale:d=>{typeof localStorage<"u"&&localStorage.setItem("locale",JSON.stringify(d))},getLocale:()=>e("locale")}};function Yt(){return/iPhone|iPad|iPod/.test(navigator.userAgent)&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}const Ht="apple_pay",Se=()=>({filterPayments:o=>o==null?void 0:o.filter(u=>u.name===Ht?Yt()&&u.enabled:u.enabled),getDefaultProgramValue:(o,u)=>{if(u!=null&&u.payment.credit_program_id){const r=o.filter(n=>n.id===u.payment.credit_program_id);return r.length?r[0]:o[0]}return o[0]},refactorPaymentData:o=>({credit_program_id:o==null?void 0:o.credit_program_id,currency:o==null?void 0:o.currency,group:(o==null?void 0:o.group)||(o==null?void 0:o.type),main_type:o==null?void 0:o.main_type,name:o==null?void 0:o.type,type:o==null?void 0:o.type})}),Qt={class:"checkout-payment"},Kt={class:"checkout-payment_title"},Xt={class:"checkout-payment_description"},Gt={key:0,class:"checkout-payment_hint"},ea={class:"checkout-payment_groups"},ta={class:"checkout-payment_icons"},aa={key:0,class:"checkout-payment_icon"},na={class:"checkout-payment_icon checkout-payment_icon__cursor-pointer"},oa={class:"checkout-payment_icon-text"},ra={key:0,class:"checkout-payment_content"},sa={class:"checkout-payment_content-wrapper checkout-payment_content-wrapper__padding"},ca={key:1,class:"checkout-payment_radio-item"},la={class:"checkout-payment_content"},ia={class:"checkout-payment_content-wrapper"},ua={key:1,class:"checkout-payment_content-wrapper checkout-payment_content-wrapper__padding-top"},da={key:2,class:"checkout-payment_credit"},ma={class:"checkout-payment_credit-month"},pa={class:"checkout-payment_credit-month-title"},_a={class:"checkout-payment_credit-month-price"},ha={class:"payment-credit_currency"},fa={class:"checkout-payment_credit-total"},ya={class:"payment-credit_currency"},ga={class:"checkout-payment_credit-total"},va={class:"payment-credit_currency"},ka={__name:"checkout-payment",props:{creditValue:{type:Object,default:()=>{}},currency:{type:String,required:!0},currentCart:{type:Object,default:()=>{}},defaultForm:{type:Object,default:()=>{}},formConfig:{type:Object,default:()=>{}},formRules:{type:Object,default:()=>{}},installmentErrors:{type:Object,default:()=>{}},installmentForm:{type:Object,default:()=>{}},isTitleShown:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},payments:{type:Array,required:!0},validate:{type:Object,default:()=>{}},value:{type:Object,default:()=>{}},isOpened:{type:Boolean,default:!1}},emits:["changeCredit","change","selectCredit","input"],setup(e,{emit:c}){var K,g,b,J;const s=e,o=c,u=Fe("isTradeInProductSelected");s.value&&o("change",s.value);const r=te({}),n=te((b=(g=(K=s.currentCart.total)==null?void 0:K.credit)==null?void 0:g.schedule)==null?void 0:b.length),{pushGtmEvent:p}=Re(),{savePaymentData:S,getPaymentData:I}=Wt(),{getDefaultProgramValue:w}=Se(),{currencyMark:j}=Ke(s.currency),U=(t,i=2,C)=>t==null?void 0:t.slice(i,C),B=A(()=>{const t={};return s.payments.forEach(i=>{var M;const C=i.group||i.name;t[C]||(t[C]=[]),t[C].push(i),i.group==="credit_and_installment"&&(r.value[i.name]=w(((M=i==null?void 0:i.credit_params)==null?void 0:M.programs)||[],s.currentCart))}),Object.keys(t).map(i=>({groupName:i,tradeInDisabled:!t[i][0].is_trade_in,payments:t[i]}))}),P=te((J=B.value[0])==null?void 0:J.groupName);ee(()=>s.isOpened,t=>{t&&(P.value=s.currentCart.payment.group??s.currentCart.payment.type)});const _=A({get(){return s.creditValue},set(t){S(t),o("changeCredit",t)}}),d=te({});ee(()=>d.value,t=>{const i=B.value.find(C=>C.groupName===P.value);if(i){const C=i.payments.find(M=>M.name===t);C&&(k.value=C)}});const k=A({get(){return s.value},set(t){var i,C,M;t.type==="credit"?_.value=t:(o("change",t),S({group:P.value,...t})),((C=(i=s.currentCart)==null?void 0:i.payment)==null?void 0:C.type)!==t.type&&p("addPaymentInfo",(M=s.currentCart)==null?void 0:M.products.map(L=>({...L,quantity:(L==null?void 0:L.ordered_quantity)||1})),{paymentType:t.type})}});ee(P,()=>{var M,L;const t=(M=B.value.find(z=>(z==null?void 0:z.groupName)===P.value))==null?void 0:M.payments,C=(t==null?void 0:t.find(z=>{var X,G;return z.name===((X=k.value)==null?void 0:X.type)||z.name===((G=k.value)==null?void 0:G.name)}))||(t==null?void 0:t[0]);P.value!=="credit_and_installment"||C.type==="payment"?((L=k.value)==null?void 0:L.type)!==C.name&&(k.value={main_type:C.type,type:C.name}):_.value||(k.value=C)}),Le(()=>{var X,G,T;const t=I(),i=(X=B.value)==null?void 0:X.find(x=>x.groupName===(t==null?void 0:t.group)),C=(G=i==null?void 0:i.payments)==null?void 0:G.find(x=>x.type==="credit"?x.name===(t==null?void 0:t.name):x.name===(t==null?void 0:t.type)),M=(T=B.value)==null?void 0:T[0],L=x=>{P.value=x.group||x.name,x.type==="credit"?k.value=x:k.value={type:x.name,main_type:x.type}},z=i&&C?C:M.payments[0];L(z)});const N=t=>{var i;t!=null&&t.groupName&&((i=t.payments)==null?void 0:i.length)<=1&&(P.value=t.groupName)};ee(()=>{var t,i;return(i=(t=s.currentCart.total)==null?void 0:t.credit)==null?void 0:i.schedule},t=>{var i,C,M;t&&(n.value=(M=(C=(i=s.currentCart.total)==null?void 0:i.credit)==null?void 0:C.schedule)==null?void 0:M.length)}),ee(()=>n.value,t=>{var i,C;t&&o("selectCredit",{credit_program_id:(C=(i=k.value.credit_params)==null?void 0:i.programs.find(M=>M.term===t))==null?void 0:C.id,main_type:k.value.type,type:k.value.name})}),ee(()=>u==null?void 0:u.value,t=>{if(t){const i=B.value.find(C=>!C.tradeInDisabled);i&&(P.value=i.groupName)}});const Z=t=>`${new Intl.NumberFormat("ru-Ru").format(t)}`;return(t,i)=>{const C=de,M=qt,L=xt,z=Jt,X=Qe,G=Mt;return m(),v("div",Qt,[e.isTitleShown?(m(),v(V,{key:0},[h("h3",Kt,$(t.$t("payment")),1),h("p",Xt,$(t.$t("payment_description")),1),a(u)?(m(),v("p",Gt,$(t.$t("payment_trade_in_disabled")),1)):O("",!0)],64)):O("",!0),h("div",ea,[(m(!0),v(V,null,oe(a(B),T=>{var x,pe,_e,l,f;return m(),Y(G,{key:T.groupName,modelValue:a(P),"onUpdate:modelValue":i[4]||(i[4]=y=>ie(P)?P.value=y:null),name:T.groupName,value:T.groupName,disabled:e.loading||T.tradeInDisabled&&!!a(u),checked:a(P)===T.groupName},ke({label:ne(()=>{var y;return[q($(t.$t(`payment_${T.groupName}`))+" ",1),h("div",ta,[(m(!0),v(V,null,oe(U(T.payments,0,2),D=>(m(),v(V,{key:D.name},[a($e)[D==null?void 0:D.name]?(m(),v("div",aa,[R(C,{icon:D.name,"container-size":""},null,8,["icon"])])):O("",!0)],64))),128)),((y=T==null?void 0:T.payments)==null?void 0:y.length)>2?(m(),Y(M,{key:0,"payments-length":U(T.payments).length},{button:ne(()=>{var D;return[h("div",na,[h("span",oa," +"+$(((D=T==null?void 0:T.payments)==null?void 0:D.length)-2),1)])]}),content:ne(()=>[(m(!0),v(V,null,oe(U(T.payments),D=>(m(),v("div",{key:D.name,class:"checkout-payment_icon"},[R(C,{icon:D.name,"container-size":""},null,8,["icon"])]))),128))]),_:2},1032,["payments-length"])):O("",!0)])]}),_:2},[a(P)==="cashless_payment"&&((x=e.formConfig)!=null&&x.fields)||T.payments.length>1||((f=(l=(_e=(pe=T.payments)==null?void 0:pe[0])==null?void 0:_e.credit_params)==null?void 0:l.programs)==null?void 0:f.length)>1?{name:"content",fn:ne(()=>{var y,D,E,H,Q;return[a(P)==="cashless_payment"&&((y=e.formConfig)!=null&&y.fields)?(m(),v("div",ra,[h("div",sa,[R(L,{"default-form":e.defaultForm,"form-config":e.formConfig,"form-rules":e.formRules,loading:e.loading,validate:e.validate,onInput:i[0]||(i[0]=F=>t.$emit("input",F))},null,8,["default-form","form-config","form-rules","loading","validate"])])])):O("",!0),T.payments.length>1||((Q=(H=(E=(D=T.payments)==null?void 0:D[0])==null?void 0:E.credit_params)==null?void 0:H.programs)==null?void 0:Q.length)>1?(m(),v("div",ca,[(m(!0),v(V,null,oe(T.payments,F=>{var re;return m(),Y(G,{key:F.name,modelValue:a(d),"onUpdate:modelValue":i[3]||(i[3]=ae=>ie(d)?d.value=ae:null),name:F.name,disabled:e.loading,value:F.name,checked:((re=a(k))==null?void 0:re.name)===F.name,onChange:ae=>N(T)},ke({label:ne(()=>[R(z,{payment:F},null,8,["payment"])]),_:2},[F.type==="credit"?{name:"content",fn:ne(()=>{var ae,ge,ve;return[h("div",la,[h("div",ia,[(ae=e.currentCart.total)!=null&&ae.credit&&F.credit_params.programs?(m(),Y(X,{key:0,modelValue:a(n),"onUpdate:modelValue":i[1]||(i[1]=ce=>ie(n)?n.value=ce:null),disabled:e.loading,label:"term_number",options:F.credit_params.programs.map(ce=>({label:`${ce.term} ${t.$t("payments")}`,value:ce.term}))},null,8,["modelValue","disabled","options"])):O("",!0),(ge=e.formConfig)!=null&&ge.fields?(m(),v("div",ua,[R(L,{"default-form":e.defaultForm,"form-config":e.formConfig,"form-rules":e.formRules,loading:e.loading,validate:e.validate,onInput:i[2]||(i[2]=ce=>t.$emit("input",ce))},null,8,["default-form","form-config","form-rules","loading","validate"])])):O("",!0),(ve=e.currentCart.total)!=null&&ve.credit?(m(),v("div",da,[h("div",ma,[h("p",pa,$(t.$t("montly_payment")),1),h("p",_a,[q($(Z(e.currentCart.total.credit.monthly_payment))+" ",1),h("span",ha,$(a(j)),1)])]),h("div",fa,[h("p",null,$(t.$t("total_cost_in_credit")),1),h("p",null,[q($(Z(e.currentCart.total.credit.total_amount_with_interest))+" ",1),h("span",ya,$(a(j)),1)])]),h("div",ga,[h("p",null,$(t.$t("order_cost_in_credit")),1),h("p",null,[q($(Z(e.currentCart.total.credit.total_amount_without_interest))+" ",1),h("span",va,$(a(j)),1)])])])):O("",!0)])])]}),key:"0"}:void 0]),1032,["modelValue","name","disabled","value","checked","onChange"])}),128))])):O("",!0)]}),key:"0"}:void 0]),1032,["modelValue","name","value","disabled","checked"])}),128))])])}}},ba=se(ka,[["__scopeId","data-v-7c2e09ac"]]),$a=()=>{const{defaultRequiredMessage:e,maxLengthMessage:c,lengthMessage:s,regExpMessage:o}=ye();return{getValidationRules:r=>{const n={};return r&&r.fields&&r.fields.forEach(p=>{p.validations.forEach(S=>{switch(S.rule){case"required":n[p.name]={...n[p.name],defaultRequiredMessage:e};break;case"max":n[p.name]={...n[p.name],maxLength:c(S.value)};break;case"email":n[p.name]={...n[p.name],defaultRequiredMessage:e};break;case"min":n[p.name]={...n[p.name],minLength:s(S.value)};break;case"regex":n[p.name]={...n[p.name],regex:o(S.error_message,S.value)};break}})}),n}}},le=(e,c)=>{if(typeof e!="object"&&typeof c!="object")return Object.is(e,c);if(e===null||c===null)return e===c;if(typeof e!=typeof c)return!1;if(e===c)return!0;if(e instanceof Map&&c instanceof Map){if(e.size!==c.size)return!1;for(const[s,o]of e)if(!c.has(s)||!le(o,c.get(s)))return!1;return!0}if(e instanceof Set&&c instanceof Set){if(e.size!==c.size)return!1;const s=Array.from(e),o=Array.from(c);for(let u=0;u<s.length;u++)if(!o.some(r=>le(s[u],r)))return!1;return!0}if(Array.isArray(e)&&Array.isArray(c)){if(e.length!==c.length)return!1;for(let s=0;s<e.length;s++)if(!le(e[s],c[s]))return!1;return!0}if(Array.isArray(e)||Array.isArray(c)||Object.keys(e).length!==Object.keys(c).length)return!1;for(const[s,o]of Object.entries(e))if(!(s in c)||!le(o,c[s]))return!1;return!0},Ca=()=>{const{t:e}=me(),c=(u,r,n=r)=>`
<a href="${u[r]}" target="_blank">${n}</a>
        `,s=(u,r,n=r)=>{const p=r.toLowerCase().includes("photo");return`
${p?"":`${e(n)} : `}${p?c(r,n):u[r]}
        `};return{getInstallmentComment:u=>Object.keys(u).reduce((r,n)=>{switch(n){case"name":case"surname":case"pinfl":r+=s(u,n);break;case"phone":r+=s(n,"phone_number");break;case"passport":r+=s(u,n,"passport_number");break;case"card":r+=s(u,n,"card_number");break;case"term":r+=s(u,n,"card_term");break;case"photoAdditional":r+=s(u,n,"checkout_installment_reg_document_title");break;case"photoMain":r+=s(u,n,"checkout_installment_passport_image_title");break;case"photoSelfie":r+=s(u,n,"checkout_installment_passport_selfie_title");break}return r},"")}},Sa={account_number:null,address:"",agreement:null,bank_account:"",bank_name:null,bank_service:null,bank:"",based_on:"",bic_personal:null,bill_to_address:null,business_date:"",business_unp:"",checking_account:null,company_legal_name:null,company_name:"",company_registration_number:null,egrpoy:"",email:"",entity_address:"",entity_phone:"",first_name:"",full_company_name:null,iban:"",inn:"",ipn:"",last_name:"",mfo:"",name:"",pan:"",passport:"",phone:"",position:"",post_index:"",postal_code:null,promo_code:"",promocode:"",registration:"",registration_country:"",selfie:"",ship_to_address:null,social_card:"",surname:"",swift:null,tin:"",unp:null,user_type:"1",vat_registration_number:null},za={__name:"checkout-payment-wrapper",props:{currentCart:{type:Object,default:()=>{}},paymentConfig:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1},currency:{type:String,default:""},isAvailableGroupType:{type:Boolean,default:!0},isTitleShown:{type:Boolean,default:!0},oldPaymentTypeValue:{type:String,default:""},isOpened:{type:Boolean,default:!1}},emits:["update","updateState"],setup(e,{expose:c,emit:s}){const o={name:"",surname:"",phone:null,passport:"",pinfl:"",card:"",term:"",photoMain:null,photoSelfie:null,photoAdditional:null},u=e,r=s,{defaultRequiredMessage:n,cardMinLengthMessage:p,getErrors:S,cardTermMinLengthMessage:I}=ye(),{getValidationRules:w}=$a(),{t:j}=me(),{getInstallmentComment:U}=Ca(),{getDefaultProgramValue:B}=Se(),P=he({payment_type:null,selectCredit:null,credit:null}),_=he({...o}),d=he(Sa),k=te(!1),N=A(()=>{var y,D,E,H,Q;if(k.value)return{};const l=(D=(y=u.currentCart)==null?void 0:y.payment)==null?void 0:D.form,f=((Q=(H=(E=u.currentCart)==null?void 0:E.payment)==null?void 0:H.form)==null?void 0:Q.values)||{};return Object.keys(f).forEach(F=>{const re=f[F];Object.hasOwn(d,F)&&(d[F]=re)}),l||{}}),Z=A(()=>w(N.value)),K=A(()=>{var l;return((l=P.payment_type)==null?void 0:l.main_type)==="installment"}),g=A(()=>K.value?{name:{defaultRequiredMessage:n},surname:{defaultRequiredMessage:n},passport:{defaultRequiredMessage:n},pinfl:{defaultRequiredMessage:n},photoMain:{defaultRequiredMessage:n},photoSelfie:{defaultRequiredMessage:n},photoAdditional:{defaultRequiredMessage:n},card:{required:n,minLength:p},term:{required:n,minLength:I}}:{}),b=be(g,_),J=A(()=>{var l,f,y,D,E,H,Q,F,re,ae;return{name:S((l=b.value)==null?void 0:l.name),card:S((f=b.value)==null?void 0:f.card),passport:S((y=b.value)==null?void 0:y.passport),surname:S((D=b.value)==null?void 0:D.surname),pinfl:S((E=b.value)==null?void 0:E.pinfl),term:S((H=b.value)==null?void 0:H.term),photoSelfie:(F=(Q=b.value)==null?void 0:Q.photoSelfie)==null?void 0:F.$error,photoAdditional:(ae=(re=b.value)==null?void 0:re.photoAdditional)==null?void 0:ae.$error}}),t=A(()=>{var f;const l=Object.keys(b.value).reduce((y,D)=>(!D.includes("$")&&!D.includes("_")&&(y[D]=b.value[D]),y),{});return!((f=Object.keys(l).filter(y=>l[y].$invalid))!=null&&f.length)}),i=be(Z,d),C=l=>{var f;(f=i.value[l])!=null&&f.$touch&&i.value[l].$touch()},M=l=>{var f,y,D,E;(y=(f=i.value)==null?void 0:f[l.name])==null||y.$reset(),(E=(D=i.value)==null?void 0:D[l.name])==null||E.$touch(),d[l.name]=l.value},L=()=>{var l;Object.keys(o).forEach(f=>{var D;const y=o[f];Object.is(y,null)?_[f]=y:typeof y=="object"&&((D=Object.keys(y))!=null&&D.length)?_[f]={...o[f]}:_[f]=y}),(l=b.value)==null||l.$reset()},z=l=>{localStorage.setItem("payment_type",l.type)},X=async(l,f=!1)=>{var y,D,E,H;if(l){if(k.value=!0,f&&!l.credit_program_id){P.credit=l,P.payment_type=l;const Q=B(l.credit_params.programs,u.currentCart);P.selectCredit={credit_program_id:Q.id,main_type:l.type,type:l.name},((D=(y=u.currentCart)==null?void 0:y.payment)==null?void 0:D.type)!==(l==null?void 0:l.type)&&r("update",{payment:{credit_program_id:Q.id,main_type:l.type,type:l.name}}),z(l);return}f||(P.selectCredit=null,P.credit=null,P.payment_type=l,l.main_type!=="credit"&&((H=(E=u.currentCart)==null?void 0:E.payment)==null?void 0:H.type)!==(l==null?void 0:l.type)&&r("update",{payment:{...P.payment_type}})),z(l)}},G=async l=>{var f,y;P.selectCredit=l,l&&((y=(f=u.currentCart)==null?void 0:f.payment)==null?void 0:y.credit_program_id)!==(l==null?void 0:l.credit_program_id)&&r("update",{payment:{...l}})};return c({validateDefaultForm:()=>{i.value.$reset(),i.value.$touch()},getFormattedComment:l=>{const f=t.value&&K.value,y=l&&f||f?`
=== === === ${j("installment")} === === ===
          `:"",D=f?U(_):"";return`
        ${l}
        ${y}
        ${D}`},createSortAdditionalFields:()=>Object.keys(d).reduce((l,f)=>{var y;return(y=Z.value)!=null&&y[f]&&(l[f]=d[f]),l},{}),validateInstallmentForm:()=>(b.value.$touch(),t.value)}),ee(()=>P.payment_type,()=>{P.payment_type!=="installment"&&L()}),ee(()=>u.loading,l=>{l||(k.value=!1)}),ee(()=>({...P}),(l,f)=>{le(l,f)||r("updateState",{...l,formConfig:{...N.value}})}),(l,f)=>e.paymentConfig&&e.currentCart?(m(),Y(ba,{key:0,ref:"paymentRef","checkout-form":a(P),"credit-value":a(P).credit,currency:e.currency,"current-cart":e.currentCart,"default-form":a(d),"form-config":a(N),"form-rules":a(Z),"installment-errors":a(J),"installment-form":a(_),"is-available-group-type":e.isAvailableGroupType,"is-opened":e.isOpened,"is-title-shown":e.isTitleShown,loading:e.loading&&a(k),"old-payment-type-name":e.oldPaymentTypeValue,payments:e.paymentConfig,validate:a(i),value:a(P).payment_type,onBlurInstallment:f[0]||(f[0]=y=>a(b)[y].$touch()),onBlur:C,onChangeCredit:f[1]||(f[1]=y=>X(y,!0)),onChange:f[2]||(f[2]=y=>X(y)),onInput:M,onInstallmentValueInput:f[3]||(f[3]=y=>a(_)[y.name]=y.value),onSelectCredit:f[4]||(f[4]=y=>G(y))},null,8,["checkout-form","credit-value","currency","current-cart","default-form","form-config","form-rules","installment-errors","installment-form","is-available-group-type","is-opened","is-title-shown","loading","old-payment-type-name","payments","validate","value"])):O("",!0)}},Pa={class:"repeat-payment-information-modal"},Da={class:"repeat-payment-information-modal_title"},Oa={class:"repeat-payment-information-modal_text"},Za={__name:"repeat-payment-information-modal",props:{title:{type:String,default:""},text:{type:String,default:""},buttonText:{type:String,default:""},isModalOpened:{type:Boolean,default:!0},shouldBeAgreed:{type:Boolean,default:!1},redirectUrl:{type:String,default:""},actionAfterRedirect:{type:Function,default:()=>{}}},emits:["close","onClose"],setup(e,{emit:c}){const s=e,o=c,u=Ve(),r=xe(),n=A(()=>s.isModalOpened),p=()=>{var S,I;if((I=(S=u==null?void 0:u.vnode)==null?void 0:S.props)!=null&&I.onOnClose&&o("onClose"),o("close"),s.shouldBeAgreed||s.redirectUrl){typeof redirectUrl=="string"&&(ze(r.$localeRoute({path:redirectUrl})),s.actionAfterRedirect());return}};return(S,I)=>{const w=de,j=Ee,U=Xe;return m(),Y(U,Ce({modelValue:a(n),"onUpdate:modelValue":I[0]||(I[0]=B=>ie(n)?n.value=B:null)},{...S.$attrs},{"full-height":"","onUpdate:modelValue":p}),{default:ne(()=>[h("div",Pa,[R(w,{icon:"failIcon"}),h("span",Da,$(e.title),1),h("span",Oa,$(e.text),1),R(j,{class:"repeat-payment-information-modal_button","full-width":"",onClick:p},{default:ne(()=>[q($(e.buttonText),1)]),_:1})])]),_:1},16,["modelValue"])}}};export{Mt as _,Ft as a,Va as b,za as c,Za as d,Se as e,le as i,Wt as u};
