import{_ as G,r as b,j as w,o as m,k as y,l as h,t as X,y as $,z as V,A as Y,B as U,C as Z,m as p,F as tt,D as ot,E as T,w as j,c as N,q as H,u as rt,G as et,x as q,p as D,P as st,H as at,I as nt,f as ct}from"./Pd6RrLp1.js";import{L as it}from"./BopCOLbw.js";import{_ as ut}from"./2WVDaFKk.js";import{u as dt}from"./UMgXyzVE.js";import{_ as pt}from"./hNdyipqz.js";import{_ as Q}from"./C1bY634J.js";import{u as z}from"./C3MdYnyV.js";import{u as lt}from"./Cc_MbB92.js";import{u as _t}from"./Cubs7ceE.js";import{C as J,f as W}from"./DV533Gpo.js";import{u as mt}from"./CiYsyl20.js";import{P as K}from"./BMHaNUcL.js";import{C as ft}from"./D2vqM95t.js";import{w as vt}from"./CcjC4gLZ.js";import"./BoW1LxkV.js";import"./C3QHuKV1.js";import"./DK9X1TaX.js";import"./B64m7KbU.js";import"./BeTDdiTI.js";import"./0zS85Q81.js";import"./qKLLgZOX.js";import"./gj_0ZWSo.js";import"./km7Iw1uL.js";import"./cdh4QgBc.js";import"./BrwUmeBJ.js";import"./BJt_w7Hb.js";import"./QJ3VVsaT.js";import"./Cuh519_O.js";import"./CAC9vlZT.js";import"./BSts32E-.js";import"./CasWryfL.js";import"./DQObz2Ym.js";import"./CuRHY0aD.js";import"./B-l2-lBV.js";import"./BRd7Y3HP.js";import"./BdleNovN.js";import"./B4ouTiC0.js";import"./DcmtLR2x.js";import"./CpOl9fd2.js";import"./1OVHT2GX.js";import"./T4kW5CUp.js";import"./CMtmRunp.js";import"./Defl8kng.js";import"./ckAQI_px.js";import"./D_VYGPYF.js";import"./BLG6sWI3.js";import"./CyMuBQOc.js";const gt={class:"empty-cart"},yt={class:"empty-cart_title"},ht={class:"empty-cart_account"},Pt={class:"empty-cart_login"},Ct={__name:"empty-cart",setup(A){const{isAuthUser:i}=dt(),s=b(!1);return(_,n)=>{const E=Y,f=Z,u=it,v=ut;return m(),w("div",gt,[y("span",yt,$(_.$t("empty_cart")),1),h(f,{to:_.localePath("/")},{default:V(()=>[h(E,null,{default:V(()=>[U($(_.$t("continue_shopping")),1)]),_:1})]),_:1},8,["to"]),p(i)?X("",!0):(m(),w(tt,{key:0},[y("span",ht,$(_.$t("have_account")),1),y("div",Pt,[y("button",{class:"empty-cart_login__accent",onClick:n[0]||(n[0]=P=>s.value=!0)},$(_.$t("login")),1),n[2]||(n[2]=U("Â ")),y("span",null,$(_.$t("check_faster")),1)])],64)),h(v,{modelValue:p(s),"onUpdate:modelValue":n[1]||(n[1]=P=>ot(s)?s.value=P:null),"max-width":600},{default:V(()=>[h(u)]),_:1},8,["modelValue"])])}}},kt=G(Ct,[["__scopeId","data-v-6fef1575"]]),bt={key:0},wt={__name:"cart-main-section",props:{tradeInBlocks:{type:Array,default:()=>[]}},setup(A){const{setCart:i,getCart:s,fetchCart:_,setCartProducts:n,transformProductsIdsToString:E,fetchCartProducts:f}=z(),u=b([]),{startLoading:v,stopLoading:P}=mt(),{pushGtmEvent:M}=H(),L=b(!0),I=b(!1),x=b(!1);v();const C=async o=>{var g,k;if(x.value&&u.value)return;x.value=!0;const a=[];o==null||o.forEach(e=>{e.bundle_pairing&&e.bundle_pairing.products.forEach(c=>{a.push(c)}),a.push(e)});const t={search:`crm_id:${E(a)}`,searchFields:"crm_id:in"},S=(g=(await K.getProducts(t)).data)==null?void 0:g.data,F=[];u.value=[],(k=s.value)==null||k.products.forEach(e=>{let c=Object.assign({},e);S.forEach(l=>{e.crm_id===l.crm_id&&(c=Object.assign(c,l),c.inStock=!!e.reservation||!!l.real_stock,e.name&&(c.name=e.name),e.bundle_pairing_cms_id&&(c.bundle_pairing_cms_id=e.bundle_pairing_cms_id),e.bundle_pairing&&(c.bundle_pairing=e.bundle_pairing)),F.push(l.stock)}),c.bundle_pairing&&c.bundle_pairing.products&&c.bundle_pairing.products.forEach(l=>{S.forEach(R=>{c.inStock=!!l.available_quantity,l.crm_id===R.crm_id&&Object.assign(l,{...R,inStock:!!l.available_quantity})})}),u.value.push(c)}),I.value=!0,x.value=!1},O=o=>{var d;const a=s.value.products.filter(t=>t!=null&&t.product?t==null?void 0:t.product.crm_id:t.crm_id===o);return(d=a[0])!=null&&d.product?a[0].product.crm_id:a[0].crm_id},B=async({productData:o,isBundle:a})=>{var d,t;try{const r=a?o.key:O(o),S=a?o.bundlePairingCmsId:null,F=a?o.bundlePairingProductId:null,{data:g}=await J.deleteProductFromCart(r,S,F),k=(t=(d=g==null?void 0:g.value)==null?void 0:d.data)==null?void 0:t.cart,e=W(k.products);i({...k,products:e}),n(e),await C(e),f()}catch(r){console.error(r)}};return T(async()=>{v();try{const o=await _();o.products.length&&await C(o.products)}catch(o){console.log(o)}finally{P()}}),j(u,()=>{var o;(o=u.value)!=null&&o.length&&(localStorage.setItem("products",JSON.stringify(u.value)),L.value&&(L.value=!1))}),j(s,()=>{var o;(o=s.value)!=null&&o.products&&C(s.value.products)}),vt(u,()=>{var o;M("viewCart",(o=u.value)==null?void 0:o.map((a,d)=>{var t,r;return{...a,quantity:((r=(t=s.value)==null?void 0:t.products[d])==null?void 0:r.ordered_quantity)||1}}))}),(o,a)=>{const d=Q;return p(I)?(m(),N(ft,{key:1,"products-in-cart":p(u),"trade-in-blocks":A.tradeInBlocks,onDeleteProductFromCart:B,onSearchProduct:C},null,8,["products-in-cart","trade-in-blocks"])):(m(),w("div",bt,[h(d)]))}}},St={key:0},$t={key:0,class:"cart"},Et={class:"cart_slider"},It={class:"cart_slider-title"},xt={key:1},Ft={key:1},Lt={__name:"index",async setup(A){var o,a,d;let i,s;const{pushGtmEvent:_}=H(),n=rt(),E=et(),{getCart:f}=z(),u=q(()=>{var t;return(t=f.value)==null?void 0:t.products.filter(r=>r.type!=="delivery")}),v=b(null),{fetchError:P,setFetchError:M}=lt(),{setMetaToStaticPage:L}=_t(),I=b(!1),x=q(()=>{var t;return((t=f==null?void 0:f.value)==null?void 0:t.products)||[]}),C=q(()=>W(x.value)),O=q(()=>C.value.map(t=>t.id)),B=t=>{I.value=t};try{const t=(a=(o=n==null?void 0:n.value)==null?void 0:o.query)==null?void 0:a.slug;if(t){const{data:{data:r}}=([i,s]=D(()=>K.getProductBySlug(t)),i=await i,s(),i);r&&([i,s]=D(()=>J.addProductToCart(r.crm_id)),await i,s())}}catch(t){console.log(t)}try{const t=([i,s]=D(()=>st.getPageBySlug("cart")),i=await i,s(),i);t!=null&&t.data&&(v.value=t.data)}catch(t){M(t.response.status)}finally{_("pageview",{title:(d=v.value)==null?void 0:d.seo_title})}return L(v),T(()=>{var t,r;(r=(t=n==null?void 0:n.value)==null?void 0:t.query)!=null&&r.slug&&E.replace({query:{...n.query,slug:void 0}})}),(t,r)=>{var e,c;const S=kt,F=pt,g=Q,k=ct("AppError");return p(P)?(m(),w("div",Ft,[h(k,{error:{statusCode:p(P)}},null,8,["error"])])):(m(),w("div",St,[p(f)?(m(),w("div",$t,[y("div",null,[(e=p(u))!=null&&e.length?(m(),N(wt,{key:0,"trade-in-blocks":(c=p(v))==null?void 0:c.blocks},null,8,["trade-in-blocks"])):(m(),N(S,{key:1}))]),at(y("div",Et,[y("p",It,$(t.$t("power_up")),1),h(F,{"slider-key":"cart-slider",product:p(C)[0]||null,"products-ids":p(O),"without-category":"",onOnCrossProductsReady:r[0]||(r[0]=l=>B(!0)),onOnCrossProductsEmpty:r[1]||(r[1]=l=>B(!1))},null,8,["product","products-ids"])],512),[[nt,p(I)]])])):(m(),w("div",xt,[h(g)]))]))}}},$o=G(Lt,[["__scopeId","data-v-0502689d"]]);export{$o as default};
