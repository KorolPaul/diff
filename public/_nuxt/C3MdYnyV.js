import{u as dt,C as T}from"./DV533Gpo.js";import{C as g}from"./B4ouTiC0.js";import{Y as et,x as d,r as u,a9 as lt,q as Ct}from"./Pd6RrLp1.js";import{u as mt}from"./UMgXyzVE.js";const pt=()=>{const c=et();return{pushMindBoxEvent:async(f,l)=>{var y,_,A,L,I;const i=window.mindbox||function(){var r;(r=i==null?void 0:i.queue)==null||r.push(arguments)};let n=(y=c==null?void 0:c.public.currentCountry)==null?void 0:y.toLowerCase();((A=(_=c==null?void 0:c.public)==null?void 0:_.currentCountry)==null?void 0:A.toLowerCase())==="kz"&&(n="kz2"),((I=(L=c==null?void 0:c.public)==null?void 0:L.currentCountry)==null?void 0:I.toLowerCase())==="sa"&&(n="za");let m="Windows";const h=[{device:"Linux",platform:/Linux/},{device:"Android",platform:/Android/},{device:"Ios",platform:/iPhone/},{device:"Ios",platform:/iPad/},{device:"Ios",platform:/iPod/},{device:"Windows",platform:/Windows NT/},{device:"Macos",platform:/Macintosh/}],F=navigator.userAgent;h.forEach(r=>{r.platform.test(F)&&(m=r.device)});const E=r=>{i("async",{operation:`${n}WebCustomerAuth`,data:{customer:{ids:{[`${n}CustomerIdAprCms`]:r}}}})},z=r=>{i("async",{operation:`${n}WebCustomerAuth`,data:{customer:{ids:{[`${n}CustomerIdAsbiscms`]:r}}}})},M=r=>{i("async",{operation:`${n}WebCustomerAuth`,data:{customer:{ids:{[`${n}CustomerIdCrm`]:r}}}})},B=r=>{i("async",{operation:`${n}WebCustomerToken`,data:{customer:{customFields:{[`${n}CustomerCartToken`]:r}}}})},G=r=>{i("async",{operation:`${n}Web${m}CatalogProductView`,data:{viewProduct:{productGroup:{ids:{}},product:{ids:{[n]:r.product_id}}}}}),i("async",{operation:`${n}WebCatalogProductAddView`,data:{addProductToList:{product:{ids:{[n]:r.product_id}},productGroup:{ids:{}},pricePerItem:r.price}}})},x=r=>{i("async",{operation:`${n}Web${m}CatalogCategoryView`,data:{viewProductCategory:{productCategory:{ids:{[`${n}`]:r}}}}})},k=r=>{var b;const v=[];(b=r==null?void 0:r.products)==null||b.forEach(w=>{v.push({product:{ids:{[`${n}`]:w.id}},count:w.ordered_quantity,pricePerItem:w.price_with_discount})}),i("async",{operation:`${n}WebCatalogCartSet`,data:{productList:v}})},V=r=>{const v=[];r.products.forEach(b=>{v.push({product:{ids:{[`${n}`]:b.id}},count:1,pricePerItem:b.final_price})}),r.user&&i("async",{operation:`${n}WebCatalogFavoriteSet`,data:{customer:{ids:{[`${n}CustomerIdAprCms`]:l.user.id}},productList:v}})};switch(f){case"webCustomerAuth":n!=="za"?z(l):n==="za"?M(l):E(l);break;case"WebCustomerToken":B(l);break;case"webCatalogProductView":G(l);break;case"webCatalogCategoryView":x(l);break;case"webCatalogCartSet":k(l);break;case"webCatalogFavoriteSet":V(l);break}}}},W=u(null),$=u(null),Z=u(null),p=u(!1),U=u(null),j=u(null),H=u(null),J=u(null),K=u(null),X=u(null),D=u(null),R=u(null),tt=u(null),ht=()=>{const c=et(),{pushGtmEvent:S}=Ct(),{user:f,setUser:l}=mt(),{pushMindBoxEvent:i}=pt(),{fetchProducts:n}=dt(),m=t=>{if(W.value=t,typeof window<"u"&&i("webCatalogCartSet",t),t&&X.value!==t.token){X.value=t.token;const e=lt("front-cart-token",{path:"/"});e.value=t.token,typeof window<"u"&&i("WebCustomerToken",t.token)}},h=t=>{Z.value=t},F=t=>{H.value=t},E=t=>{D.value=t},z=d(()=>H.value),M=d(()=>U.value),B=d(()=>j.value),G=d(()=>J.value),x=d(()=>D.value),k=d(()=>R.value),V=d(()=>K.value),y=d(()=>W.value),_=d(()=>Z.value),A=t=>`${t.map(e=>e.crm_id).join(",")},`,L=async()=>{var e;p.value=!0;const t=await n((e=W.value)==null?void 0:e.products);return p.value=!1,h(t),t},I=d(()=>{var t;return((t=y.value)==null?void 0:t.total.quantity)??0}),r=d(()=>{var t,e,a;return((a=(e=(t=y==null?void 0:y.value)==null?void 0:t.products)==null?void 0:e.filter(o=>o.sku!=="DELIVERY"))==null?void 0:a.reduce((o,s)=>o+s.ordered_quantity,0))??0}),v=d(()=>tt.value),b=async(t=!0,e={})=>{if(t){const a={...e,paring:{bundle_pairing:{products:[...e.paring.paring_products]}}};a.paring.bundle_pairing.products.forEach(o=>{Object.assign(o,o.product)}),Object.assign(a.paring,a.paring.bundle_pairing.products[0].product),a.paring.bundle_pairing.products.shift()}e.paring.paring_products.length&&e.paring&&e.paring.id&&(p.value=!0,T.addBundleToCart(e.paring.id).then(a=>{var s,C,P;const o=(P=(C=(s=a==null?void 0:a.data)==null?void 0:s.value)==null?void 0:C.data)==null?void 0:P.cart;m(o),h(o==null?void 0:o.products),p.value=!1}))},w=async t=>{var a;const e=T.addProductToCart(t.crm_id||t.crmId);try{p.value=!0;const{data:o}=await e,s={...t,quantity:1};S("addToCartGA",s),(a=o==null?void 0:o.value.data)!=null&&a.cart&&m(o==null?void 0:o.value.data.cart)}catch(o){console.log(o)}finally{p.value=!1}},at=async(t,e=1)=>{var a,o;try{p.value=!0;const{data:s}=await T.addProductToCart(t.crm_id,e),C={...t};C.quantity=1,S("addToCartGA",C),(o=(a=s==null?void 0:s.value)==null?void 0:a.data)!=null&&o.cart&&m(s.value.data.cart)}catch(s){console.log(s)}finally{p.value=!1}},N=t=>{var a,o,s,C;let e=[];switch((a=c==null?void 0:c.public)==null?void 0:a.iso.toLowerCase()){case"uz":e=[{id:239,name:"Uzbekistan",crm_id:"05e4c256-6f4f-46e0-95e4-05dd26f608ac"}];break;case"kz":e=[{id:113,name:"Astana",crm_id:"a770b005-e8bb-df11-b00f-001d60e938c6"}];break;case"sa":e=[{id:205,name:"South Africa",crm_id:"4dd0f42e-3500-4e4f-8f4f-0f0a7be1761a"}];break;case"az":e=[{id:16,name:"Azerbaijan",crm_id:"3675781a-02de-4ceb-b093-994209b3b937"}];break;case"md":e=[{id:144,name:"Moldova",crm_id:"a6e96fb2-e0fc-4976-a45c-801e212dcc2e"}];break;case"ge":e=[{id:82,name:"Georgia",crm_id:"f170336b-39e2-4b7b-9cd7-55a86d857ffe"}];break;case"ua":e=[{id:233,name:"Ukraine",crm_id:"a470b005-e8bb-df11-b00f-001d60e938c6"}];break;case"am":e=[{id:12,name:"Armenia",crm_id:"0ea9ded1-a4a7-4c5d-9d48-a0a1451ac003"}];break;default:e=[{id:57,name:"Cyprus",crm_id:"8e16d5d4-9d96-4971-a117-ada923ac50b2"}]}U.value=[...e],j.value=[...e],f.value&&f.value.is_partner_company_employee&&f.value.country.id!==57&&(U.value=(o=t==null?void 0:t.data)==null?void 0:o.data,j.value=(s=t==null?void 0:t.data)==null?void 0:s.data),J.value=(C=t==null?void 0:t.data)==null?void 0:C.data},ot=t=>{K.value=t.data?t.data:[]},rt=t=>{var e;tt.value=((e=t==null?void 0:t.data)==null?void 0:e.meta)||{}},st=t=>{R.value=t},nt=async()=>{await g.getProfileCountries().then(t=>{N(t)})},it=async t=>{await g.getCityById(t).then(e=>{var a;E((a=e==null?void 0:e.data)==null?void 0:a.data)})},ct=async t=>{try{return await g.getCityById(t).then(e=>{var a;st((a=e.data)==null?void 0:a.data)}),k.value}catch{return null}},ut=async(t,e=1,a="")=>{var o;try{let s;return a?s=await g.getCityByName(t,e,a):s=await g.getCitiesByCountryId(t,e),rt(s),ot(s),((o=s.data)==null?void 0:o.data)||[]}catch(s){return console.error("Error fetching cities:",s),[]}},O=t=>{var a,o,s,C,P,Q;const e=((o=(a=t==null?void 0:t.data)==null?void 0:a.data)==null?void 0:o.cart)||((P=(C=(s=t==null?void 0:t.data)==null?void 0:s.value)==null?void 0:C.data)==null?void 0:P.cart);e.products=(Q=e==null?void 0:e.products)==null?void 0:Q.map(q=>{var Y;return{...q,currency:(Y=e==null?void 0:e.payment)==null?void 0:Y.currency}}),m(e),e.user&&e.user.phone&&(!f.value||f.value.client_type==="unregistered")&&l({client_type:"unregistered",email:e.user.email,phone:e.user.phone,name:e.user.name,lastname:e.user.lastname}),$.value=null,g.getProfileCountries().then(q=>{N(q)})};return{setCart:m,getCart:y,cart:W,transformProductsIdsToString:A,fetchCartProducts:L,getCartProducts:_,getCitiesMeta:v,getCartProductsQuantity:I,getCartPositionsQuantity:r,isCartLoading:p,addProductToCart:w,addProductToCartProductPage:at,addBundleToCart:b,setCartProducts:h,fetchCart:async()=>($.value===null&&($.value=new Promise(t=>{T.getCart().then(e=>{var a;O(e),t((a=e==null?void 0:e.data)==null?void 0:a.data.cart)})})),$.value),getCountryList:M,getProfileCountryList:B,getcountriesListRegisterForm:G,getCitiesListRegisterForm:V,fetchCountiesInCart:nt,fetchCitiesInCart:ut,fetchDefaultCountryCity:it,getDefaultCountryCity:x,setCity:F,getCityName:z,fetchDeliveryPrimaryCity:ct,getPrimaryCity:k,setCartFromApiResponse:O}};export{pt as a,ht as u};
