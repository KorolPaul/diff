import{_ as Ye}from"./qKLLgZOX.js";import{d as xt,r as V,j as C,o as c,O as Ce,m as e,k as h,l as u,F as ue,L as Be,y as g,_ as le,x as S,t as P,c as O,B as N,Q as Ft,a6 as We,aa as Xe,s as Pe,T as Le,h as Je,i as Ke,z as U,X as de,H as me,I as pe,A as ye,b as Ot,S as da,q as va,w as Ue,D as Nt,u as ma,a3 as Bt,al as pa,am as _a}from"./Pd6RrLp1.js";import{_ as Lt}from"./1OVHT2GX.js";import{_ as Ge,a as fa}from"./D_TJXMTY.js";import{_ as Re}from"./DK9X1TaX.js";import{_ as Ze}from"./Bh9jfPsV.js";import{_ as et}from"./CuRHY0aD.js";import{u as He}from"./BSts32E-.js";import{_ as ga}from"./QJ3VVsaT.js";import{o as ha}from"./T4kW5CUp.js";import{_ as ya}from"./BZsyuj-b.js";import{_ as ba}from"./C3QHuKV1.js";import{u as $a,a as ka,_ as wa}from"./BoW1LxkV.js";import{_ as Qt}from"./pvpDbLJt.js";import{_ as Ia}from"./CpOl9fd2.js";import{_ as Ta}from"./2WVDaFKk.js";const Da={class:"more-actions_dropdown"},Pa=["onClick"],Ua=xt({__name:"UiMoreActions",props:{options:{}},setup(n){const i=V(!1);function t(l){l(),i.value=!1}const s=V(null);return ha(s,()=>i.value=!1),(l,o)=>{const a=Ye;return c(),C("div",{ref_key:"menuRef",ref:s,class:Ce(["more-actions",{active:e(i)}])},[h("button",{class:"more-actions_button",onClick:o[0]||(o[0]=y=>i.value=!e(i))},[u(a,{icon:"dots"})]),h("div",Da,[(c(!0),C(ue,null,Be(l.options,y=>(c(),C("div",{key:y.label,class:"more-actions_dropdown-item",onClick:d=>t(y.onClick)},g(y.label),9,Pa))),128))])],2)}}}),Et=le(Ua,[["__scopeId","data-v-8bdceb29"]]),Ca={key:0,class:"checkout-trade-in-item_device"},qa={class:"checkout-trade-in-item_device-header"},Va={class:"checkout-trade-in-item_device-title"},Sa={class:"checkout-trade-in-item_device-data"},xa={class:"checkout-trade-in-item_device-name"},Fa={class:"checkout-trade-in-item_device-price"},Oa={class:"checkout-trade-in-item_item-hint"},Na={key:0,class:"checkout-trade-in-item_device-additional-data"},Ba={class:"checkout-trade-in-item_item-additional-hint"},La={class:"checkout-trade-in-item_additional_benefit"},Qa={key:1,class:"checkout-trade-in-item_device"},Ea={class:"checkout-trade-in-item_device-title"},Aa={class:"checkout-trade-in-item_device-data"},Ma={class:"checkout-trade-in-item_device-name"},ja={class:"checkout-trade-in-item_device-price"},Ka={key:2,class:"checkout-trade-in-item_total-benefit"},Ga={class:"checkout-trade-in-item_benefit-title"},Ra={class:"checkout-trade-in-item_benefit-price"},Ha={__name:"checkout-trade-in-item",props:{device:Object,change:Function,remove:Function,showOptions:{type:Boolean,default:!0},showTotalBenefit:{type:Boolean,default:!1}},emits:["change","remove"],setup(n){const i=n,{formatPriceWithSpaces:t}=He(),s=S(()=>{var y,d,m,T,p;return((p=(T=(m=(d=(y=i.device)==null?void 0:y.initialGrade)==null?void 0:d.data)==null?void 0:m.buyoutTopUp)==null?void 0:T.specialGrading[0])==null?void 0:p.options[0])??null}),l=S(()=>{var y;return((y=s.value)==null?void 0:y.validTill)??""}),o=y=>{const d=y.split("-").reverse();return d.length<2?"":`${d==null?void 0:d[0]}.${d==null?void 0:d[1]}`},a=S(()=>{var y;return(y=i.device.device)==null?void 0:y.exchangeProduct});return(y,d)=>{var p,_,D,$,M,k;const m=Et,T=Ze;return c(),C("div",{class:Ce(["checkout-trade-in-item",{"checkout-trade-in-item__without-padding":!((p=n.device.device)!=null&&p.subcategory)}])},[(_=n.device.device)!=null&&_.subcategory?(c(),C("div",Ca,[h("div",qa,[h("span",Va,g(y.$t("trade_in_exchange_device")),1),n.showOptions?(c(),O(m,{key:0,options:[{label:y.$t("edit"),onClick:()=>y.$emit("change")},{label:y.$t("delete"),onClick:()=>y.$emit("remove")}]},null,8,["options"])):P("",!0)]),h("div",Sa,[h("span",xa,g(n.device.device.subcategory)+", "+g((D=n.device.device)==null?void 0:D.storage)+", "+g(($=n.device.device)==null?void 0:$.color),1),h("span",Fa,[N(g(e(t)(Number((M=n.device.grade)==null?void 0:M.price)))+" ",1),u(T,{currency:"","use-default":""})])]),h("div",Oa," * "+g(y.$t("preliminary_purchase_price")),1),n.device.totalPriceTopUp?(c(),C("div",Na,[h("span",Ba,g(`${y.$t("additional_checkout_benefit")} ${e(l)?`${y.$t("till")} ${o(e(l))}`:""}`),1),h("span",La,[N(" +"+g(e(t)(n.device.totalPriceTopUp))+" ",1),u(T,{currency:"","use-default":""})])])):P("",!0)])):P("",!0),e(a)?(c(),C("div",Qa,[h("span",Ea,g(y.$t("trade_in_wanted_device")),1),h("div",Aa,[h("span",Ma,g(e(a).name),1),h("span",ja,[N(g(e(t)(e(a).price_with_discount<Number(e(a).price)?e(a).price_with_discount:Number(e(a).price)))+" ",1),u(T,{currency:"","use-default":""})])])])):P("",!0),n.showTotalBenefit&&((k=n.device.grade)!=null&&k.price)?(c(),C("div",Ka,[h("span",Ga,g(y.$t("trade_in_benefit_hint")),1),h("span",Ra,[N(" -"+g(e(t)(Number(n.device.grade.price)+Number(n.device.totalPriceTopUp)))+" ",1),u(T,{currency:"","use-default":""})])])):P("",!0)],2)}}},za=le(Ha,[["__scopeId","data-v-147a11ea"]]),Wa={__name:"TradeInPromoPeriod",props:{from:{type:String,default:""},till:{type:String,default:""}},setup(n){const i=n,t=l=>l.split("-").reverse().join("."),s=S(()=>i.from&&i.till?`${t(i.from)} - ${t(i.till)}`:"");return(l,o)=>e(s)?(c(),C("div",Ft({key:0},{...l.$attrs},{class:"trade-in-promo-period"}),[h("span",null,g(`${l.$t("promotion_period")}: `),1),h("span",null,g(e(s)),1)],16)):P("",!0)}},Ya=le(Wa,[["__scopeId","data-v-f4b645ee"]]),Xa={class:"trade-in-topup-banner_row"},Ja={class:"trade-in-topup-banner_title"},Za={class:"trade-in-topup-banner_row"},en={class:"trade-in-topup-banner_column"},tn={class:"trade-in-topup-banner_text"},an={class:"trade-in-topup-banner_price-text"},nn={key:0,class:"trade-in-topup-banner_column trade-in-topup-banner_column__with-image"},on=["src"],sn={__name:"TradeInTopUpBanner",props:{image:{type:String,default:""},currency:{type:String,default:""},gradings:{type:Array,default:()=>[]}},setup(n){const i=n,{formatPriceWithSpaces:t}=He(),s=S(()=>{var m,T,p;if(!((m=i.gradings)!=null&&m.length)&&!((p=(T=i.gradings)==null?void 0:T.options)!=null&&p.length))return["",""];const a=i.gradings[0].options[0],y=a!=null&&a.validFrom?a.validFrom:"",d=a!=null&&a.validTill?a.validTill:"";return[y,d]}),l=V(s.value[0]),o=V(s.value[1]);return(a,y)=>(c(),C("div",Ft({class:"trade-in-topup-banner"},{...a.$attrs}),[h("div",Xa,[h("p",Ja,g(a.$t("trade_in_top_up_banner_title")),1)]),h("div",Za,[h("div",en,[(c(!0),C(ue,null,Be(n.gradings,(d,m)=>(c(),C(ue,null,[d.name&&d.initialFinalPrice?(c(),C("div",{key:m,class:"trade-in-topup-banner_price-info"},[h("div",tn,g(d.name),1),h("div",an,g(e(t)(d.initialFinalPrice))+" "+g(n.currency),1)])):P("",!0)],64))),256)),u(Ya,{class:"trade-in-topup-banner_promo",from:e(l),till:e(o)},null,8,["from","till"])]),n.image?(c(),C("div",nn,[h("img",{src:n.image,alt:"topup-banner-image",class:"trade-in-topup-banner_image"},null,8,on)])):P("",!0)])],16))}},At=le(sn,[["__scopeId","data-v-41e0253b"]]);function fe(n){var i;return n?!((i=Object.keys(n))!=null&&i.length):!0}function Ne(){return new Date().getTime().toString(36)}const ln=()=>({getAllCategories:async()=>{const{get:t}=We(),{data:s}=await t("api/categories?is_trade_in=1");return{data:s.value}},getSubcategory:async(t,s={})=>{var a;const{get:l}=We(),{data:o}=await l(`api/categories/${t}`,{...s,is_trade_in:1});return(a=o.value)==null?void 0:a.data}}),rn={key:0,class:"trade-in-catalog-device-view"},cn={class:"trade-in-catalog-device-view_device"},un={class:"trade-in-catalog-device-view_device-image-wrapper"},dn={class:"trade-in-catalog-device-view_device-quantity"},vn={class:"trade-in-catalog-device-view_device-info"},mn={class:"trade-in-catalog-device-view_device-name"},pn={class:"trade-in-catalog-device-view_device-article"},_n={key:0},fn={key:1,class:"trade-in-catalog-device-view_prices"},gn={__name:"TradeInCatalogDeviceView",props:{product:{type:Object,required:!0},settings:{type:Boolean,default:!0},productCount:{type:Number,default:1}},setup(n){const i=n,t=S(()=>{var s,l,o;return((o=(l=(s=i.product)==null?void 0:s.variations[0])==null?void 0:l.images)==null?void 0:o[0])??""});return(s,l)=>{const o=ga,a=Et,y=ya;return n.product?(c(),C("div",rn,[h("div",cn,[h("div",un,[u(o,{src:e(t),width:200,height:200,loading:"lazy",class:"trade-in-catalog-device-view_device-image"},null,8,["src"]),h("span",dn,g(n.productCount),1)]),h("div",vn,[h("span",mn,g(n.product.name),1),h("span",pn,g(s.$t("art"))+": "+g(n.product.sku),1)])]),n.product.final_price?(c(),C("div",fn,[n.settings?(c(),O(a,{key:0,options:[{label:s.$t("edit"),onClick:()=>s.$emit("change")},{label:s.$t("delete"),onClick:()=>s.$emit("remove")}]},null,8,["options"])):P("",!0),u(y,{currency:n.product.currency,"total-price":n.product.price,"total-price-discount":n.product.final_price,cat4:n.product.price_cat_4},null,8,["currency","total-price","total-price-discount","cat4"])])):(c(),C("div",_n,g(s.$t("purchase_order_text")),1))])):P("",!0)}}},hn=le(gn,[["__scopeId","data-v-d6a0afec"]]),yn={},bn={class:"trade-in-dialog-title"};function $n(n,i){return c(),C("span",bn,[Xe(n.$slots,"default")])}const he=le(yn,[["render",$n]]),kn={key:1,class:"trade-in-catalog-device_device-view"},wn={key:2,class:"trade-in-catalog-device_preloader"},In={__name:"TradeInCatalogDevice",props:{initialId:{type:String,default:()=>""},initialForm:{type:Object,default:()=>{}},initialProduct:{type:Object,default:()=>{}},initialIndex:{type:Number,required:!0},isTradeInUserDeviceView:{type:Boolean,default:!1},isShownTopUpBanner:{type:Boolean,default:!1},image:{type:String,default:""},currency:{type:String,default:""},gradings:{type:Array,default:()=>[]},verticalPadding:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:i}){const t=n,s=i,l=V(!1),o=V({vendor:"",category:"",feature:"",subcategory:"",storage:"",color:"",product:""}),a=V({vendor:"",category:"",feature:"",subcategory:"",storage:"",color:"",product:"",productId:"",exchangeProduct:null}),y=Pe([]),d=Pe([]),m=Pe([]),T=Pe([]),p=Pe([]),_=Le("modalKeys"),D=V(!1),$=S(()=>t.initialForm.notRequiredFilters!==!0),{addCatalogDevice:M,changeCatalogDevice:k,addCatalogDeviceToLC:x,changeCatalogDeviceToLC:B}=Je(),{getAllCategories:A,getSubcategory:G}=ln(),q=()=>!(t.initialForm&&t.initialProduct&&fe(t.initialForm)===!1&&fe(t.initialProduct)===!1),L=v=>{var f,I;return((I=(f=v==null?void 0:v.find(j=>j.id==="color"))==null?void 0:f.buckets)==null?void 0:I.sort((j,oe)=>j.sort-oe.sort))??[]},w=v=>{const f=q();a.value.product=v,o.value.product=v.name;const I={id:f||t.isTradeInUserDeviceView?Ne():t.initialId,product:a.value.product,form:a.value};s("rememberNewDevice",I)},X=async v=>{var j;if(a.value.color=v,o.value.color=v.name,!v){p.value=[],a.value.product="",o.value.product="";return}const f={};a.value.configuration&&(f["filters[]"]=a.value.configuration.id),a.value.color&&(f["color[]"]=a.value.color.id),l.value=!0;const I=await G(a.value.subcategory.slug,f);l.value=!1,p.value=I==null?void 0:I.products,(I==null?void 0:I.products.length)===1?(a.value.product=p.value[0],o.value.product=(j=p.value[0])==null?void 0:j.name):(a.value.product="",o.value.product="")},W=async(v,f=!0)=>{if(a.value.configuration=v,o.value.configuration=v.name,!v){T.value=[],X("");return}l.value=!0;const I=await G(a.value.subcategory.slug,{"filters[]":v.id});if(l.value=!1,T.value=L(I==null?void 0:I.aggs),f===!1){T.value.length===0&&(p.value=I.products);return}T.value.length===1?X(T.value[0]):await X(""),T.value.length===0&&(p.value=I.products)},_e=(v,f=!0)=>{if(a.value.feature=v,o.value.feature=v.name,!v){m.value=[],W("");return}m.value=v.buckets.sort((I,j)=>I.sort-j.sort),f!==!1&&(m.value.length===1?W(m.value[0]):W(""))},re=async(v,f=!0)=>{var J,ae,se,Q,te,$e;if(a.value.subcategory=v,o.value.subcategory=v.name,!v){d.value=[],_e("");return}l.value=!0;const I=await G(v.slug),j=I==null?void 0:I.features;j.sort((z,Te)=>z.sort-Te.sort),d.value=j,l.value=!1;const oe=L((ae=(J=I==null?void 0:I.data)==null?void 0:J.data)==null?void 0:ae.aggs);if(f===!1){oe.length===0&&d.value.length===0&&(p.value=I.products);return}if(d.value.length===1?_e(d.value[0]):await _e(""),d.value.length===0){if(!oe.length){p.value=(Q=(se=I==null?void 0:I.data)==null?void 0:se.data)==null?void 0:Q.products,((te=p.value)==null?void 0:te.length)===1&&(a.value.product=p.value[0],o.value.product=($e=p.value[0])==null?void 0:$e.name);return}T.value=oe,oe.length===1&&X(oe[0])}},be=v=>{a.value.category=v,v.children.length===1?(a.value.subcategory=v.children[0],re(v.children[0])):re("")};(async()=>{var f,I,j,oe;l.value=!0;const v=await A();if(y.value=(f=v==null?void 0:v.data)==null?void 0:f.data.filter(J=>{var ae;return!!(J!=null&&J.children)&&((ae=J.children)==null?void 0:ae.length)}),q()===!1){const J=$.value===!1;a.value.category=t.initialForm.category,o.value.category=t.initialForm.category.name,(t.initialForm.notRequiredFilters||t.initialForm.isAddedByProductPageBanner)&&(a.value.category.children=(j=(I=v==null?void 0:v.data)==null?void 0:I.data.find(se=>se.id===t.initialForm.category.id))==null?void 0:j.children),await re(t.initialForm.subcategory,J),t.initialForm.feature&&(await _e(t.initialForm.feature,J),await W(t.initialForm.configuration,J)),t.initialForm.color&&await X(t.initialForm.color);const ae=p.value.find(se=>Number(se.id)===Number(t.initialProduct.id));a.value.product=J?t.initialForm.product:ae??t.initialForm.product,o.value.product=J?(oe=t.initialForm.product)==null?void 0:oe.name:(ae==null?void 0:ae.name)??t.initialForm.product.name}l.value=!1})();const E=S(()=>y.value.map(v=>({label:v.name,value:v.name}))),ce=S(()=>{var v,f;return(f=(v=a.value.category)==null?void 0:v.children)==null?void 0:f.map(I=>({label:I.name,value:I.name}))}),Y=S(()=>{var v;return(v=d.value)==null?void 0:v.map(f=>({label:f.name,value:f.name}))}),ne=S(()=>{var v;return(v=m.value)==null?void 0:v.map(f=>({label:f.name,value:f.name}))}),Ie=S(()=>{var v;return(v=T.value)==null?void 0:v.map(f=>({label:f.name,value:f.name}))}),ee=S(()=>{var v;return(v=p.value)==null?void 0:v.map(f=>({label:f.name,value:f.name}))}),qe=()=>{const v=q(),f={id:v||t.isTradeInUserDeviceView?Ne():t.initialId,product:a.value.product,form:a.value};if(t.isTradeInUserDeviceView){s("rememberNewDevice",f),s("close");return}v?(M(f),x(f)):(k(f,t.initialIndex),B(f,t.initialIndex)),s("close")};return Ke(()=>{D.value=!0}),(v,f)=>{const I=Lt,j=Ge,oe=Re,J=et,ae=At,se=ye;return c(),C("div",{class:Ce(["trade-in-catalog-device",{"trade-in-catalog-device__trade-in":n.isTradeInUserDeviceView}])},[h("div",{class:Ce(["trade-in-catalog-device_content",{"trade-in-catalog-device_content__vertical-padding":n.verticalPadding}])},[e(D)?(c(),O(de,{key:0,disabled:!e(D),to:`#${e(_).header}`},[n.isTradeInUserDeviceView?P("",!0):(c(),O(e(he),{key:0,class:"trade-in-catalog-device_title"},{default:U(()=>[N(g(v.$t("trade_in_new_device_title")),1)]),_:1}))],8,["disabled","to"])):P("",!0),u(oe,{class:"trade-in-catalog-device_form"},{default:U(()=>[u(j,null,{default:U(()=>[u(I,{modelValue:e(o).category,"onUpdate:modelValue":[f[0]||(f[0]=Q=>e(o).category=Q),f[1]||(f[1]=Q=>be(e(y).find(te=>te.name===Q)))],disabled:e(l),label:v.$t("trade_in_select_category"),options:e(E)},null,8,["modelValue","disabled","label","options"])]),_:1}),u(j,null,{default:U(()=>[u(I,{modelValue:e(o).subcategory,"onUpdate:modelValue":[f[2]||(f[2]=Q=>e(o).subcategory=Q),f[3]||(f[3]=Q=>re(e(a).category.children.find(te=>te.name===Q)))],disabled:e(l),label:v.$t("trade_in_select_subcategory"),options:e(ce)},null,8,["modelValue","disabled","label","options"])]),_:1}),me(u(j,null,{default:U(()=>[u(I,{modelValue:e(o).feature,"onUpdate:modelValue":[f[4]||(f[4]=Q=>e(o).feature=Q),f[5]||(f[5]=Q=>_e(e(d).find(te=>te.name===Q)))],disabled:e(l),label:v.$t("trade_in_select_features"),options:e(Y)},null,8,["modelValue","disabled","label","options"])]),_:1},512),[[pe,e(d).length]]),me(u(j,null,{default:U(()=>[u(I,{modelValue:e(o).configuration,"onUpdate:modelValue":[f[6]||(f[6]=Q=>e(o).configuration=Q),f[7]||(f[7]=Q=>W(e(m).find(te=>te.name===Q)))],disabled:e(l),label:v.$t("trade_in_select_configuration"),options:e(ne)},null,8,["modelValue","disabled","label","options"])]),_:1},512),[[pe,e(d).length]]),me(u(j,null,{default:U(()=>[u(I,{modelValue:e(o).color,"onUpdate:modelValue":[f[8]||(f[8]=Q=>e(o).color=Q),f[9]||(f[9]=Q=>X(e(T).find(te=>te.name===Q)))],disabled:e(l),label:v.$t("trade_in_select_color"),options:e(Ie)},null,8,["modelValue","disabled","label","options"])]),_:1},512),[[pe,e(T).length]]),me(u(j,null,{default:U(()=>[u(I,{modelValue:e(o).product,"onUpdate:modelValue":[f[10]||(f[10]=Q=>e(o).product=Q),f[11]||(f[11]=Q=>w(e(p).find(te=>te.name===Q)))],disabled:e(l),label:v.$t("trade_in_select_product"),options:e(ee)},null,8,["modelValue","disabled","label","options"])]),_:1},512),[[pe,e(p)&&e(p).length]])]),_:1}),e(o).product?(c(),C("div",kn,[u(hn,{product:e(a).product,settings:!1},null,8,["product"])])):P("",!0),e(l)?(c(),C("div",wn,[u(J,{size:30})])):P("",!0),n.isShownTopUpBanner?(c(),O(ae,{key:3,class:"trade-in-catalog-device_top-up",image:n.image,currency:n.currency,gradings:n.gradings},null,8,["image","currency","gradings"])):P("",!0),e(D)?(c(),O(de,{key:4,disabled:!e(D),to:`#${e(_).footer}`},[u(se,{disabled:!e(a).product||e(l),"full-width":"",onClick:qe},{default:U(()=>[N(g(v.$t("next")),1)]),_:1},8,["disabled"])],8,["disabled","to"])):P("",!0)],2)],2)}}},Tn=le(In,[["__scopeId","data-v-03f0e1c8"]]),Dn={class:"trade-in-add-device"},Pn={class:"trade-in-add-device_description"},Un={__name:"TradeInAddDevice",emits:["nextStep","addDevice"],setup(n){return(i,t)=>{const s=ye;return c(),C("div",Dn,[u(e(he),null,{default:U(()=>[N(g(i.$t("add_trade_in_device")),1)]),_:1}),h("p",Pn,g(i.$t("add_trade_in_device_description")),1),u(s,{"full-width":"",onClick:t[0]||(t[0]=l=>i.$emit("addDevice"))},{default:U(()=>[N(g(i.$t("add_device")),1)]),_:1}),u(s,{secondary:"","full-width":"",onClick:t[1]||(t[1]=l=>i.$emit("nextStep"))},{default:U(()=>[N(g(i.$t("skip")),1)]),_:1})])}}},je="https://api.it4profit.com/api/tin/v1/",tt=n=>{const{locale:i}=Ot(),{get:t,post:s}=We(),l=(p,_)=>{const{vendor:D,category:$,subcategory:M,storage:k,color:x,productId:B}=p;!D||!$||!M||!k||!x||!B||(_[D]||(_[D]={}),_[D][$]||(_[D][$]={}),_[D][$][M]||(_[D][$][M]={}),_[D][$][M][k]||(_[D][$][M][k]={}),_[D][$][M][k][x]||(_[D][$][M][k][x]={productId:B}))};return{getToken:async()=>{var p;try{const{data:_}=await t("api/tokens/trade-in");return(p=_==null?void 0:_.value)==null?void 0:p.data.token}catch(_){return console.error(_),""}},getFirstQuestion:async p=>{try{const _=await t(`${je}site/quest/question`,{token:e(n),deviceId:p,lang:i.value});return _==null?void 0:_.data}catch(_){return console.error(_),null}},getNextQuestion:async(p={})=>{try{return(await s(`${je}site/quest/question`,null,{params:{token:e(n),lang:i.value,c:"",ans:"",...p}})).data}catch(_){return console.error(_),null}},getDeviceById:async p=>{try{return await s(`${je}site/quest/device`,null,{params:{token:e(n),productId:p}})}catch(_){return console.error(_),null}},getProductsTree:async()=>{try{const p=await t(`${je}site/quest/products?token=${e(n)}`),_={};return p.data.value.products.forEach(D=>{l(D,_)}),_}catch(p){return console.error(p),{}}},createTradeInLead:async p=>{try{const{data:_}=await s("api/crm/leads/trade-in",p);return _==null?void 0:_.data}catch(_){return console.error(_),""}}}},Cn={class:"trade-in-form"},qn={class:"trade-in-form_content"},Vn={key:1,class:"trade-in-form_products"},Sn={class:"trade-in-form_total-trade-in"},xn={class:"trade-in-form_total-trade-in-benefit"},Fn={class:"trade-in-form_total-trade-in-benefit-text"},On={key:0,class:"trade-in-form_total-trade-in-benefit-text"},Nn={class:"trade-in-form_total-trade-in-price"},Bn={class:"trade-in-form_total-trade-in-hint"},Ln={__name:"TradeInForm",props:{stepNumber:{type:Number,default:3},profitPrice:{type:Number,default:void 0},catalogDevicesPrice:{type:Number,default:void 0},discount:{type:Number,default:void 0},showUserDevices:{type:Boolean,default:!1}},emits:["submit:success"],setup(n,{emit:i}){const t=n,s=i,{pushGtmEvent:l}=va(),{getErrors:o,defaultRequiredMessage:a}=$a(),{createTradeInLead:y}=tt(),{formatPriceWithSpaces:d}=He(),m=V(!1),T=V(!1),p=Le("modalKeys"),{userDevices:_,catalogDevices:D,userDevicesTotalPrice:$,userDevicesTopUp:M}=Je(),k=D.value.map(R=>({device:{exchangeProduct:R.product}})),x=V([..._.value,...k.slice(_.value.length)]),B=S(()=>$.value-M.value),A=S(()=>t.catalogDevicesPrice>B.value?t.catalogDevicesPrice-$.value:1),G=S(()=>o(W.value.name)),q=S(()=>o(W.value.phone)),L=S(()=>o(W.value.email)),w=da({name:null,phone:null,email:null,dontCallMe:!1,personalAgreement:!0}),X=S(()=>({name:{defaultRequiredMessage:a},phone:{defaultRequiredMessage:a},email:{defaultRequiredMessage:a}})),W=ka(X,w),_e=()=>{var R,E;return(R=W.value)==null||R.$touch(),!((E=W.value)!=null&&E.$invalid)},re=R=>{var E,ce;(ce=(E=W.value)==null?void 0:E[R])==null||ce.$touch()},be=async()=>{var E,ce;if(m.value||!_e()||!w.personalAgreement)return;const R={user:{name:w.name,phone:w.phone,email:w.email},marks:{is_call_back:!w.dontCallMe},trade_in_sets:_.value.map(({grade:Y,...ne})=>({...ne,grade:{...Y,price:ne.totalPriceWithTopUp-ne.totalPriceTopUp}})),crm_ids:D.value.map(Y=>{var ne;return((ne=Y==null?void 0:Y.product)==null?void 0:ne.crm_id)??null}).filter(Y=>!!Y)};l("tradeInSubmit",{currency:(ce=(E=_.value)==null?void 0:E[0])==null?void 0:ce.exchangeProduct.currency,value:t.profitPrice,items:_.value.map(Y=>{var ne;return{old_item_name:Y.device.name||Y.device.subcategory,new_item_name:(ne=Y.exchangeProduct)==null?void 0:ne.name,discount:t.discount,trade_value:Y.totalPriceWithTopUp}})});try{m.value=!0,await y(R),s("submit:success")}catch(Y){console.error(Y)}finally{m.value=!1}};return Ke(()=>{T.value=!0}),(R,E)=>{var J,ae,se,Q,te,$e;const ce=he,Y=za,ne=Ze,Ie=ba,ee=Ge,qe=wa,v=Re,f=Qt,I=et,j=ye,oe=fa;return c(),C("div",Cn,[h("div",qn,[e(T)?(c(),O(de,{key:0,to:`#${e(p).header}`},[u(ce,null,{default:U(()=>[N(g(R.$t("trade_in_form_title")),1)]),_:1})],8,["to"])):P("",!0),n.showUserDevices?(c(),C("div",Vn,[(c(!0),C(ue,null,Be(e(x),(z,Te)=>(c(),C("div",{key:Te,class:"trade-in-form_product"},[u(Y,{device:z,"show-options":!1,"show-total-benefit":!0},null,8,["device"])]))),128)),h("div",Sn,[h("div",xn,[h("p",Fn,[N(g(R.$t("trade_in_benefit"))+" ",1),h("span",null,[N(g(`-${e(d)(e(B))}`)+" ",1),u(ne,{currency:(ae=(J=e(_))==null?void 0:J[0].exchangeProduct)==null?void 0:ae.currency,"use-default":""},null,8,["currency"])])]),e(M)>0?(c(),C("p",On,[N(g(R.$t("trade_in_additional_benefit"))+" ",1),h("span",null,[N(g(`-${e(d)(e(M))}`)+" ",1),u(ne,{currency:(Q=(se=e(_))==null?void 0:se[0].exchangeProduct)==null?void 0:Q.currency,"use-default":""},null,8,["currency"])])])):P("",!0)]),h("p",Nn,[N(g(R.$t("preliminary_total_cost"))+" ",1),h("span",null,[N(g(e(d)(e(A)))+" ",1),u(ne,{currency:($e=(te=e(_))==null?void 0:te[0].exchangeProduct)==null?void 0:$e.currency,"use-default":""},null,8,["currency"])])]),h("p",Bn,g(R.$t("trade_in_benefit_message")),1)])])):P("",!0),u(v,{class:"trade-in-form_fields"},{default:U(()=>[u(ee,null,{default:U(()=>[u(Ie,{modelValue:e(w).name,"onUpdate:modelValue":E[0]||(E[0]=z=>e(w).name=z),label:R.$t("full_name"),disabled:e(m),errors:e(G),"data-attributes":{field:e(w).name},name:"name",required:"",onBlur:E[1]||(E[1]=z=>re("name"))},null,8,["modelValue","label","disabled","errors","data-attributes"])]),_:1}),u(ee,null,{default:U(()=>[u(qe,{modelValue:e(w).phone,"onUpdate:modelValue":E[2]||(E[2]=z=>e(w).phone=z),class:"checkout-input",disabled:e(m),errors:e(q),"data-attributes":{field:e(w).phone},required:"",label:R.$t("phone"),name:"phone",onBlur:E[3]||(E[3]=z=>re("phone"))},null,8,["modelValue","disabled","errors","data-attributes","label"])]),_:1}),u(ee,null,{default:U(()=>[u(Ie,{modelValue:e(w).email,"onUpdate:modelValue":E[4]||(E[4]=z=>e(w).email=z),disabled:e(m),errors:e(L),label:R.$t("email"),required:"","data-attributes":{field:e(w).email},name:"email",type:"email",onBlur:E[5]||(E[5]=z=>re("email"))},null,8,["modelValue","disabled","errors","label","data-attributes"])]),_:1})]),_:1}),u(f,{modelValue:e(w).dontCallMe,"onUpdate:modelValue":E[6]||(E[6]=z=>e(w).dontCallMe=z),disabled:e(m),name:"callback","hide-details":"",class:"trade-in-form_call-back"},{default:U(()=>[N(g(R.$t("dont_call_me")),1)]),_:1},8,["modelValue","disabled"]),e(m)?(c(),O(I,{key:2,size:30,class:"trade-in-form_preloader"})):P("",!0),e(T)?(c(),O(de,{key:3,to:`#${e(p).footer}`},[u(j,{disabled:e(m)||!e(w).personalAgreement,onClick:be,"full-width":""},{default:U(()=>[N(g(R.$t("next")),1)]),_:1},8,["disabled"]),u(oe,{modelValue:e(w).personalAgreement,"onUpdate:modelValue":E[7]||(E[7]=z=>e(w).personalAgreement=z),disabled:e(m),name:"personalAgreement",class:"trade-in-form_form-agree"},null,8,["modelValue","disabled"])],8,["to"])):P("",!0)])])}}},Qn=""+new URL("trade-in-qr.CFiWf_Ia.svg",import.meta.url).href,En={class:"thank-you-info"},An={class:"thank-you-info_content"},Mn={class:"thank-you-info_icon"},jn={class:"thank-you-info_title"},Kn={class:"thank-you-info_qr-info"},Gn={href:"https://diag.nsystools.com/Links/Get",target:"_blank",class:"thank-you-info_qr-link"},Rn={class:"thank-you-info_subtitle"},Hn={__name:"TradeInThankYouDialog",emits:["close"],setup(n,{emit:i}){const t=i;return(s,l)=>{const o=Ye,a=ye;return c(),C("div",En,[h("div",An,[h("div",Mn,[u(o,{icon:"tradeInSuccessIcon"})]),h("div",jn,g(s.$t("trade_in_thank_you_dialog_title")),1),h("div",Kn,[l[1]||(l[1]=h("img",{src:Qn,class:"thank-you-info_qr-image"},null,-1)),h("a",Gn,[u(o,{icon:"downloadIcon"}),N(" "+g(s.$t("download_app_title")),1)]),h("span",Rn,g(s.$t("download_app_description")),1)]),u(a,{"full-width":"",onClick:l[0]||(l[0]=y=>t("close"))},{default:U(()=>[N(g(s.$t("trade_in_thank")),1)]),_:1})])])}}},zn=le(Hn,[["__scopeId","data-v-d865d44b"]]),Wn=n=>{const i=Pe({}),t=V({vendor:"",category:"",subcategory:"",storage:"",color:"",productId:"",exchangeProduct:""}),s=k=>{i.value=k},l=k=>{var L,w,X,W;t.value.color=k;const{vendor:x,category:B,subcategory:A,storage:G}=t.value,q=((W=(X=(w=(L=i.value[x])==null?void 0:L[B])==null?void 0:w[A])==null?void 0:X[G])==null?void 0:W[k])??{};q?t.value.productId=q.productId:t.value.productId=""},o=k=>{var q,L,w;t.value.storage=k;const{vendor:x,category:B,subcategory:A}=t.value,G=Object.keys(((w=(L=(q=i.value[x])==null?void 0:q[B])==null?void 0:L[A])==null?void 0:w[k])??{});G.length===1?l(G[0]):l("")},a=k=>{var G,q;t.value.subcategory=k;const{vendor:x,category:B}=t.value,A=Object.keys(((q=(G=i.value[x])==null?void 0:G[B])==null?void 0:q[k])??{});A.length===1?o(A[0]):o("")},y=k=>{var A;t.value.category=k;const{vendor:x}=t.value,B=Object.keys(((A=i.value[x])==null?void 0:A[k])??{});B.length===1?a(B[0]):a("")},d=k=>{t.value.vendor=k;const x=Object.keys(i.value[k]);x.length===1?y(x[0]):y("")},m=S(()=>{var q,L,w;if(fe(i.value))return[];const{vendor:k,category:x,subcategory:B,storage:A}=t.value;return(w=(L=(q=i.value[k])==null?void 0:q[x])==null?void 0:L[B])!=null&&w[A]?Object.keys(i.value[k][x][B][A]):[]}),T=S(()=>{var G,q;if(fe(i.value))return[];const{vendor:k,category:x,subcategory:B}=t.value;return(q=(G=i.value[k])==null?void 0:G[x])!=null&&q[B]?Object.keys(i.value[k][x][B]):[]}),p=S(()=>{var A;if(fe(i.value))return[];const{vendor:k,category:x}=t.value;return(A=i.value[k])!=null&&A[x]?Object.keys(i.value[k][x]):[]}),_=S(()=>{if(fe(i.value))return[];const{vendor:k}=t.value;return i.value[k]?Object.keys(i.value[k]):[]}),D=S(()=>fe(i.value)?[]:Object.keys(i.value)),$=()=>{t.value.exchangeProduct=null},M=()=>{t.value={vendor:"",category:"",subcategory:"",storage:"",color:"",productId:"",exchangeProduct:""}};return Ue(()=>n,k=>{k&&(t.value={...t.value,...k})},{immediate:!0}),{selectVendor:d,selectCategory:y,selectSubcategory:a,selectStorage:o,selectColor:l,vendors:D,categories:_,subcategories:p,storage:T,colors:m,deviceForm:t,setTradeInProducts:s,resetExchangeProduct:$,resetDeviceForm:M}},Yn=(n,i)=>{const t=V(!1),s=V(null),l=V(null),o=V([]),a=V(0),y=V(!1),d=V(null),m=V(!1);let T=null;const{getFirstQuestion:p,getNextQuestion:_}=tt(n),D=q=>{if(o.value[a.value]===void 0)return!0;const L=o.value[a.value].question;let w=o.value[a.value].answer,X=q;return L.answerType==="MULTISELECT"&&(X=q.map(W=>W.cid).join(),w=L.answer.map(W=>W.cid).join()),L.answerType==="SINGLESELECT"&&(X=q.cid,w=w.cid),X===w?(d.value!==a.value&&a.value++,o.value[a.value]===void 0?(s.value=T,T=null,!1):(s.value=o.value[a.value].question,!1)):(s.value=L,o.value=o.value.slice(0,a.value),T=null,!0)};return{answers:o,question:s,isLoading:t,onMultiselect:async q=>{if(d.value===a.value&&(m.value=!0),t.value||D(q)===!1)return;o.value.push({question:s.value,answer:q}),t.value=!0;const L=q.map(X=>X.cid).join(","),w=await _({deviceId:e(i),questionId:s.value.questionId,c:L});if(!w.value.hasOwnProperty("last")){l.value=w.value,t.value=!1,d.value=a.value,m.value=!0;return}s.value=w.value,t.value=!1,a.value++},onAnswer:async q=>{if(d.value===a.value&&(m.value=!0),t.value)return;const L=q?"Y":"N";if(D(L)===!1)return;o.value.push({question:s.value,answer:L}),t.value=!0;const w=await _({deviceId:e(i),questionId:s.value.questionId,ans:L});if(!w.value.hasOwnProperty("last")){l.value=w.value,t.value=!1,d.value=a.value,m.value=!0;return}s.value=w.value,t.value=!1,a.value++},onSingleSelect:async q=>{if(d.value===a.value&&(m.value=!0),t.value||D(q)===!1)return;o.value.push({question:s.value,answer:q}),t.value=!0;const L=await _({deviceId:e(i),questionId:s.value.questionId,c:q.cid});if(!L.value.hasOwnProperty("last")){l.value=L.value,t.value=!1,d.value=a.value,m.value=!0;return}s.value=L.value,t.value=!1,a.value++},backQuestion:()=>{a.value!==0&&(T===null&&(T=s.value),a.value--,s.value=o.value[a.value].question)},initQuestions:async()=>{a.value=0,o.value=[];const q=await p(e(i));s.value=q.value,s.value||(y.value=!0)},finishDeviceGrade:l,lastQuestionIndex:d,isLastQuestion:m,resetIsLastQuestion:()=>{m.value=!1},currentQuestionIndex:a,isRequestError:y,resetLastQuestionIndex:()=>{d.value=null}}},Xn=["innerHTML"],at={__name:"TradeInQuestionDescription",props:{description:{type:String,default:""}},setup(n){return(i,t)=>(c(),C("div",{class:"trade-in-question-description",innerHTML:n.description},null,8,Xn))}},Jn={class:"trade-in-answer_buttons"},Zn={__name:"TradeInAnswer",props:{question:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1}},setup(n){return(i,t)=>{const s=Ge,l=ye,o=Re;return c(),O(o,{class:"trade-in-answer"},{default:U(()=>[u(s,null,{default:U(()=>[u(he,null,{default:U(()=>[N(g(n.question.question),1)]),_:1})]),_:1}),u(s,null,{default:U(()=>[n.question.description?(c(),O(at,{key:0,description:n.question.description},null,8,["description"])):P("",!0)]),_:1}),h("div",Jn,[u(l,{secondary:"","full-width":"",loading:n.loading,onClick:t[0]||(t[0]=a=>i.$emit("yes"))},{default:U(()=>[N(g(i.$t("yes")),1)]),_:1},8,["loading"]),u(l,{secondary:"","full-width":"",loading:n.loading,onClick:t[1]||(t[1]=a=>i.$emit("no"))},{default:U(()=>[N(g(i.$t("no")),1)]),_:1},8,["loading"])])]),_:1})}}},eo=le(Zn,[["__scopeId","data-v-be898a7c"]]),to={class:"trade-in-single-select"},ao={class:"trade-in-single-select_options"},no={class:"trade-in-single-select_option-label"},oo={class:"trade-in-single-select_option-name"},io=["innerHTML"],so={__name:"TradeInSingleSelect",props:{question:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:i}){const t=n,s=V(null),l=V(null),o=Le("modalKeys"),a=()=>{s.value=t.question.options.find(y=>y.cid===l.value)};return(y,d)=>{const m=Ia,T=ye;return c(),C("div",to,[(c(),O(de,{to:`#${e(o).header}`},[u(e(he),null,{default:U(()=>[N(g(n.question.question),1)]),_:1})],8,["to"])),n.question.description?(c(),O(e(at),{key:0,description:n.question.description},null,8,["description"])):P("",!0),h("div",ao,[(c(!0),C(ue,null,Be(n.question.options,(p,_)=>(c(),O(m,{key:_,modelValue:e(l),"onUpdate:modelValue":d[0]||(d[0]=D=>Nt(l)?l.value=D:null),checked:e(l)===p.cid,disabled:y.isLoading,name:p.cname,value:p.cid,class:"trade-in-single-select_option",onChange:D=>a(p.cid)},{label:U(()=>[h("div",no,[h("h4",oo,g(p.cname),1),p.description?(c(),C("p",{key:0,class:"trade-in-single-select_option-description",innerHTML:p.description},null,8,io)):P("",!0)])]),_:2},1032,["modelValue","checked","disabled","name","value","onChange"]))),128))]),(c(),O(de,{to:`#${e(o).footer}`},[u(T,{disabled:!e(s),"full-width":"",loading:n.loading,class:"trade-in-single-select_next-button",onClick:d[1]||(d[1]=p=>y.$emit("update:modelValue",e(s)))},{default:U(()=>[N(g(y.$t("next")),1)]),_:1},8,["disabled","loading"])],8,["to"]))])}}},lo=xt({name:"TradeInQuestionContent"}),ro={class:"question-content"};function co(n,i,t,s,l,o){return c(),C("div",ro,[Xe(n.$slots,"default",{},void 0,!0)])}const uo=le(lo,[["render",co],["__scopeId","data-v-d312f3b6"]]),vo={class:"trade-in-multi-select"},mo={__name:"TradeInMultiselect",props:{question:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1}},setup(n){const i=l=>t.value.find(o=>o.cid===l),t=V([]),s=l=>{i(l.cid)?t.value=t.value.filter(o=>o.cname!==l.cname):t.value.push(l)};return(l,o)=>{const a=Qt,y=ye;return c(),C("div",vo,[u(e(he),null,{default:U(()=>[N(g(n.question.question),1)]),_:1}),n.question.description?(c(),O(e(at),{key:0,description:n.question.description},null,8,["description"])):P("",!0),u(e(uo),null,{default:U(()=>[(c(!0),C(ue,null,Be(n.question.options,d=>(c(),O(a,{key:d.cid,disabled:n.loading,name:d.cname,value:i(d.cid),onOnChange:m=>s(d)},{default:U(()=>[N(g(d.cname),1)]),_:2},1032,["disabled","name","value","onOnChange"]))),128))]),_:1}),u(y,{disabled:!e(t).length,"full-width":"",loading:n.loading,onClick:o[0]||(o[0]=d=>l.$emit("next",e(t)))},{default:U(()=>[N(g(l.$t("next")),1)]),_:1},8,["disabled","loading"])])}}},po=le(mo,[["__scopeId","data-v-f9a2dd82"]]),_o={key:0,class:"trade-in-device-grade"},fo={class:"trade-in-device-grade_content"},go={class:"trade-in-device-grade_back-button-text"},ho={key:1,class:"trade-in-device-grade_device-info"},yo={class:"trade-in-device-grade_device-name"},bo={class:"trade-in-device-grade_device-price"},$o={key:2,class:"trade-in-device-grade_device-hint"},ko={key:3,class:"trade-in-device-grade_preloader"},wo={class:"trade-in-device-grade_error-message"},Io={__name:"TradeInDeviceGrade",props:{initialUserDevice:{type:Object,default:()=>{}},exchangeItems:{type:Array,default:()=>[]},showUserDevices:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:i}){var ct;const t=n,s=i,{formatPriceWithSpaces:l}=He(),o=ma(),{t:a}=Ot(),y=V(""),d=V(1),m=V(null),T=V(t.initialUserDevice.productCounter),p=V(!1),_=V(null),D=V(!1),$=V("device"),M=V(!1),k=o.name.includes("trade-in"),x=o.name.includes("product"),B=V(!1),A=V(null),G=V(null),q=Le("modalKeys"),{addUserDevice:L,changeUserDevice:w,addCatalogDevice:X,addCatalogDeviceToLC:W,setExternalProductsTree:_e,externalProductsTree:re,userDevices:be,resetUserDevices:R,catalogDevices:E}=Je(),{answers:ce,currentQuestionIndex:Y,isLoading:ne,initQuestions:Ie,question:ee,onMultiselect:qe,onAnswer:v,onSingleSelect:f,backQuestion:I,finishDeviceGrade:j,isRequestError:oe,isLastQuestion:J,resetIsLastQuestion:ae,resetLastQuestionIndex:se}=Yn(y,_),{getToken:Q,getProductsTree:te,getDeviceById:$e}=tt(y),z=S(()=>{var r,b,Z,ie;return((ie=(Z=(b=(r=m.value)==null?void 0:r.data)==null?void 0:b.buyoutTopUp)==null?void 0:Z.specialGrading)==null?void 0:ie.filter(K=>K.name))||[]}),Te=S(()=>be.value.reduce((r,b)=>{const Z=b!=null&&b.totalPriceWithTopUp?Number(b.totalPriceWithTopUp):0;return r+Z},0)),nt=S(()=>t.initialUserDevice.product.final_price*t.initialUserDevice.productCounter),Mt=S(()=>$.value!=="select_device"&&$.value!=="form_step"&&$.value!=="success_step"),jt=S(()=>{const r=(nt.value??0)-(Te.value||0);return r>0?r:1}),Kt=()=>{R(),$.value="success_step",d.value++},Gt=()=>{var K,ve;const r=(K=m.value)==null?void 0:K.data,b=(ve=r==null?void 0:r.buyoutTopUp)==null?void 0:ve.specialGrading;if(!b){r.buyoutTopUp.specialGrading=[];return}const Z=Number((r==null?void 0:r.instantAmount)??0),ie=Number((r==null?void 0:r.price)??0);b.forEach(ke=>{var we;const De=Number(((we=ke.grades[0])==null?void 0:we.price)??0);ke.initialFinalPrice=Z+ie+De})},{selectVendor:Rt,selectCategory:Ht,selectSubcategory:zt,selectStorage:Wt,selectColor:Yt,vendors:Xt,categories:Jt,subcategories:Zt,storage:ea,colors:ta,setTradeInProducts:ot,deviceForm:F,resetExchangeProduct:aa,resetDeviceForm:na}=Wn((ct=t.initialUserDevice)==null?void 0:ct.device),Ve=r=>r.map(b=>({label:b,value:b})),it=S(()=>Ve(Xt.value)),oa=S(()=>Ve(Jt.value)),ia=S(()=>Ve(Zt.value)),sa=S(()=>Ve(ea.value)),la=S(()=>Ve(ta.value)),st=V((()=>{var b,Z,ie,K;const r=[...t.exchangeItems];return(b=t.initialUserDevice)!=null&&b.exchangeProduct&&((Z=t.initialUserDevice)!=null&&Z.exchange_device_sku)?(r.unshift({...(ie=t.initialUserDevice)==null?void 0:ie.exchangeProduct}),F.value.exchangeProduct=(K=t.initialUserDevice)==null?void 0:K.exchangeProduct):aa(),k&&r.push({name:`+ ${a("trade_in_new_device_title")}`,id:"add_new_device"}),r})()),ra=S(()=>st.value.map(r=>({label:r==null?void 0:r.name,value:r==null?void 0:r.name}))),Qe=async r=>{var b,Z;m.value=await $e(r),_.value=(Z=(b=m.value)==null?void 0:b.data)==null?void 0:Z.deviceId,Gt(),await Ie()};(async()=>{if(y.value=await Q(),y.value||(M.value=!0),!fe(re.value)){ot(re.value),F.value.productId&&(D.value=!0,await Qe(F.value.productId),D.value=!1);return}D.value=!0;const r=await te();r||(M.value=!0),_e(r),ot(r),D.value=!1})();const ca=()=>{$.value="device",T.value--,p.value=!1,na(),ae(),se()},Se=async()=>{var r;if($.value==="device"){if(((r=t.exchangeItems)!=null&&r.length||k)&&!x){$.value="exchange";return}D.value=!0,await Qe(F.value.productId),D.value=!1,$.value="questions"}$.value==="exchange"&&($.value="questions",D.value=!0,await Qe(F.value.productId),D.value=!1),$.value==="add_device"&&($.value="form_step")},ua=()=>{var r;if((r=t.exchangeItems)!=null&&r.length&&$.value==="questions"&&Y.value===0){$.value="exchange";return}if($.value==="add_device"){$.value="questions",p.value=!0,ae();return}$.value==="exchange"||Y.value===0?$.value="device":I()},xe=S(()=>D.value||ne.value),Ee=S(()=>{var r;return!!((r=z.value)!=null&&r.length&&!xe.value)}),lt=r=>{A.value=r},rt=r=>{var b;F.value.exchangeProduct=(b=st.value)==null?void 0:b.find(Z=>Z.name===r)};return Ue(()=>{var r;return(r=F.value)==null?void 0:r.productId},async r=>{r?(D.value=!0,await Qe(r),D.value=!1):(m.value=null,_.value=null)}),Ue($,r=>{r==="questions"&&x&&(rt(t.initialUserDevice.product.name),G.value=t.initialUserDevice.product.name)}),Ue(oe,r=>{r&&(M.value=!0)}),Ue(()=>j.value,r=>{var ke,De,we,Fe,Oe,Ae,Me;if(!r)return;let b=null,Z=null,ie=null;if(t.showUserDevices)b=T.value?(De=(ke=F.value)==null?void 0:ke.exchangeProduct)==null?void 0:De.sku:null,Z=T.value?(we=F.value)==null?void 0:we.exchangeProduct:null,ie=T.value?F.value:{...F.value,exchangeProduct:null};else{const ge=((Fe=A.value)==null?void 0:Fe.product)||((Oe=F.value)==null?void 0:Oe.exchangeProduct);b=ge==null?void 0:ge.sku,Z=ge,ie=F.value}const K={grade:r.device,device:ie,exchange_device_sku:b,exchangeProduct:Z,initialGrade:m.value,answers:ce.value};((Me=(Ae=K.device)==null?void 0:Ae.exchangeProduct)==null?void 0:Me.id)==="add_new_device"&&(K!=null&&K.exchangeProduct)&&(K.device.exchangeProduct=K.exchangeProduct);const ve=be.value[be.value.length-1];if(t.showUserDevices){if(p.value?w({...K,id:ve.id}):L({...K,id:Ne()}),!E.value.length){const ge={id:Ne(),product:t.initialUserDevice.product};X(ge,t.initialUserDevice.productCounter)}}else fe(t.initialUserDevice)?L({...K,id:Ne()}):w({...K,id:t.initialUserDevice.id});A.value&&(X(A.value),W(A.value)),A.value=null,x||s("close")}),Ue(J,r=>{r&&x&&($.value="add_device")}),Ke(()=>{B.value=!0}),Bt(()=>{x&&R()}),(r,b)=>{var ut,dt,vt,mt,pt,_t,ft,gt,ht,yt,bt,$t,kt,wt,It,Tt,Dt,Pt,Ut,Ct,qt,Vt,St;const Z=Ye,ie=ye,K=Lt,ve=Ge,ke=Re,De=Ze,we=et,Fe=At,Oe=Tn,Ae=Un,Me=Ln,ge=zn;return c(),C(ue,null,[e(Mt)?(c(),C("div",_o,[h("div",fo,[e(B)?(c(),O(de,{key:0,to:`#${e(q).header}`},[me(u(ie,{class:"trade-in-device-grade_back-button",onClick:ua},{default:U(()=>[u(Z,{icon:"chevronLeftIcon"}),h("span",go,g(r.$t("back")),1)]),_:1},512),[[pe,e($)!=="device"]])],8,["to"])):P("",!0),e($)==="device"?(c(),C(ue,{key:1},[e(B)?(c(),O(de,{key:0,to:`#${e(q).header}`},[u(e(he),{class:"trade-in-device-grade_title"},{default:U(()=>[N(g(r.$t("trade_in_old_device_title")),1)]),_:1})],8,["to"])):P("",!0),u(ke,{class:"trade-in-device-grade_form"},{default:U(()=>[u(ve,null,{default:U(()=>{var H;return[u(K,{modelValue:e(F).vendor,"onUpdate:modelValue":[b[0]||(b[0]=ze=>e(F).vendor=ze),b[1]||(b[1]=ze=>e(Rt)(ze))],label:r.$t("trade_in_select_vendor"),options:e(it),disabled:((H=e(it))==null?void 0:H.length)===0},null,8,["modelValue","label","options","disabled"])]}),_:1}),me(u(ve,null,{default:U(()=>[u(K,{modelValue:e(F).category,"onUpdate:modelValue":[b[2]||(b[2]=H=>e(F).category=H),b[3]||(b[3]=H=>e(Ht)(H))],label:r.$t("trade_in_select_category"),options:e(oa)},null,8,["modelValue","label","options"])]),_:1},512),[[pe,e(F).vendor]]),me(u(ve,null,{default:U(()=>[u(K,{modelValue:e(F).subcategory,"onUpdate:modelValue":[b[4]||(b[4]=H=>e(F).subcategory=H),b[5]||(b[5]=H=>e(zt)(H))],label:r.$t("trade_in_select_subcategory"),options:e(ia)},null,8,["modelValue","label","options"])]),_:1},512),[[pe,e(F).vendor]]),me(u(ve,null,{default:U(()=>[u(K,{modelValue:e(F).storage,"onUpdate:modelValue":[b[6]||(b[6]=H=>e(F).storage=H),b[7]||(b[7]=H=>e(Wt)(H))],label:r.$t("trade_in_select_configuration"),options:e(sa)},null,8,["modelValue","label","options"])]),_:1},512),[[pe,e(F).category]]),me(u(ve,null,{default:U(()=>[u(K,{modelValue:e(F).color,"onUpdate:modelValue":[b[8]||(b[8]=H=>e(F).color=H),b[9]||(b[9]=H=>e(Yt)(H))],label:r.$t("trade_in_select_color"),options:e(la)},null,8,["modelValue","label","options"])]),_:1},512),[[pe,e(F).subcategory]])]),_:1}),e(m)?(c(),C("div",ho,[h("div",yo,g(e(F).subcategory)+", "+g(e(F).storage)+", "+g(e(F).color),1),h("span",bo,[N(g(e(l)(Number(((dt=(ut=e(m))==null?void 0:ut.data)==null?void 0:dt.price)??0)))+" ",1),u(De,{currency:(mt=(vt=e(m))==null?void 0:vt.data)==null?void 0:mt.currency,"use-default":""},null,8,["currency"])])])):P("",!0),(pt=e(m))!=null&&pt.data?(c(),C("div",$o,g(r.$t("trade_in_old_device_hint")),1)):P("",!0),e(xe)?(c(),C("div",ko,[u(we,{size:30})])):P("",!0),e(Ee)?(c(),O(Fe,{key:4,class:"trade-in-device-grade_top-up",image:(ft=(_t=e(m))==null?void 0:_t.data)==null?void 0:ft.tradeinThumbnail,currency:(ht=(gt=e(m))==null?void 0:gt.data)==null?void 0:ht.currency,gradings:e(z)},null,8,["image","currency","gradings"])):P("",!0),e(B)?(c(),O(de,{key:5,disabled:e($)!=="device",to:`#${e(q).footer}`},[u(ie,{disabled:!e(m),"full-width":"",onClick:Se},{default:U(()=>[N(g(r.$t("next")),1)]),_:1},8,["disabled"])],8,["disabled","to"])):P("",!0)],64)):P("",!0),e($)==="exchange"?(c(),C(ue,{key:2},[e(B)?(c(),O(de,{key:0,to:`#${e(q).header}`},[u(e(he),{class:"trade-in-device-grade_exchange-title"},{default:U(()=>[N(g(r.$t("trade_in_exchange_title")),1)]),_:1})],8,["to"])):P("",!0),u(K,{modelValue:e(G),"onUpdate:modelValue":[b[10]||(b[10]=H=>Nt(G)?G.value=H:null),rt],label:r.$t("trade_in_exchange_product_label"),options:e(ra)},null,8,["modelValue","label","options"]),((bt=(yt=e(F))==null?void 0:yt.exchangeProduct)==null?void 0:bt.id)==="add_new_device"?(c(),O(Oe,{key:e(F).exchangeProduct||"","is-shown-top-up-banner":e(Ee),image:(kt=($t=e(m))==null?void 0:$t.data)==null?void 0:kt.tradeinThumbnail,currency:(It=(wt=e(m))==null?void 0:wt.data)==null?void 0:It.currency,gradings:e(z),"initial-index":-1,"is-trade-in-user-device-view":"",onRememberNewDevice:lt,onClose:Se},null,8,["is-shown-top-up-banner","image","currency","gradings"])):(c(),C(ue,{key:2},[e(Ee)?(c(),O(Fe,{key:0,class:"trade-in-device-grade_exchange-top-up",image:(Dt=(Tt=e(m))==null?void 0:Tt.data)==null?void 0:Dt.tradeinThumbnail,currency:(Ut=(Pt=e(m))==null?void 0:Pt.data)==null?void 0:Ut.currency,gradings:e(z)},null,8,["image","currency","gradings"])):P("",!0),e(B)?(c(),O(de,{key:1,to:`#${e(q).footer}`},[u(ie,{disabled:!e(m),"full-width":"",class:"trade-in-device-grade_next-button",onClick:Se},{default:U(()=>[N(g(r.$t("next")),1)]),_:1},8,["disabled"])],8,["to"])):P("",!0)],64))],64)):P("",!0),e($)==="questions"&&e(ee)&&!e(M)?(c(),C(ue,{key:3},[e(ee)&&e(ee).answerType==="SINGLESELECT"?(c(),O(e(so),{key:e(ee).questionId,question:e(ee),loading:e(xe),"onUpdate:modelValue":e(f)},null,8,["question","loading","onUpdate:modelValue"])):P("",!0),e(ee)&&e(ee).answerType==="YN"?(c(),O(e(eo),{key:e(ee).questionId,loading:e(xe),question:e(ee),onYes:b[11]||(b[11]=H=>e(v)(!0)),onNo:b[12]||(b[12]=H=>e(v)(!1))},null,8,["loading","question"])):P("",!0),e(ee)&&e(ee).answerType==="MULTISELECT"?(c(),O(po,{key:e(ee).questionId,loading:e(xe),question:e(ee),onNext:e(qe)},null,8,["loading","question","onNext"])):P("",!0)],64)):P("",!0),e($)==="add_device"?(c(),O(Ae,{key:4,onAddDevice:ca,onNextStep:Se})):P("",!0),me(h("div",wo,[h("span",null,g(r.$t("request_later")),1)],512),[[pe,e(M)]])])])):P("",!0),e($)==="select_device"?(c(),O(Oe,{key:e(F).exchangeProduct||"","initial-id":n.initialUserDevice.id,"initial-form":n.initialUserDevice.form,"initial-product":n.initialUserDevice.product,"initial-index":-1,"is-shown-top-up-banner":e(Ee),image:(qt=(Ct=e(m))==null?void 0:Ct.data)==null?void 0:qt.tradeinThumbnail,currency:(St=(Vt=e(m))==null?void 0:Vt.data)==null?void 0:St.currency,gradings:e(z),"vertical-padding":"",onRememberNewDevice:lt,onClose:Se},null,8,["initial-id","initial-form","initial-product","is-shown-top-up-banner","image","currency","gradings"])):P("",!0),e($)==="form_step"?(c(),O(Me,{key:e(d),"profit-price":e(jt),"catalog-devices-price":e(nt),discount:e(Te),"show-user-devices":n.showUserDevices,"onSubmit:success":Kt},null,8,["profit-price","catalog-devices-price","discount","show-user-devices"])):P("",!0),e($)==="success_step"?(c(),O(ge,{key:3,onClose:b[13]||(b[13]=H=>s("close"))})):P("",!0)],64)}}},Ro=le(Io,[["__scopeId","data-v-77396ef2"]]),To=["id"],Do=["id"],Po={__name:"trade-in-modal",props:{value:{type:Boolean,required:!0},maxWidth:{type:Number,required:!0}},setup(n){const i=Le("modalKeys"),t=V(null),s=V(null),l=V(!1),o=V(!1),a=()=>{if(!s.value)return;const{clientHeight:d,scrollHeight:m}=s.value;m>d||(l.value=!1,o.value=!1)},y=d=>{const{scrollTop:m,clientHeight:T,scrollHeight:p}=d.target;l.value=m>0,o.value=m+T<p};return Ke(()=>{s.value&&(t.value=new ResizeObserver(()=>{a()}),t.value.observe(s.value))}),Bt(()=>{var d;(d=t.value)==null||d.disconnect()}),(d,m)=>{const T=Ta;return c(),O(T,pa(_a({...d.$attrs,...d.$props})),{default:U(()=>{var p,_;return[h("div",{class:"trade-in-modal",ref_key:"modalRef",ref:s,onScroll:y},[h("div",{class:Ce(["trade-in-modal_header",{"trade-in-modal_header__shadow":e(l)}]),id:(p=e(i))==null?void 0:p.header},null,10,To),h("div",null,[Xe(d.$slots,"default",{},void 0,!0)]),h("div",{class:Ce(["trade-in-modal_footer",{"trade-in-modal_footer__shadow":e(o)}])},[h("div",{id:(_=e(i))==null?void 0:_.footer},null,8,Do)],2)],544)]}),_:3},16)}}},Ho=le(Po,[["__scopeId","data-v-eb0dbc9e"]]);export{Ro as T,za as _,Ho as a,Et as b,Ya as c,hn as d,Tn as e,zn as f,Ln as g};
