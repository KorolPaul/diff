import{u as Z,a as H,_ as ce}from"./BoW1LxkV.js";import{_ as J}from"./C3QHuKV1.js";import{T as Q,r as A,x as C,Z as W,w as z,c as M,m as t,o as d,D as X,q as ee,_ as P,d as te,j as b,t as S,F as q,L as oe,y as L,b as de,S as me,l as F,k as T,z as U,B as Y,A as pe,ad as _e,a6 as fe,a7 as ge,aa as ne,g as ve,G as he,u as be}from"./Pd6RrLp1.js";import{_ as ye}from"./DK9X1TaX.js";import{u as $e,a as ke}from"./B64m7KbU.js";import{u as Fe}from"./CiYsyl20.js";import{_ as we}from"./BeTDdiTI.js";import{_ as Ae}from"./qKLLgZOX.js";import{_ as xe}from"./gj_0ZWSo.js";const Ee={__name:"login-text-field",props:{value:{type:String,default:null},disabled:{type:Boolean,default:!1},errorMessages:{type:Array,default:()=>[]},type:{type:String,default:""},dataAttributes:{type:Object,default:()=>({})},label:{type:String,default:""}},emits:["input","keyup"],setup(o,{emit:r}){const n=o,{pushGtmEvent:$}=ee(),m=r,a=Q("isShowLoginModal"),i=A(null),_=A(null),g=C(()=>{if((n==null?void 0:n.type)==="email")return!1;if((n==null?void 0:n.type)==="phone")return!0;const s=v=>/^\d+$/.test(v),{value:l}=n;return s(l[0])||s(l[1])||n.value[0]==="+"}),w=C(()=>!n.value&&!n.type?"phone_or_email":g.value?"phone_number":"email_address"),{defaultRequiredMessage:B,defaultPhoneRequiredMessage:R,emailPattern:x,getErrors:I}=Z(),E=s=>{var l,v;(v=(l=p.value)==null?void 0:l[s])==null||v.$touch(),s==="phone"&&V.value.length===0&&$("phoneFilled",f.value),s==="email"&&V.value.length===0&&$("emailFilled",f.value)},u=C(()=>({email:g.value?{}:{defaultRequiredMessage:B,emailPattern:x},phone:g.value?{defaultRequiredMessage:B,defaultPhoneRequiredMessage:R}:{}})),p=H(u,{email:W(n,"value"),phone:W(n,"value")}),k=C(()=>I(p.value.email)),V=C(()=>I(p.value.phone)),f=C({get(){return n.value||""},set(s){m("input",s)}});return z(g,()=>{g.value?setTimeout(()=>{var s;return(s=i==null?void 0:i.value)==null?void 0:s.$el.focus()}):setTimeout(()=>{var s;return(s=_==null?void 0:_.value)==null?void 0:s.$el.focus()})}),z(()=>a==null?void 0:a.value,()=>{var s,l,v,y;a!=null&&a.value||((l=(s=p.value)==null?void 0:s.phone)==null||l.$reset(),(y=(v=p.value)==null?void 0:v.email)==null||y.$reset())}),(s,l)=>{const v=ce,y=J;return t(g)?(d(),M(v,{key:0,ref_key:"phoneRef",ref:i,modelValue:t(f),"onUpdate:modelValue":l[0]||(l[0]=h=>X(f)?f.value=h:null),disabled:o.disabled,errors:[...o.errorMessages,...t(V)],label:t(w),"data-attributes":o.dataAttributes,required:"",onBlur:l[1]||(l[1]=h=>E("phone")),onKeyup:l[2]||(l[2]=h=>s.$emit("keyup",h))},null,8,["modelValue","disabled","errors","label","data-attributes"])):(d(),M(y,{key:1,ref_key:"emailRef",ref:_,modelValue:t(f),"onUpdate:modelValue":l[3]||(l[3]=h=>X(f)?f.value=h:null),disabled:o.disabled,errors:[...o.errorMessages,...t(k)],label:t(w),required:"","data-attributes":o.dataAttributes,type:"email",onBlur:l[4]||(l[4]=h=>E("email")),onKeyup:l[5]||(l[5]=h=>s.$emit("keyup",h))},null,8,["modelValue","disabled","errors","label","data-attributes"]))}}},Ce=te({name:"AppFormErrors",props:{errors:{type:Array,default:null}}}),Se={key:0,class:"app-form-errors"};function Ie(o,r,n,$,m,a){return o.errors?(d(),b("div",Se,[(d(!0),b(q,null,oe(o.errors,(i,_)=>(d(),b("div",{key:_},L(o.$t(i)),1))),128))])):S("",!0)}const Ve=P(Ce,[["render",Ie]]),Be={class:"login-form"},Le={class:"login-form_buttons"},Te={key:1,class:"login-form_back"},Pe={__name:"login-form",props:{defaultForm:{type:Object,default:()=>{}}},emits:["change","failed","success","change:loading"],setup(o,{emit:r}){const n={login:"",loginType:"email",nda:!1,remember:!0,personalAgreement:!1,name:""},$=o,m=A(!1),a=r,{pushGtmEvent:i}=ee(),{locale:_}=de(),g=A([]),w=A([]),{sendCode:B,signUp:R}=$e(),{isLoading:x,startLoading:I,stopLoading:E}=Fe(),u=me({...Object.assign(n,$.defaultForm)}),{getErrors:p,defaultRequiredMessage:k}=Z(),V=C(()=>({name:m.value?{defaultRequiredMessage:k}:{}})),f=H(V,u,{$stopPropagation:!0});function s(){f.value.name.$touch(),i("nameFilled",u.name)}const l=()=>{var e,c;return(e=f.value)==null||e.$touch(),!((c=f.value)!=null&&c.$invalid)},v=C(()=>p(f.value.name)),y=e=>{(e.name==="email"||e.name==="login")&&w.value.push(e.message),e.length===0&&(w.value=[],v.value=[])},h=e=>{g.value=[],e.forEach(c=>{(c.includes("You don't have an account")||c.includes("Phone is not supported"))&&(m.value=!0),typeof c=="object"?y(c):g.value.push(c)})},ae=e=>{typeof e=="string"&&(e.includes("+")?u.login=e.replaceAll(/[- ]/g,""):u.login=e,h([]),y([]))},se=()=>{m.value=!1,h([]),y([])},G=async()=>{var e;if(!x.value&&l()){I(),a("change:loading",!0);const c=await B(u.login);((e=c==null?void 0:c.status)==null?void 0:e.value)==="success"?a("success",u):(a("failed",u),h(c)),E(),a("change:loading",!1)}},K=async()=>{var j,D,N;if(x.value)return;I(),a("change:loading",!0);const e={name:u.name,phone:u.phone,country:u.country,language:_,login:u.login},c=await R(e);E(),a("change:loading",!1),c.status.value==="success"?(i("registerNewUser"),a("success",u)):(h((N=(D=(j=c.error.value)==null?void 0:j.data)==null?void 0:D.errors)==null?void 0:N.name),a("failed",u))};function le(e){e.preventDefault(),e.key==="Enter"&&G()}function re(e){e.preventDefault(),e.key==="Enter"&&K()}return(e,c)=>{const j=Ee,D=J,N=ye,ie=Ve,ue=pe;return d(),b("div",Be,[F(N,{class:"login-form_fields"},{default:U(()=>[F(j,{disabled:t(x),value:t(u).login,"error-messages":t(w),"data-attributes":{field:t(u).loginType},onInput:ae,onKeyup:le},null,8,["disabled","value","error-messages","data-attributes"]),t(m)?(d(),M(D,{key:0,modelValue:t(u).name,"onUpdate:modelValue":c[0]||(c[0]=O=>t(u).name=O),label:e.$t("name"),errors:t(v),name:"name",required:"",onBlur:s,onKeyup:re},null,8,["modelValue","label","errors"])):S("",!0)]),_:1}),t(g).length>0&&!t(m)?(d(),M(ie,{key:0,errors:t(g),class:"login-form_errors"},null,8,["errors"])):S("",!0),T("div",Le,[F(ue,{disabled:t(x),loading:t(x),fullwidth:"",class:"login-form_submit",onClick:c[1]||(c[1]=O=>t(m)?K():G())},{default:U(()=>[Y(L(e.$t("next")),1)]),_:1},8,["disabled","loading"])]),t(m)?(d(),b("div",Te,[Y(L(e.$t("already_have_an_account"))+" ",1),T("button",{class:"login-form_back-button",onClick:_e(se,["prevent"])},L(e.$t("login")),1)])):S("",!0)])}}},Re=P(Pe,[["__scopeId","data-v-c22470b6"]]),Ue={key:0,class:"auth-social-list"},Me={key:0},je=["onClick"],De={__name:"auth-social-list",props:{authProviders:{type:Object,default:()=>({})}},setup(o){const r=[{icon:"authApple",id:"apple",title:"Apple"},{icon:"authGoogle",id:"google",title:"Google"},{icon:"authFacebook",id:"facebook",title:"Facebook"}],n=async $=>{var m,a;try{const i=await ke.loginWithSocialProvider($),_=(a=(m=i==null?void 0:i.data)==null?void 0:m.data)==null?void 0:a.redirect_url;_&&window.location.replace(_)}catch(i){console.error(i)}};return($,m)=>{const a=Ae;return r?(d(),b("div",Ue,[(d(),b(q,null,oe(r,i=>(d(),b(q,{key:i.id},[o.authProviders[i.id]?(d(),b("div",Me,[T("button",{class:"auth-social-list_item",type:"button",onClick:_=>n(i.id)},[F(a,{class:"auth-social-list_item-icon",icon:i.icon},null,8,["icon"])],8,je)])):S("",!0)],64))),64))])):S("",!0)}}},Ne=`${ge}site-info`,qe={async getSiteInfo(){const{get:o}=fe(),{data:r}=await o(`${Ne}`);return{data:r.value}}},Ge={class:"auth-modal-content"},Ke={key:0,class:"auth-modal-content_divider"},Oe={class:"auth-modal-content_personal-data"},We={__name:"auth-modal-content",props:{mode:{type:String,default:null}},setup(o){const r=A({});return qe.getSiteInfo().then(n=>{r.value=n.data.data.auth_providers}),(n,$)=>{const m=we;return d(),b("div",Ge,[Object.values(t(r)).includes(!0)?(d(),b("div",Ke,L(n.$t("or")),1)):S("",!0),F(De,{class:"auth-modal-content_social","auth-providers":t(r)},null,8,["auth-providers"]),T("div",Oe,[F(m)])])}}},ze=P(We,[["__scopeId","data-v-7592152b"]]),Xe={},Ye={class:"ui-tabs-window_item"};function Ze(o,r){return d(),b("div",Ye,[ne(o.$slots,"default",{},void 0,!0)])}const He=P(Xe,[["render",Ze],["__scopeId","data-v-4814852f"]]),Je=["data-index"],Qe=te({__name:"UiTabsWindow",props:{activeIndex:{}},setup(o){return(r,n)=>(d(),b("div",{class:"ui-tabs-window","data-index":r.activeIndex+1},[ne(r.$slots,"default",{},void 0,!0)],8,Je))}}),et=P(Qe,[["__scopeId","data-v-89d93d02"]]),tt={class:"login-modal"},ot={class:"login-modal_tab-item"},nt={class:"login-modal_title"},at={__name:"login-modal-content",props:{form:{type:Object,default:()=>({})},signupDisabled:{type:Boolean,default:!1},codeStep:{type:Boolean,default:!1},showChangeMessage:{type:Boolean,default:!0}},setup(o){var E,u;const r=o,n=ve(),$=he(),m=Q("closeModal"),a=A(r.codeStep?1:0),i=A((E=r.form)!=null&&E.login?r.form.login:""),_=A(""),g=A((u=r.form)!=null&&u.remember?r.form.remember:!1),w=be(),B=p=>{var k;return!!((k=w==null?void 0:w.name)!=null&&k.includes(p))},R=p=>{i.value=p.login??"",g.value=p.remember,_.value="",a.value<1&&(a.value+=1)},x=()=>{m(),B("login")&&$.push(n.$localeRoute({path:"/"}))},I=p=>{typeof p=="string"&&(_.value=p)};return(p,k)=>{const V=Re,f=ze,s=He,l=xe,v=et;return d(),b("div",tt,[F(v,{"active-index":t(a)},{default:U(()=>[F(s,null,{default:U(()=>[T("div",ot,[T("p",nt,L(o.signupDisabled?p.$t("login"):p.$t("login_or_register")),1),F(V,{"default-form":o.form,"button-width":"100%",onSuccess:k[0]||(k[0]=y=>R(y))},null,8,["default-form"]),o.signupDisabled?S("",!0):(d(),M(f,{key:0,mode:"login"}))])]),_:1}),F(s,null,{default:U(()=>[F(l,{"login-value":t(i),code:t(_),remember:t(g),"show-change-message":o.showChangeMessage,onChange:k[1]||(k[1]=y=>I(y)),onSuccess:x},null,8,["login-value","code","remember","show-change-message"])]),_:1})]),_:1},8,["active-index"])])}}},_t=P(at,[["__scopeId","data-v-cc33b44c"]]);export{Ve as A,_t as L,qe as S};
