import{_ as qe}from"./CuRHY0aD.js";import{_ as je}from"./qKLLgZOX.js";import{_ as We,u as ze,g as He,b as Je,G as Ke,r as h,x as p,w as Qe,E as Xe,p as ye,q as Ye,j as d,k as c,l as k,m as t,t as y,c as ve,y as l,O as Ze,z as he,F as g,B as q,A as et,o as _}from"./Pd6RrLp1.js";import{u as tt,b as at}from"./lFH7uUjQ.js";import{_ as st}from"./CWXWijxx.js";import{_ as nt,R as ot}from"./B0wUuSsa.js";import{u as rt}from"./B64m7KbU.js";import{u as it}from"./UMgXyzVE.js";import{C as ct}from"./BslN7nPp.js";import{u as pt,f as lt}from"./DV533Gpo.js";import{u as ut}from"./CMIk84tJ.js";import"./Bh9jfPsV.js";import"./QJ3VVsaT.js";import"./Cuh519_O.js";import"./BZsyuj-b.js";import"./BSts32E-.js";import"./CasWryfL.js";import"./Defl8kng.js";import"./CMtmRunp.js";import"./BoW1LxkV.js";import"./C3QHuKV1.js";import"./1OVHT2GX.js";import"./T4kW5CUp.js";import"./CcjC4gLZ.js";import"./2WVDaFKk.js";import"./DGu3cDrV.js";import"./CiYsyl20.js";import"./C3MdYnyV.js";import"./B4ouTiC0.js";import"./DcmtLR2x.js";const _t={class:"payment-page"},dt={key:0,class:"payment-page_loader-wrapper"},mt={key:1,class:"payment-page_content"},yt={class:"payment-page_content-wrapper"},vt={class:"payment-page_wrapper-part"},ht={class:"payment-page_header"},ft={class:"payment-page_order-title"},gt={class:"payment-page_order"},kt={key:0,class:"payment-page_header-text"},bt={key:2,class:"payment-page_repeat-text"},wt={class:"payment-page_info"},St={class:"payment-page_info-title"},Pt={class:"payment-page_info-data"},$t={class:"payment-page_info-title"},At={class:"payment-page_info-data"},It={key:2,class:"payment-page_line"},xt={class:"payment-page_info-title"},Nt={class:"payment-page_info-data"},Rt={class:"payment-page_info-title"},Ct={key:0,class:"payment-page_info-data"},Dt={key:1,class:"payment-page_info-data payment-page_info-data__address"},Tt={class:"payment-page_info-title"},Gt={class:"payment-page_info-data"},Et={class:"payment-page_info-title"},Lt={class:"payment-page_info-data"},Ut={class:"payment-page_info-title"},Bt={class:"payment-page_info-data"},Ft={key:0,class:"payment-page_wrapper-part"},Mt={__name:"index",async setup(Ot){let b,I;const f=ze(),j=He(),W=j.$i18n,{t:o,defaultLocale:z}=Je(),{getLocale:fe}=tt(),S=fe(),{fetchProducts:ge}=pt(),{pushGtmEvent:ke}=Ye(),{logoutIfUserUnregister:be,autoAuth:we}=rt(),{isAuthUser:Se}=it(),H=Ke(),Pe=h("failed"),$e=h(!1),Ae=h(!1),Ie=h(""),P=h(null),x=h(!0),E=h(!1),J=h([]),L=h(""),U=h(""),s=p(()=>{var e;return(e=P==null?void 0:P.value)==null?void 0:e.order}),K=p(()=>{var e,a,r;return((e=s.value)==null?void 0:e.payment_status)==="waiting"&&((r=(a=s.value)==null?void 0:a.payment)==null?void 0:r.type)!=="cash"}),Q=p(()=>{var e,a,r,n,i;return["paid","courier"].includes((e=s.value)==null?void 0:e.payment_status)||((r=(a=s.value)==null?void 0:a.payment)==null?void 0:r.group)==="credit_and_installment"||((i=(n=s.value)==null?void 0:n.payment)==null?void 0:i.type)==="cash"}),xe=p(()=>{var e;return((e=s.value)==null?void 0:e.payment_status)==="canceled"||$e.value||Ae.value}),m=p(()=>{var e;return(e=s.value)==null?void 0:e.delivery}),B=p(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.address)==null?void 0:a.city}),N=p(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.address)==null?void 0:a.street}),R=p(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.address)==null?void 0:a.house_number}),C=p(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.address)==null?void 0:a.floor}),D=p(()=>{var e,a;return(a=(e=m.value)==null?void 0:e.address)==null?void 0:a.apartment_number}),X=p(()=>{var e;return(e=m.value)==null?void 0:e.type}),Y=p(()=>{var e,a;return(a=(e=s.value)==null?void 0:e.user)==null?void 0:a.name}),F=p(()=>{var e,a,r,n,i;return(a=(e=m.value)==null?void 0:e.recipient)!=null&&a.is_other_receiver?(r=m.value.recipient)==null?void 0:r.first_name:(i=(n=s.value)==null?void 0:n.user)==null?void 0:i.name}),M=p(()=>{var e,a,r,n,i;return(a=(e=m.value)==null?void 0:e.recipient)!=null&&a.is_other_receiver?(r=m.value.recipient)==null?void 0:r.last_name:(i=(n=s.value)==null?void 0:n.user)==null?void 0:i.lastname}),O=p(()=>{var e,a,r,n,i;return(a=(e=m.value)==null?void 0:e.recipient)!=null&&a.is_other_receiver?(r=m.value.recipient)==null?void 0:r.phone:(i=(n=s.value)==null?void 0:n.user)==null?void 0:i.phone}),V=p(()=>{var e,a;return(a=(e=s.value)==null?void 0:e.user)==null?void 0:a.email}),Ne=p(()=>{var e;return(e=s.value)==null?void 0:e.is_paid}),Re=p(()=>{const e={city:B.value,street:N.value?`, ${o("short_street")} ${N.value}`:null,houseNumber:R.value?`, ${R.value}`:null,floor:C.value?`, ${o("short_street")} ${C.value}`:null,apartmentNumber:D.value?`, ${o("short_floor")} ${D.value}`:null};return Object.values(e).join("")});f.query.type&&(Pe.value=f.query.type);const Ce={canceled:o("oder_status_canceled"),courier:o("order_status_courier"),installment:o("order_status_installment"),paid:o("oder_status_paid"),waiting:o("order_status_waiting")},De={canceled:o("order_description_error"),courier:o("order_description_courier"),installment:o("order_description_installment"),paid:o("order_description_success"),waiting:o("order_description_waiting")},Te={canceled:o("order_subtitle_error"),courier:o("order_subtitle_courier"),installment:o("order_subtitle_installment"),paid:"",waiting:""},Ge={card:"creditCard",cash:"banknote",cashless_payment:"cashless",credit_and_installment:"credit",link_payment:"link_payment",online:"online",waiting_payment:"waiting_payment"},Ee={courier:"car",pickup:"shop",post:"shop"},u=p(()=>{var a,r,n,i,v,w,T,$,A,G,te,ae,se,ne,oe,re,ie,ce,pe,le,ue,_e,de,me;let e=((r=(a=s.value)==null?void 0:a.payment)==null?void 0:r.group)==="credit_and_installment"&&"installment"||((n=s.value)==null?void 0:n.payment_status);return((v=(i=s.value)==null?void 0:i.payment)==null?void 0:v.type)==="cash"&&(e="paid"),{buttonPayStatus:(T=(w=s.value)==null?void 0:w.payment)!=null&&T.is_online_payment?"repeat_payment":"change_repeat_payment",isRepaymentAvailable:($=s.value)==null?void 0:$.is_repayment_available,isTimeLeftForRepayment:(A=s.value)==null?void 0:A.is_time_left_for_repayment,deliveryGroup:(te=(G=s.value)==null?void 0:G.delivery)==null?void 0:te.group,deliveryGroupIcon:Ee[(se=(ae=s.value)==null?void 0:ae.delivery)==null?void 0:se.group],deliveryType:X.value,orderPaymentStatus:Ce[((oe=(ne=s.value)==null?void 0:ne.payment)==null?void 0:oe.group)==="credit_and_installment"&&"installment"||((re=s.value)==null?void 0:re.payment_status)],orderDescription:De[e],orderSubtitle:Te[((ce=(ie=s.value)==null?void 0:ie.payment)==null?void 0:ce.group)==="credit_and_installment"&&"installment"||((pe=s.value)==null?void 0:pe.payment_status)],payment:(le=s.value)==null?void 0:le.crm_number,paymentGroup:Ge[(_e=(ue=s.value)==null?void 0:ue.payment)==null?void 0:_e.group],paymentName:(me=(de=s.value)==null?void 0:de.payment)==null?void 0:me.type}}),Le=p(()=>B.value||N.value||R.value||C.value||D.value),Ue=p(()=>X.value||B.value||N.value||R.value||C.value||D.value||F.value||M.value||O.value||V.value),Be=p(()=>u.value.isTimeLeftForRepayment?"repeat_payment_available_message":"repeat_payment_not_available_message"),Fe=e=>{P.value=e},Z=async(e,a)=>{var r;try{const{data:n,error:i}=await e.getOrderData(a);if(i)throw i;return(r=n==null?void 0:n.data)==null?void 0:r.checkout}catch(n){return console.error(n),null}},ee=async()=>{var n,i,v;L.value=f.params.payment,U.value=(n=f.query)==null?void 0:n.contact_id,x.value=!0;const e={checkoutID:L.value,contactID:U.value},a=await Z(ct,e);if((i=a==null?void 0:a.order)!=null&&i.isRepaymentAvailable){const w=await Z(ot,e);a.order.config=w.order.config}const r=lt((v=a==null?void 0:a.order)==null?void 0:v.products);P.value={...a,order:{...a.order,products:r}},x.value=!1},Me=async()=>{localStorage.removeItem("broker"),await we(),H.push(j.$localeRoute({path:"/account/info"}))};Qe(f,async()=>{await ee()}),ut({title:W.t("checkout_payment_page_title"),vmid:"description",name:"description",content:W.t("checkout_payment_page_description")}),Xe(()=>{var r,n,i;const e=v=>{H.push({path:v})},a=(i=(n=(r=f.fullPath.split("/checkout"))==null?void 0:r[0])==null?void 0:n.split("/"))==null?void 0:i[1];a?a!==S&&e(S===z?f.fullPath.split(a)[1]:f.fullPath.replace(a,S)):S!==z&&e(`/${S}${f.fullPath}`),localStorage&&(Ie.value=localStorage.getItem("payment_type"))});try{[b,I]=ye(()=>ee()),await b,I(),s.value&&(J.value=([b,I]=ye(()=>ge(s.value.products)),b=await b,I(),b))}catch(e){console.error(e)}finally{x.value=!1,be(),ke("pageview"),localStorage.removeItem("payment_type")}const Oe=p(()=>u.value.paymentName==="cash"?"checkoutSuccessIcon":K.value?"checkoutWaitingIcon":Q.value?"checkoutSuccessIcon":"checkoutErrorIcon"),Ve=p(()=>{var e,a,r,n,i,v;return`${((r=(a=(e=m.value)==null?void 0:e.shop_address)==null?void 0:a.shop)==null?void 0:r.name)||""} | ${((v=(i=(n=m.value)==null?void 0:n.shop_address)==null?void 0:i.address)==null?void 0:v.name)||""}`});return(e,a)=>{var $,A;const r=qe,n=je,i=et,v=at,w=st,T=nt;return _(),d(g,null,[c("div",_t,[t(x)?(_(),d("div",dt,[k(r)])):(_(),d("div",mt,[c("div",yt,[c("div",vt,[c("div",ht,[c("div",ft,[k(n,{icon:t(Oe)},null,8,["icon"]),c("div",null,[c("p",null,l(t(o)("order_no"))+" "+l(t(u).payment),1),c("h3",gt,l(`${t(o)("thank_you")}${t(Y)?`, ${t(Y)}!`:""}`),1)])]),c("span",{class:Ze(["payment-page_status-info",{"payment-page_status-info__success":t(Q),"payment-page_status-info__waiting":t(K),"payment-page_status-info__error":t(xe)}])},l(t(o)(t(u).orderDescription)),3),t(u).orderSubtitle&&t(u).deliveryType!=="pickup"?(_(),d("div",kt,[c("span",null,l(t(u).orderSubtitle),1)])):y("",!0),!t(Ne)&&t(u).isRepaymentAvailable?(_(),ve(i,{key:1,class:"payment-page_repeat-button",onClick:a[0]||(a[0]=G=>E.value=!0)},{default:he(()=>[q(l(t(o)(t(u).buttonPayStatus)),1)]),_:1})):y("",!0),t(u).isRepaymentAvailable||!t(u).isTimeLeftForRepayment?(_(),d("p",bt,l(t(o)(t(Be))),1)):y("",!0)]),c("div",wt,[t(u).payment?(_(),d(g,{key:0},[c("span",St,l(t(o)("order_id_no")),1),c("span",Pt,l(t(u).payment),1)],64)):y("",!0),t(u).paymentName?(_(),d(g,{key:1},[c("span",$t,l(t(o)("payment_method")),1),c("span",At,[k(n,{icon:t(u).paymentGroup||t(u).paymentName,class:"payment-page_info-data__icon"},null,8,["icon"]),q(" "+l(t(o)(`payment_${t(u).paymentName}`)),1)])],64)):y("",!0),t(Ue)?(_(),d("span",It)):y("",!0),t(u).deliveryType?(_(),d(g,{key:3},[c("span",xt,l(t(o)("delivery_method")),1),c("span",Nt,[k(n,{icon:"car",class:"payment-page_info-data__icon"}),c("span",null,l(t(o)(`${t(u).deliveryType}_group`)),1)])],64)):y("",!0),t(u).deliveryGroup==="pickup"||t(Le)?(_(),d(g,{key:4},[c("span",Rt,l(t(o)("delivery_address")),1),t(u).deliveryGroup==="pickup"?(_(),d("span",Ct,l(t(Ve)),1)):(_(),d("span",Dt,[c("span",null,l(t(Re)),1)]))],64)):y("",!0),t(F)||t(M)?(_(),d(g,{key:5},[c("span",Tt,l(t(o)("recipient")),1),c("span",Gt,l(t(F))+" "+l(t(M)),1)],64)):y("",!0),t(O)?(_(),d(g,{key:6},[c("span",Et,l(t(o)("tel_number")),1),c("span",Lt,l(t(O)),1)],64)):y("",!0),t(V)?(_(),d(g,{key:7},[c("span",Ut,l(t(o)("email")),1),c("span",Bt,l(t(V)),1)],64)):y("",!0)]),t(Se)?(_(),ve(i,{key:0,secondary:"",class:"payment-page_account-button",onClick:Me},{default:he(()=>[q(l(t(o)("watch_in_the_personal_account")),1)]),_:1})):y("",!0)]),t(s)?(_(),d("div",Ft,[k(v,{order:t(s),"is-trade-in":(A=($=t(s))==null?void 0:$.marks)==null?void 0:A.is_trade_in},null,8,["order","is-trade-in"])])):y("",!0)]),k(w)]))]),k(T,{"checkout-id":t(L),"contact-id":t(U),"is-repeat-modal-opened":t(E),order:t(s),products:t(J),onClose:a[1]||(a[1]=G=>E.value=!1),onUpdateOrder:Fe},null,8,["checkout-id","contact-id","is-repeat-modal-opened","order","products"])],64)}}},fa=We(Mt,[["__scopeId","data-v-1c200e86"]]);export{fa as default};
