import{_ as ie}from"./qKLLgZOX.js";import{d as ce,r as s,x as S,j as $,o as p,t as G,m as i,l as H,B as Z,y as j,F as J,H as ve,I as ye,k as Q,L as ae,O as ue,c as W,_ as pe,g as de,a1 as he,ad as Ce,z as te,C as Fe,A as be,u as _e,G as Pe,w as ge,D as ke}from"./Pd6RrLp1.js";import{_ as $e}from"./CIVZYtEA.js";import{_ as ne,g as fe,a as we,b as Se,u as Ie,c as xe,d as Oe}from"./9O3XjtsJ.js";import{u as Ae}from"./BSts32E-.js";import{C as re}from"./D1YAISfT.js";import{u as Be}from"./CasWryfL.js";import{_ as Ve}from"./cdh4QgBc.js";import{_ as Le}from"./CjGb2l7u.js";const De={class:"filter-category"},Te={class:"filter-category_content"},Ee=["onClick"],je=ce({__name:"filter-category",props:{category:{},activeCategory:{}},emits:["select"],setup(r,{emit:A}){const a=r,h=A,I=s(!1),_=s(!1),B=S(()=>{var o;return I.value?a.category.subchildren:(o=a.category.subchildren)==null?void 0:o.slice(0,10)}),P=S(()=>a.activeCategory&&a.category.type==="parent");return(o,v)=>{var K,x,U;const w=ie,V=$e;return p(),$("div",De,[i(P)?(p(),$("button",{key:0,class:"filter-category_back filter-category_back__main",onClick:v[0]||(v[0]=l=>h("select",null))},[H(w,{icon:"arrowLeft"}),Z(" "+j(o.category.name),1)])):G("",!0),(K=i(B))!=null&&K.length&&((x=i(B))==null?void 0:x.length)>0?(p(),$(J,{key:1},[(U=o.category.subchildren)!=null&&U.find(l=>l.id===o.activeCategory)?(p(),$("button",{key:0,class:"filter-category_back",onClick:v[1]||(v[1]=l=>h("select",o.category.id))},[H(w,{icon:"arrowLeft"}),Z(" "+j(o.category.name),1)])):i(P)?G("",!0):(p(),$(J,{key:1},[o.category.id===o.activeCategory?(p(),$("button",{key:0,class:"filter-category_parent-name filter-category_parent-name__inner",onClick:v[2]||(v[2]=l=>_.value=!i(_))},[Z(j(o.category.name)+" ",1),H(V,{active:!i(_)},null,8,["active"])])):o.category.type==="children"?(p(),$("button",{key:1,class:"filter-category_parent-name",onClick:v[3]||(v[3]=l=>h("select",o.category.id))},j(o.category.name),1)):G("",!0),ve(Q("div",Te,[(p(!0),$(J,null,ae(i(B),l=>(p(),$("span",{key:l.id,class:ue(["filter-category_name",{active:o.activeCategory}]),onClick:n=>h("select",l.id)},j(l.name),11,Ee))),128)),o.category.subchildren&&o.category.subchildren.length>10?(p(),$("div",{key:0,class:"filter-category_action",onClick:v[4]||(v[4]=l=>I.value=!i(I))},j(i(I)?`- ${o.$t("show_less")}`:`+ ${o.$t("show_more")}`),1)):G("",!0)],512),[[ye,!i(_)]])],64))],64)):G("",!0)])}}}),Me=ce({__name:"filter-categories",props:{filterItems:{},activeCategory:{},isLoadingOnChangePage:{type:Boolean},disabled:{type:Boolean}},emits:["onFilterChange","onDescriptionItemClick"],setup(r,{emit:A}){const a=r,h=A,I=_=>{h("onFilterChange",{id:"category_id",name:"Category",value:_?[_]:null})};return(_,B)=>{const P=je;return p(!0),$(J,null,ae(a.filterItems,o=>(p(),W(P,{key:o.id,category:o,"active-category":_.activeCategory,onSelect:I},null,8,["category","active-category"]))),128)}}}),Ne={class:"filters"},Re={class:"filters_mobile-title"},qe={key:0,class:"filters_header"},Qe={class:"filters_header-filter"},Ge={class:"filters_title"},Ke={class:"filters_tags"},Ue={class:"filters_items"},ze={class:"filters_item"},He={class:"filters_button"},We={__name:"filters",props:{filters:{type:Array,default:()=>[]},categories:{type:Array,default:()=>[]},selectedFilters:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1},slug:{type:String,default:""},categoryId:{type:Number,default:0},isDefaultCollapsed:{type:Boolean,default:!1},filterSelectedTags:{type:Array,default:()=>[]},minPrice:{type:[Number,null],default:null},maxPrice:{type:[Number,null],default:null},links:{type:Array,default:()=>[]}},emits:["onRemoveTag","onFilterChange","updateFiltersLength","clearAllFilter","clearPriceFilter","updatePriceFilter"],setup(r,{emit:A}){const a=r,h=A,I=de(),_=he(),B=I.$i18n,{currencyMark:P}=Be("",!0),{formatPriceWithSpaces:o}=Ae(),v=s(0),w=s(0),V=s(a.categoryId),K=s([]),x=s(!0),U=s(!1);s([]);const l=s(!1),n=s(0),g=s(0),f=s(!1),c=S(()=>a.minPrice!==null&&a.maxPrice!==null&&a.maxPrice!==0),C=async()=>{const{data:d}=await re.getCategoryById(V.value,{limit:20});return d.data.aggs},M=()=>{h("clearPriceFilter")},L=d=>{const m=[],F={defaultMinPriceValue:0,defaultMaxPriceValue:0,minGeneralPrice:0,maxGeneralPrice:0,isCategoryIdFilter:!1,isDiscountFilter:!1};return Array.isArray(d)&&(d!=null&&d.length)&&d.forEach(y=>{if(y.id==="min_price_general"&&(F.defaultMinPriceValue=+y.value),y.id==="max_price_general"&&(F.defaultMaxPriceValue=+y.value),y.id==="min_price"&&(F.minGeneralPrice=+y.value),y.id==="max_price"&&(F.maxGeneralPrice=+y.value),y.id!=="category_id"&&!`${y.id}`.includes("min_price")&&!`${y.id}`.includes("max_price")&&y.buckets&&y.buckets.length>0){if(y.id==="color"||y.id==="vendor"){const u=y.name.toLowerCase();(u==="color"||u==="brand")&&(y.name=B.t(u))}m.push(y)}y.id==="category_id"&&(F.isCategoryIdFilter=!0),y.id==="discount"&&y.value>0&&(F.isDiscountFilter=!0)}),v.value=F.defaultMinPriceValue,w.value=F.defaultMaxPriceValue,n.value=F.minGeneralPrice,g.value=F.maxGeneralPrice,U.value=F.isCategoryIdFilter,l.value=F.isDiscountFilter,k(m),n.value<=0&&(n.value=v.value),g.value<=0&&(g.value=w.value),m},D=S(()=>a.maxPrice>0||w.value>0),X=S(()=>U.value),N=d=>{K.value=L(d)},T=S(()=>(a.categoryId?C().then(d=>{N(d)}):N(a.filters),L(a.filters))),k=d=>{let{length:m}=d;D.value&&(m+=1),X.value&&(m+=1),h("updateFiltersLength",m)},R=d=>`${o(d)} ${P.value}`;return(d,m)=>{var q,t;const F=ie,y=Fe,u=Me,O=Se,E=be;return p(),$("div",Ne,[Q("button",{class:"filters_toggle",onClick:m[0]||(m[0]=Ce(e=>f.value=!0,["prevent"]))},[H(F,{class:"filters_toggle-icon",icon:"filterIcon"}),m[7]||(m[7]=Z(" Add filter "))]),Q("div",{class:ue(["filters_content",{opened:i(f)}])},[Q("button",{class:"filters_close",onClick:m[1]||(m[1]=e=>f.value=!1)},[H(F,{icon:"close"})]),Q("span",Re,j(d.$t("filter")),1),r.filterSelectedTags.length>0||i(c)?(p(),$("div",qe,[Q("div",Qe,[Q("span",Ge,j(d.$t("filter_by")),1),Q("button",{class:"filters_clear",onClick:m[2]||(m[2]=e=>d.$emit("clearAllFilter"))},j(d.$t("clear_all")),1)]),Q("div",Ke,[(p(!0),$(J,null,ae(r.filterSelectedTags,e=>(p(),W(ne,{key:e.id,class:"filters_selected-tag",closable:"","onClick:close":b=>d.$emit("onRemoveTag",e.id)},{default:te(()=>[Z(j(e.name),1)]),_:2},1032,["onClick:close"]))),128)),i(c)?(p(),W(ne,{key:0,class:"filters_selected-tag",closable:"","onClick:close":M},{default:te(()=>[Z(j(`${R(r.minPrice)} - ${R(r.maxPrice)}`),1)]),_:1})):G("",!0)])])):G("",!0),Q("div",Ue,[(p(!0),$(J,null,ae(r.links,e=>(p(),$("div",ze,[H(y,{to:i(_)(e.href),class:"filters_link"},{default:te(()=>[H(F,{icon:"chevronLeftIcon",class:"filters_icon"}),Q("span",null,j(e.text),1)]),_:2},1032,["to"])]))),256)),((q=r.categories)==null?void 0:q.length)>0?(p(),W(u,{key:0,"filter-items":r.categories,"active-category":(t=r.selectedFilters.category_id)==null?void 0:t[0],onOnFilterChange:m[3]||(m[3]=e=>d.$emit("onFilterChange",e))},null,8,["filter-items","active-category"])):G("",!0),(p(!0),$(J,null,ae(i(T),e=>(p(),W(i(we),{key:e.id,caption:e.name,"filter-id":e.id,"filter-name":e.name,"filter-items":e.buckets,checked:r.selectedFilters[i(fe)(e.id,e.name,!0)],"is-default-collapsed":r.isDefaultCollapsed,onOnFilterChange:m[4]||(m[4]=b=>d.$emit("onFilterChange",b))},null,8,["caption","filter-id","filter-name","filter-items","checked","is-default-collapsed"]))),128)),i(D)?(p(),W(O,{key:1,"min-price":r.minPrice,"default-min-price":i(v),"max-price":r.maxPrice,"default-max-price":i(w),"is-loading":r.loading,onUpdatePriceFilter:m[5]||(m[5]=e=>d.$emit("updatePriceFilter",e))},null,8,["min-price","default-min-price","max-price","default-max-price","is-loading"])):G("",!0)]),Q("div",He,[H(E,{disabled:!i(x),secondary:"","full-width":"",onClick:m[6]||(m[6]=e=>f.value=!1)},{default:te(()=>[Z(j(d.$t("apply")),1)]),_:1},8,["disabled"])])],2)])}}},Je=pe(We,[["__scopeId","data-v-ad86ea65"]]),se={cheap:{"order[price]":"asc","order[total_popular]":"desc"},expensive:{"order[price]":"desc","order[total_popular]":"desc"},in_stock:{"order[stock]":"desc","order[total_popular]":"desc"},preorders:{"order[stock]":"asc","order[total_popular]":"desc"},total_popular:{"order[total_popular]":"desc"}},Xe=()=>{const r=_e(),A=Pe(),a=s({}),h=s(se.total_popular),I=s("total_popular"),_=s({}),B=s(null),P=s(null),o=s(null),v=s(null),w=s({}),{addFilterPrefixToKey:V,getKeyWithoutPrefix:K,isExistFilterPrefix:x}=xe(),U=t=>{h.value=se[t],I.value=t},l=()=>{_.value={sort:I.value}},n=S(()=>Object.keys(r.query).filter(t=>{if(!x(t)&&t.toLowerCase()!=="text"&&t.toLowerCase()!=="page")return r.query[t]}).reduce((t,e)=>(t[e]=r.query[e],t),{}));ge(()=>r.query,()=>{Object.keys(r.query).forEach(t=>{if(x(t)===!1)return;const e=K(t);e&&(w.value[e]=r.query[t]),e==="price[to]"&&(v.value=r.query[t]),e==="price[from]"&&(o.value=r.query[t])})},{immediate:!0});const g=s(null),f=20,c=t=>{const e=typeof t.id=="string"?t.id:t.name;a.value={...a.value,[fe(e)]:t.value}},C=t=>{P.value=t.discount},M=t=>{Object.keys(t).forEach(e=>{a.value={...a.value,[e]:t[e]}})},L=t=>{g.value=t},D=t=>{o.value=t.min,v.value=t.max},X=t=>{if(!t){a.value=B.value,B.value=null;return}B.value=a.value},N=()=>{P.value=null,a.value={}},T=t=>{let e={...a.value};Object.keys(a.value).forEach(b=>{e={...e,[b]:a.value[b].filter(z=>Number(z)!==t)}}),a.value={...e}},k=t=>{var b;const e=[];return(b=w.value[t])==null||b.split(",").forEach(z=>{+z&&e.push(+z)}),e.length?{[t]:e}:{}},R=()=>{Object.keys(w.value).length!==0&&Object.keys(w.value).forEach(e=>{e.toLowerCase()!=="page"&&e.toLowerCase()!=="text"&&e.toLowerCase()!=="price[from]"&&e.toLowerCase()!=="price[to]"&&(a.value={...a.value,...k(e)},e.toLocaleLowerCase()==="discount"&&(P.value=w.value[e]))})},d=S(()=>{const t=s([]);return Object.keys(a.value).forEach(e=>{e!=="vendor"&&e!=="max_price"&&e!=="min_price"&&(t.value=t.value.concat(a.value[e]))}),t.value}),m=S(()=>{const t=s([]);return Object.keys(a.value).forEach(e=>{e==="vendor"&&(t.value=t.value.concat(a.value[e]))}),t.value}),F=S(()=>{const t=s([]);return Object.keys(a.value).forEach(e=>{e==="category_id"&&(t.value=t.value.concat(a.value[e]))}),t.value}),y=S(()=>{const t=s([]);return Object.keys(a.value).forEach(e=>{e==="color"&&(t.value=t.value.concat(a.value[e]))}),t.value}),u=S(()=>{const t=[];return Object.entries(a.value).forEach(([e,b])=>{var le;const z=(le=g.value)==null?void 0:le.find(Y=>`${Y.id}`.toLowerCase().replace(/\s+/g,"_")===e||Y.additional&&`${Y.additional}`.toLowerCase().replace(/\s+/g,"_")===e);z&&b.forEach(Y=>{var oe;const ee=(oe=z.buckets)==null?void 0:oe.find(me=>me.id===Number(Y));ee&&t.push(ee)})}),t}),O=S(()=>{const t=s({});return Object.keys(a.value).forEach(e=>{t.value={...t.value,...a.value[e]&&{[V(e)]:a.value[e].length?a.value[e].join():a.value[e]}}}),t.value}),E=(t=1)=>{const e=[];return Object.keys(a.value).forEach(b=>{b!=="category_id"&&b!=="vendor"&&b!=="price[to]"&&b!=="price[from]"&&b!=="discount"&&b!=="color"&&e.push(a.value[b])}),{filtersData:e,...m.value.length!==0&&{vendor:m.value},...F.value.length!==0&&{category_id:F.value},...y.value.length!==0&&{color:y.value},page:t,limit:f,...P.value&&{discount:P.value},...o.value&&{"price[from]":o.value},...v.value&&{"price[to]":v.value}}},q=async(t=1)=>{var ee;P.value||(a.value.discount=[]),a.value=Ie(a.value);const e={},b=V("price[from]"),z=V("price[to]"),le=V("discount"),Y={...e,...((ee=Object.keys(n.value))==null?void 0:ee.length)!==0&&n.value,...t!==1&&{page:t},...Object.keys(O.value).length!==0&&O.value,...o.value&&{[b]:o.value},...v.value&&{[z]:v.value},...P.value&&{[le]:P.value},..._.value};await A.push({query:Y})};return R(),{onlyDiscount:P,allFilters:g,selectedFilters:a,filterSelectedTags:u,filterIdsForFetch:d,updateSelectedFilters:c,updateSelectedFiltersMobile:M,addQueryToRoute:q,setAllFilters:L,removeFilterById:T,createFiltersHistory:X,getQueryParams:E,clearFilter:N,minPriceVal:o,maxPriceVal:v,setPriceFilterValue:D,updateOnlyDiscount:C,changeSorting:U,sortValue:h,setSortQuery:l,sortName:I}},st={__name:"subcategory-grid",props:{products:{type:Array,default:()=>[]},links:{type:Array,default:()=>[]},slug:{type:String,default:""},subcategory:{type:String,default:""},loading:{type:Boolean,default:!1},totalPages:{type:Number,required:!0},currentPage:{type:Number,required:!0},withCategoriesFilter:{type:Boolean,default:!1}},emits:["getSubcategoryData","onChangePage"],setup(r,{emit:A}){const a=r,h=A,_=de().$i18n,B=s(null),P=s([{label:_.t("search_sort_relevance"),value:"total_popular"},{label:_.t("search_sort_cheap"),value:"cheap"},{label:_.t("search_sort_expensive"),value:"expensive"}]),o=S(()=>a.subcategory.productsMetaCount||a.subcategory.products_meta_count),v=S({get(){return a.currentPage},set(u){X(Number(u))}}),{selectedFilters:w,filterSelectedTags:V,updateSelectedFilters:K,addQueryToRoute:x,setAllFilters:U,removeFilterById:l,clearFilter:n,getQueryParams:g,setPriceFilterValue:f,minPriceVal:c,maxPriceVal:C,changeSorting:M,sortName:L,sortValue:D}=Xe(),X=u=>{x(u),h("getSubcategoryData",{params:{...D.value,...g(u)}})},N=({min:u,max:O})=>{f({min:u,max:O}),x(),h("getSubcategoryData",{params:{...D.value,...g()}})},T=()=>{N({min:null,max:null})},k=async u=>{u.id?K(u):f(u),await x(),h("getSubcategoryData",{params:{...D.value,...g()}})},R=async()=>{T(),await n(),await x(),h("getSubcategoryData",{params:g()})},d=async u=>{if(u!=="all")l(u);else{const O=B.value.clearPriceValue();await f(O),await n()}await x(),h("getSubcategoryData",{params:g()})},m=S(()=>{const u=a.subcategory.features;return u.sort((E,q)=>E.sort-q.sort),u.reduce((E,q)=>{const t=E.find(e=>e.additional===q.additional);if(t){const e=new Set([...t.buckets,...q.buckets]);t.buckets=Array.from(e)}else E.push(q);return E},[])||[]}),F=S(()=>{const u=a.subcategory.aggs;return u.sort((O,E)=>O.sort-E.sort),m.value.length&&!a.isParentCategory?[...u,...m.value]:u}),y=u=>{M(u),x(1);const O={params:{...D.value,...g(),page:1}};h("getSubcategoryData",O)};return ge(()=>F.value,u=>{U(u)},{immediate:!0}),(u,O)=>{const E=Je,q=Ve,t=Le;return p(),$(J,null,[H(Oe,{class:"subcategory-grid",products:r.products,loading:r.loading,total:i(o),"dropdown-sort-items":i(P),"sort-name":i(L),"filter-selected-tags":i(V),"min-price":i(c),"max-price":i(C),onOnRemoveTag:d,onClearAllFilter:R,onHandleSortChange:y,onClearPriceFilter:T},{filter:te(()=>{var e,b;return[i(F)?(p(),W(E,{key:0,filters:i(F),categories:r.withCategoriesFilter?(b=(e=r.subcategory)==null?void 0:e.navigationMenuData)==null?void 0:b.list:[],"selected-filters":i(w),"filter-selected-tags":i(V),loading:r.loading,"is-default-collapsed":!0,"min-price":i(c),"max-price":i(C),links:r.links,onOnRemoveTag:d,onOnFilterChange:k,onClearAllFilter:R,onClearPriceFilter:T,onUpdatePriceFilter:N},null,8,["filters","categories","selected-filters","filter-selected-tags","loading","min-price","max-price","links"])):G("",!0)]}),product:te(()=>[(p(!0),$(J,null,ae(r.products,e=>(p(),W(q,{key:e.id,product:e,type:"product"},null,8,["product"]))),128))]),_:1},8,["products","loading","total","dropdown-sort-items","sort-name","filter-selected-tags","min-price","max-price"]),r.totalPages>1?(p(),W(t,{key:0,modelValue:i(v),"onUpdate:modelValue":O[0]||(O[0]=e=>ke(v)?v.value=e:null),length:r.totalPages,disabled:r.loading,class:"subcategory-grid_pagination"},null,8,["modelValue","length","disabled"])):G("",!0)],64)}}},it=()=>{const r=s(null),A=s(null),a=s(null),h=s(20),I=s(null),_=async(l={})=>{const n=await re.getCategories(l);r.value=n},B=S(()=>A.value?Math.ceil(Number(A.value.productsMetaCount)/Number(h.value)):null),P=l=>{let n="";return l&&l.forEach(g=>{g&&(n+=`filters[]=${g.join(",")}&`)}),n},o=async(l,n,g)=>{const f=P(g),{data:c,error:C}=await re.getBrandsBySlug(l,f,{...n,limit:h.value});C&&(I.value=C),a.value=c.data},v=l=>(l&&l.length>0&&(l==null||l.forEach(n=>{n.type="parent",n.isActiveCategory=!1}),l[l.length-1].isActiveCategory=!0),l),w=(l=[],n)=>{if(!l)return[];const g=new Set(n),f=l.filter(c=>g.has(c.id));return f.forEach(c=>{c.children&&c.children.length>0&&(c.children=w(c.children,n))}),f},V=(l=[],n,g=[])=>{let f={foundCategory:null,parents:null};if(!l)return f;const c=l.find(C=>C.id===n);return c?{foundCategory:c,parents:g}:(l.some(C=>{if(C.children&&C.children.length>0){const M=V(C.children,n,[...g,C]);if(M.foundCategory)return f=M,!0}return!1}),f)},K=(l,n,g=[])=>{const f=l.find(c=>c.id===n);return!f||!f.buckets?[]:f.buckets.filter(c=>!g.includes(c.id)).map(c=>c.id)},x=(l,n,g)=>{const{category_id:[f]=[]}=l;let c=null,C=[];if(f&&f>0){const k=V(r.value,f);k&&(c=k.foundCategory?{...k.foundCategory}:null,C=Array.isArray(k.parents)?[...k.parents]:null)}const M=n.map(k=>k.id),L=K(g.aggs,"category_id",M),D=c?c.children:r.value,N=w(D,[...L,f??-1]).map(k=>{var R;return{...k,type:"children",subchildren:((R=k.children)==null?void 0:R.map(d=>({...d,type:"sub-children"})))||[]}});let T=n;if(c&&C){C.forEach(R=>{R.actionType="filter"});const k=n.length;T=[...n,...C,c],k>0&&(T[k-1].actionType="clear-filter")}return[...v(T),...N]};return{allCategories:r,fetchCategoryBySlug:async(l,n,g)=>{var N;(!r.value||!r.value.length)&&await _();const{filtersData:f,...c}=n,C=P(f),M=g?re.getPromoCategoryBySlug:re.getCategoryBySlug,{data:L,error:D}=await M(l,C,{...c,limit:h.value});D&&(I.value=D);const X=((N=L.branch)==null?void 0:N.reverse().filter(T=>!!T.catalogId))??[];A.value={...L,navigationMenuData:{list:g?x(n,X,L):L.children,childCount:L.children.length},"order[stock]":"desc"}},categoryBySlug:A,brandBySlug:a,totalPages:B,fetchCategories:_,fetchBandsBySlug:o,fetchError:I}};export{st as _,it as a,Xe as u};
