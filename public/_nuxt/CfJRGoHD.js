import{_ as Ln}from"./C1bY634J.js";import{_ as hn,u as Te,i as ze,a as Tn,b as jn,c as Qn,d as Gn,e as zn}from"./lFH7uUjQ.js";import{_ as Wn,T as Zn,a as Kn}from"./CjEn23L9.js";import{_ as Jn}from"./Bh9jfPsV.js";import{_ as ft}from"./qKLLgZOX.js";import{d as Vt,r as w,b as nt,h as gn,w as we,J as ct,j as ee,o as V,k as E,l as R,y as oe,F as Le,L as tt,N as bn,z as ue,m as e,t as Ce,c as ce,B as Ne,A as Rt,D as Ie,_ as xe,O as Ye,G as Cn,x as N,Q as ht,R as Yn,S as He,i as at,q as dt,E as kn,T as gt,U as mn,H as Ge,V as Hn,I as ut,W as Xn,X as ea,Y as ta,g as $n,Z as na,$ as pn,p as _n,a0 as aa}from"./Pd6RrLp1.js";import{_ as sa}from"./D_VYGPYF.js";import{_ as Ut}from"./2WVDaFKk.js";import{_ as wn}from"./pvpDbLJt.js";import{u as Xe}from"./UMgXyzVE.js";import{_ as la}from"./CWXWijxx.js";import{u as oa,a as ra,b as ia}from"./T4kW5CUp.js";import{u as mt,a as st,_ as Sn}from"./BoW1LxkV.js";import{u as Je}from"./CiYsyl20.js";import{u as yt}from"./C3MdYnyV.js";import{u as ua}from"./Crd-_VjE.js";import{C as vn}from"./BslN7nPp.js";import{_ as ca}from"./C3vUPGSh.js";import{_ as Dt,a as da}from"./D_TJXMTY.js";import{_ as Bt}from"./C3QHuKV1.js";import{_ as It}from"./DK9X1TaX.js";import{u as ma,A as pa}from"./B64m7KbU.js";import{L as _a,A as va}from"./BopCOLbw.js";import{u as ya,_ as xt}from"./1OVHT2GX.js";import{_ as fa}from"./CuRHY0aD.js";import{u as Pt}from"./CcjC4gLZ.js";import{f as ha}from"./DV533Gpo.js";import"./QJ3VVsaT.js";import"./Cuh519_O.js";import"./BZsyuj-b.js";import"./BSts32E-.js";import"./CasWryfL.js";import"./Defl8kng.js";import"./CMtmRunp.js";import"./CpOl9fd2.js";import"./0zS85Q81.js";import"./B4ouTiC0.js";import"./BeTDdiTI.js";import"./gj_0ZWSo.js";import"./km7Iw1uL.js";import"./DcmtLR2x.js";const ga={class:"checkout-trade-in"},ba={class:"checkout-trade-in_title"},Ca={class:"checkout-trade-in_subtitle"},ka={class:"checkout-trade-in_items"},$a={key:0,class:"checkout-trade-in_items-total"},wa={class:"checkout-trade-in_device-title"},Sa={class:"checkout-trade-in_device-price"},Aa=Vt({__name:"checkout-trade-in",props:{exchangeItems:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},currency:{type:String,default:""}},emits:["change"],setup(r,{emit:B}){const s=B,t=w({header:"trade-in-checkout-modal-header",footer:"trade-in-checkout-modal-footer"}),l=localStorage.getItem("showCheckoutTradeIn")==="true",d=w(!1),o=w(l),y=w({}),{t:u}=nt(),{userDevices:i,userDevicesTotalPrice:L,removeUserDeviceByIndex:M}=gn(),de=[{value:!0,label:u("yes")},{value:!1,label:u("no")}],G=w(l),me=(I={})=>{y.value=I,o.value=!0},P=()=>{localStorage.removeItem("showCheckoutTradeIn")},K=()=>{o.value=!1,localStorage.removeItem("showCheckoutTradeIn")};return we(()=>G.value,()=>{o.value=G.value,s("change",G.value)}),ct("modalKeys",t),(I,W)=>{const Y=Wn,v=Jn,_=ft,T=Rt,se=hn,F=sa,ye=Ut,Se=Zn,Z=Kn;return V(),ee("div",ga,[E("p",ba,oe(I.$t("trade_in")),1),E("p",Ca,oe(I.$t("do_you_want_to_trade_your_old_device")),1),E("div",null,[E("button",{class:"checkout-trade-in_modal-button",onClick:W[0]||(W[0]=k=>d.value=!0)},oe(I.$t("see_more")),1)]),E("div",null,[(V(),ee(Le,null,tt(de,k=>R(se,{key:k.label,modelValue:e(G),"onUpdate:modelValue":W[2]||(W[2]=$=>Ie(G)?G.value=$:null),name:"trade-in",value:k.value,checked:e(G)===k.value},bn({label:ue(()=>[Ne(oe(k.label),1)]),_:2},[e(G)&&e(i).length?{name:"content",fn:ue(()=>[E("div",ka,[E("div",null,[(V(!0),ee(Le,null,tt(e(i),($,re)=>(V(),ce(Y,{key:`index-${re}`,device:$,onChange:()=>me($),onRemove:()=>e(M)(re)},null,8,["device","onChange","onRemove"]))),128))]),e(L)?(V(),ee("div",$a,[E("span",wa,oe(I.$t("trade_in_benefit_hint")),1),E("span",Sa,[Ne(oe(e(L)*-1)+" ",1),R(v,{currency:"","use-default":""})])])):Ce("",!0),R(T,{class:"checkout-trade-in_add-button",secondary:"",onClick:W[1]||(W[1]=$=>o.value=!0)},{default:ue(()=>[R(_,{icon:"plus"}),Ne(" "+oe(I.$t("trade_in_add_device")),1)]),_:1})])]),key:"0"}:void 0]),1032,["modelValue","value","checked"])),64))]),R(ye,{modelValue:e(d),"onUpdate:modelValue":W[5]||(W[5]=k=>Ie(d)?d.value=k:null),"max-width":604},{default:ue(()=>[R(F,{modelValue:e(d),"onUpdate:modelValue":W[3]||(W[3]=k=>Ie(d)?d.value=k:null),onInput:W[4]||(W[4]=k=>d.value=k)},null,8,["modelValue"])]),_:1},8,["modelValue"]),R(Z,{modelValue:e(o),"onUpdate:modelValue":[W[6]||(W[6]=k=>Ie(o)?o.value=k:null),P],"max-width":604},{default:ue(()=>[(V(),ce(Se,{key:`${e(o)}`,"exchange-items":r.exchangeItems,"initial-user-device":e(y),onClose:K},null,8,["exchange-items","initial-user-device"]))]),_:1},8,["modelValue"])])}}}),Va=xe(Aa,[["__scopeId","data-v-afc27b6a"]]),Ra={__name:"checkout-callback",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:!1},name:{type:String,default:""}},emits:["updateCallback"],setup(r,{emit:B}){const s=r,t=B,l=w(s.value),{saveBaseData:d,getBaseData:o}=Te(),y=()=>{t("updateCallback",l.value);const u=o();d({...u,isNoCallback:l.value})};return(u,i)=>{const L=wn;return V(),ce(L,{modelValue:e(l),"onUpdate:modelValue":i[0]||(i[0]=M=>Ie(l)?l.value=M:null),name:r.name,disabled:r.disabled,class:"checkout-callback",onChange:y},{default:ue(()=>[Ne(oe(u.$t("no_callback")),1)]),_:1},8,["modelValue","name","disabled"])}}},Ua=xe(Ra,[["__scopeId","data-v-59120c71"]]),Da={__name:"checkout-submit",props:{disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},showOnMobile:{type:Boolean,default:!1}},emits:["submit"],setup(r,{emit:B}){const{isAuthUser:s}=Xe(),t=w(!1);return we(()=>s,()=>{s.value&&(t.value=!1)}),(l,d)=>{const o=Rt;return V(),ee("div",{class:Ye(["checkout-submit",{"checkout-submit__mobile-show":r.showOnMobile}])},[R(o,{disabled:r.disabled||!e(s)&&e(t),"full-width":"",onClick:d[0]||(d[0]=y=>l.$emit("submit"))},{default:ue(()=>[Ne(oe(l.$t("submit_your_order")),1)]),_:1},8,["disabled"])],2)}}},Ba=xe(Da,[["__scopeId","data-v-4cb112ba"]]),Ia={class:"information-modal"},xa={class:"information-modal_title"},Pa={class:"information-modal_text"},Fa={__name:"information-modal",props:{title:{type:String,default:""},text:{type:String,default:""},buttonText:{type:String,default:""},opened:{type:Boolean,default:!0},redirectUrl:{type:String,default:""}},emits:["close","actionAfterRedirect"],setup(r,{emit:B}){const s=r,t=B,l=Cn(),d=Yn(),o=N(()=>s.isModalOpened),y=()=>{var u,i;t("close"),redirectUrl&&redirectUrl.length&&(l.push(app.$localeRoute({path:redirectUrl})),(i=(u=d==null?void 0:d.vnode)==null?void 0:u.props)!=null&&i.actionAfterRedirect&&t("actionAfterRedirect"))};return(u,i)=>{const L=Rt,M=Ut;return V(),ce(M,ht({modelValue:e(o),"onUpdate:modelValue":i[0]||(i[0]=de=>Ie(o)?o.value=de:null)},{...u.$attrs},{"full-height":"","onUpdate:modelValue":y}),{default:ue(()=>[E("div",Ia,[E("span",xa,oe(r.title),1),E("span",Pa,oe(r.text),1),R(L,{class:"information-modal_button","full-width":"",onClick:y},{default:ue(()=>[Ne(oe(r.buttonText),1)]),_:1})])]),_:1},16,["modelValue"])}}},yn=w(null),At=w(null),fn=w(0),An=()=>{const r=y=>{yn.value=y},B=y=>{At.value=y},s=y=>{fn.value=y},t=N(()=>yn.value),l=N(()=>At.value),d=N(()=>fn.value),o=N(()=>{var y,u;return(u=(y=At.value)==null?void 0:y.delivery)==null?void 0:u.type});return{setCheckoutState:r,getCheckoutState:t,setCheckoutDelivery:B,getCheckoutDelivery:l,getCheckoutDeliveryType:o,setCheckoutStep:s,getCheckoutStep:d}},qa={__name:"checkout-sidebar-comment",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(r,{emit:B}){const s=r,t=B,l=w(s.modelValue),{getBaseData:d,saveBaseData:o}=Te(),y=u=>{t("update:modelValue",u.target.value);const i=d();o({...i,comment:u.target.value})};return(u,i)=>{const L=ca;return V(),ce(L,{modelValue:e(l),"onUpdate:modelValue":i[0]||(i[0]=M=>Ie(l)?l.value=M:null),label:u.$t("write_comment_on_order"),"max-length":"200",onInput:y},null,8,["modelValue","label"])}}},Ea=Vt({name:"NewsletterCheckbox",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:!1},name:{type:String,default:"newsletter"}}});function Ma(r,B,s,t,l,d){const o=wn;return V(),ce(o,{disabled:r.disabled,name:r.name,errors:r.firstNameErrors,value:r.value,"small-label":"",class:"remember-checkbox",onChange:B[0]||(B[0]=y=>r.$emit("input",y))},{default:ue(()=>[Ne(oe(r.$t("i_want_to_receive_a_newsletter")),1)]),_:1},8,["disabled","name","errors","value"])}const Oa=xe(Ea,[["render",Ma],["__scopeId","data-v-c791da99"]]),Na={class:"checkout-auth_header"},La={__name:"checkout-auth",emits:["updateForm"],setup(r,{emit:B}){const{logout:s}=ma(),t=w(!1),l=B,o=He({...{email:null,phone:null,name:null,lastname:null,subscription:!1,personalAgreement:!1}}),{getUser:y,isAuthUser:u}=Xe(),{pushGtmEvent:i}=dt(),{saveClientData:L,getClientData:M}=Te(),{getErrors:de,defaultRequiredMessage:G,defaultRequiredCheckboxMessage:me,emailPattern:P,defaultPhoneRequiredMessage:K}=mt(),{isLoading:I,startLoading:W,stopLoading:Y}=Je(),v=w({email:{defaultRequiredMessage:G,emailPattern:P},phone:{defaultRequiredMessage:G,defaultPhoneRequiredMessage:K},name:{defaultRequiredMessage:G},personalAgreement:u.value?{}:{defaultRequiredCheckboxMessage:me}}),_=st(v,o),T=N(()=>de(_.value.name)),se=N(()=>de(_.value.phone)),F=N(()=>de(_.value.email)),ye=N(()=>de(_.value.personalAgreement));function Se(D){i("nameFilled",D.target.value),Z("name")}const Z=D=>{var b,H,c,g,h,C;if((b=_.value[D])==null||b.$touch(),!((H=_.value[D])!=null&&H.$error)){const{personalAgreement:j,subscription:m,...O}=o,De=!((c=T.value)!=null&&c.length)&&o.name,he=!((g=F.value)!=null&&g.length)&&o.email,le=!((h=se.value)!=null&&h.length)&&o.phone;he&&le&&De&&l("updateForm",{...O,phone:(C=O.phone)==null?void 0:C.replace(/[\s-]/g,""),userForm:!0,client_type:u.value?"":"unregistered"})}},k=N(()=>{var D;return(D=y.value)==null?void 0:D.name}),$=N(()=>{var D;return(D=y.value)==null?void 0:D.email}),re=N(()=>{var D;return(D=y.value)==null?void 0:D.phone}),fe=N(()=>{var D;return(D=y.value)==null?void 0:D.lastname}),pe=D=>{var b,H;(H=(b=_.value)==null?void 0:b[D])==null||H.$touch(),D==="phone"&&se.value.length===0&&i("phoneFilled",o[D]),D==="email"&&se.value.length===0&&i("emailFilled",o[D])},Ae=async()=>{W(),await s(),Y()};return at(()=>{const D=M();let{email:b,phone:H,lastname:c,name:g}=D||{};u.value&&(b=$.value??b,H=re.value??H,c=fe.value??c,g=k.value??g),o.phone=H,o.email=b,o.lastname=c,o.name=g,o.subscription=(D==null?void 0:D.subscription)??!0,o.personalAgreement=(D==null?void 0:D.personalAgreement)??!0,L({...D,email:o.email,lastname:o.lastname,name:o.name,phone:o.phone})}),we(u,()=>{u.value&&y.value&&(o.phone=re.value??o.phone,o.email=$.value??o.email,o.name=k.value??o.name,o.lastname=fe.value??o.lastname)}),we(o,()=>{L({...o})}),ct("isShowLoginModal",t),(D,b)=>{const H=Sn,c=Dt,g=Bt,h=da,C=It,j=Ut;return V(),ee("div",{class:Ye(["checkout-auth",{loading:e(I)}])},[E("div",Na,[E("p",null,oe(D.$t("contact")),1),e(u)?(V(),ee("button",{key:1,class:"checkout-auth_login-button",onClick:Ae},oe(D.$t("logout")),1)):(V(),ee("button",{key:0,class:"checkout-auth_login-button",onClick:b[0]||(b[0]=m=>t.value=!0)},oe(D.$t("login")),1))]),R(C,null,{default:ue(()=>[R(c,null,{default:ue(()=>[R(H,{modelValue:e(o).phone,"onUpdate:modelValue":b[1]||(b[1]=m=>e(o).phone=m),class:"checkout-input",disabled:e(I),errors:e(se),label:"write_phone_number","data-attributes":{field:e(o).phone},onBlur:b[2]||(b[2]=m=>pe("phone")),onChange:b[3]||(b[3]=m=>Z("phone"))},null,8,["modelValue","disabled","errors","data-attributes"])]),_:1}),R(c,null,{default:ue(()=>[R(g,{modelValue:e(o).email,"onUpdate:modelValue":b[4]||(b[4]=m=>e(o).email=m),class:"checkout-input",disabled:e(I)||e(u)&&!!e($),errors:e(F),label:"email","data-attributes":{field:e(o).email},type:"email",onBlur:b[5]||(b[5]=m=>pe("email")),onChange:b[6]||(b[6]=m=>Z("email"))},null,8,["modelValue","disabled","errors","data-attributes"])]),_:1}),R(c,null,{default:ue(()=>[R(g,{modelValue:e(o).name,"onUpdate:modelValue":b[7]||(b[7]=m=>e(o).name=m),errors:e(T),disabled:e(I),label:`${D.$t("name")}`,required:"",maxlength:"50","data-field":"name",onBlur:b[8]||(b[8]=m=>pe("name")),onChange:Se},null,8,["modelValue","errors","disabled","label"])]),_:1}),R(c,null,{default:ue(()=>[R(g,{modelValue:e(o).lastname,"onUpdate:modelValue":b[9]||(b[9]=m=>e(o).lastname=m),disabled:e(I),label:`${D.$t("surname")}`,maxlength:"80","data-field":"lastname",onBlur:b[10]||(b[10]=m=>pe("lastname")),onChange:b[11]||(b[11]=m=>Z("lastname"))},null,8,["modelValue","disabled","label"])]),_:1}),e(u)?Ce("",!0):(V(),ce(c,{key:0},{default:ue(()=>[R(h,{modelValue:e(o).personalAgreement,"onUpdate:modelValue":b[12]||(b[12]=m=>e(o).personalAgreement=m),"error-messages":e(ye),disabled:e(I),onChange:b[13]||(b[13]=m=>e(_).personalAgreement.$touch()),onBlur:b[14]||(b[14]=m=>e(_).personalAgreement.$touch())},null,8,["modelValue","error-messages","disabled"])]),_:1})),R(c,{"small-indent":""},{default:ue(()=>[R(Oa,{modelValue:e(o).subscription,"onUpdate:modelValue":b[15]||(b[15]=m=>e(o).subscription=m),name:"checkout-newseller",disabled:e(I)},null,8,["modelValue","disabled"])]),_:1})]),_:1}),R(j,{modelValue:e(t),"onUpdate:modelValue":b[16]||(b[16]=m=>Ie(t)?t.value=m:null),"max-width":600},{default:ue(()=>[R(_a)]),_:1},8,["modelValue"])],2)}}},Ta=xe(La,[["__scopeId","data-v-01eac9b7"]]),ja={class:"select_label"},Qa={class:"select_shell"},Ga={class:"select_content"},za={class:"select_name"},Wa={class:"select_region"},Za=["onClick"],Ka={class:"select_content"},Ja={class:"select_name"},Ya={class:"select_region"},Ha={class:"select_intersect"},Xa={key:1,class:"select_errors"},es={__name:"UiCitiesAutocomplete",props:{query:{type:String,required:!0},disabled:{type:Boolean,default:!1},selectedCity:{type:Object,default:null},countryValue:{type:Object,default:()=>{},required:!0},label:{type:String,default:""},required:{type:Boolean,default:!1}},emits:["changeQuery","select"],setup(r,{emit:B}){const s=r,t=B,l=w(null),d=w(null),{width:o}=oa(),{y}=ra(),{getPosition:u}=ya(),{fetchCitiesInCart:i,getCitiesMeta:L}=yt(),{getErrors:M,defaultRequiredMessage:de}=mt(),{isLoading:G,startLoading:me,stopLoading:P}=Je(),K=w(s.query),I=st({searchQuery:{defaultRequiredMessage:de}},{searchQuery:K}),W=w([]),Y=w([]),v=w(1),_=w(1),T=w(!1),se=w(!1),F=N(()=>M(I.value.searchQuery)),ye=(h,C)=>h.filter(j=>j.id!==(C==null?void 0:C.id)),Se=(...h)=>Array.from(new Map(h.flat().map(C=>[C.id,C])).values()),Z=()=>{T.value=!0},k=async()=>{var h;if(s.selectedCity&&s.selectedCity.name){const C=await i(s.countryValue.id,1,s.selectedCity.name);Y.value=ye(Se(C,Y.value),s.selectedCity)}else W.value=await i(s.countryValue.id,1),Y.value=ye(W.value,s.selectedCity);_.value=((h=L.value)==null?void 0:h.last_page)||1},$=()=>{I.value.searchQuery.$touch()},re=()=>{T.value=!1,s.selectedCity&&!ze(K.value,s.selectedCity.name)&&(K.value=s.selectedCity.name)},fe=Pt(async h=>{var j;if(!h){b();return}se.value=!0,me(),I.value.$touch(),t("changeQuery",h),v.value=1;const C=await i(s.countryValue.id,v.value,h);_.value=((j=L.value)==null?void 0:j.last_page)||1,Y.value=ye(C,s.selectedCity),se.value=!1,P()},500),pe=async(h,C,j)=>{if(j){if(me(),v.value+=1,v.value<=_.value){const m=await i(s.countryValue.id,v.value,K.value||"");Y.value=ye(Se(Y.value,m),s.selectedCity)}P()}},Ae=async h=>{var C;K.value=h.name,T.value=!1,((C=s.selectedCity)==null?void 0:C.id)!==h.id&&t("select",h)},D=()=>{var h;T.value=!1,t("changeQuery",(h=s.selectedCity)==null?void 0:h.name)},b=()=>{K.value||t("select",null)};kn(async()=>{me(),await k(),s.selectedCity||t("select",Y.value[0]),P()}),we(()=>s.query,h=>{K.value=h}),we(()=>s.selectedCity,async(h,C)=>{(h==null?void 0:h.crm_id)!==(C==null?void 0:C.crm_id)&&(h==null?void 0:h.id)!==(C==null?void 0:C.id)&&(h==null?void 0:h.country_id)!==(C==null?void 0:C.country_id)&&((h==null?void 0:h.country_id)!==(C==null?void 0:C.country_id)&&(Y.value=[]),await k())});const H=w({}),c=gt("scrollPos"),g=N(()=>u(l.value,d.value,H.value));return we([o,y,c==null?void 0:c.value],()=>{T.value&&(H.value=u(l.value,d.value,H.value))}),(h,C)=>{var he;const j=ft,m=fa,O=mn("intersect"),De=mn("click-outside");return Ge((V(),ee("div",{ref_key:"selectRef",ref:l,class:Ye(["select select__with-icon",{select__error:(he=e(F))==null?void 0:he.length}])},[R(j,{class:"select_with-icon",icon:"searchIcon"}),Ge(E("input",{"onUpdate:modelValue":[C[0]||(C[0]=le=>Ie(K)?K.value=le:null),C[1]||(C[1]=(...le)=>e(fe)&&e(fe)(...le))],type:"text",class:"select_fake-input",onClick:Z,onBlur:$},null,544),[[Hn,e(K)]]),E("label",ja,[Ne(oe(r.label),1),r.required?(V(),ee(Le,{key:0},[Ne("*")],64)):Ce("",!0)]),e(T)?(V(),ce(ea,{key:0,to:"body"},[E("div",{ref_key:"dropdown",ref:d,class:Ye(["select_dropdown",{select_dropdown__open:e(T)}]),style:Xn({...e(g),...e(H)})},[Ge(E("ul",null,[r.selectedCity&&r.selectedCity.name&&r.selectedCity.region?(V(),ee("li",{key:0,class:"select_city-item",onClick:D},[E("div",Qa,[R(j,{icon:"pin",class:"select_icon__primary"}),E("div",Ga,[E("div",za,oe(r.selectedCity.name),1),E("div",Wa,oe(r.selectedCity.region.name),1)])]),R(j,{icon:"check",class:"select_icon select_icon__primary"})])):Ce("",!0),(V(!0),ee(Le,null,tt(e(Y),le=>(V(),ee("li",{key:le.id,class:"select_city-item",onClick:Pe=>Ae(le)},[R(j,{icon:"pin",class:"select_icon select_icon__primary"}),E("div",Ka,[E("div",Ja,oe(le.name),1),E("div",Ya,oe(le.region.name),1)])],8,Za))),128)),Ge(E("li",Ha,null,512),[[O,pe]]),Ge(E("li",null,[R(m,{class:"select_loading"})],512),[[ut,e(G)]])],512),[[ut,!e(se)]]),Ge(R(m,{class:"select_loading"},null,512),[[ut,e(G)&&e(se)]]),Ge(E("div",{class:"select_empty"},oe(h.$t("results_not_found")),513),[[ut,!e(Y).length&&!r.selectedCity&&!e(G)]])],6)])):Ce("",!0),e(F)?(V(),ee("div",Xa,[(V(!0),ee(Le,null,tt(e(F),le=>(V(),ee("span",{key:le},oe(le),1))),128))])):Ce("",!0)],2)),[[De,{handler:re}]])}}},ts=xe(es,[["__scopeId","data-v-6059478a"]]),ns={name:"checkoutSearch",class:"add-address_row"},as={class:"add-address_row"},ss={__name:"checkout-add-user-address",props:{disabled:{type:Boolean,default:!1},city:{type:Object,default:()=>{},required:!1},country:{type:Object,default:()=>{}},cityName:{type:String,default:""},countryList:{type:Array,required:!0},cityQuery:{type:String,default:""}},emits:["updateBillingForm"],setup(r,{emit:B}){var K,I,W,Y,v,_,T,se,F,ye,Se,Z;const s={crm_id:null,country:null,zip_code:"",city:null,street:null,house_number:null,apartment_number:null},t=r,l=B,{getDeliveryData:d,saveDeliveryData:o}=Te(),{defaultRequiredMessage:y,getErrors:u}=mt(),i=He({...s,city_cms_id:((K=t.city)==null?void 0:K.id)||null,country_cms_id:((I=t==null?void 0:t.country)==null?void 0:I.id)||null,region_cms_id:((Y=(W=t.city)==null?void 0:W.region)==null?void 0:Y.id)||null,city_crm_id:((v=t.city)==null?void 0:v.crm_id)||null,country_crm_id:((_=t==null?void 0:t.country)==null?void 0:_.crm_id)||null,region_crm_id:((se=(T=t.city)==null?void 0:T.region)==null?void 0:se.crm_id)||null,city_name:((F=t==null?void 0:t.city)==null?void 0:F.name)||t.cityName||null,country_name:((ye=t==null?void 0:t.country)==null?void 0:ye.name)||null,region_name:((Z=(Se=t.city)==null?void 0:Se.region)==null?void 0:Z.name)||null}),L=N(()=>({city_name:{defaultRequiredMessage:y},street:{defaultRequiredMessage:y},house_number:{defaultRequiredMessage:y}})),M=N(()=>t.countryList.map(k=>({label:k.name,value:k.id}))),de=st(L,i),G=N(()=>u(de.value.street)),me=N(()=>u(de.value.house_number)),P=k=>{var $,re;(re=($=de.value)==null?void 0:$[k])==null||re.$touch()};return we(()=>t.cityName,()=>{var k,$,re,fe,pe,Ae,D,b,H,c,g,h;t.cityName&&(i.city_name=t.cityName),t.city&&(i.city_cms_id=((k=t.city)==null?void 0:k.id)||null,i.country_cms_id=(($=t==null?void 0:t.country)==null?void 0:$.id)||null,i.region_cms_id=((fe=(re=t.city)==null?void 0:re.region)==null?void 0:fe.id)||null,i.city_crm_id=((pe=t.city)==null?void 0:pe.crm_id)||null,i.country_crm_id=((Ae=t==null?void 0:t.country)==null?void 0:Ae.crm_id)||null,i.region_crm_id=((b=(D=t.city)==null?void 0:D.region)==null?void 0:b.crm_id)||null,i.city_name=((H=t==null?void 0:t.city)==null?void 0:H.name)||t.cityName||null,i.country_name=((c=t==null?void 0:t.country)==null?void 0:c.name)||null,i.region_name=((h=(g=t.city)==null?void 0:g.region)==null?void 0:h.name)||null)}),we(()=>({...i}),(k,$)=>{if(!ze(k,$)){const re=d();o({...re,address:{...k}}),l("updateBillingForm",k)}}),at(()=>{var $,re,fe,pe;const k=d();k&&(k!=null&&k.address)&&(i.apartment_number=(($=k.address)==null?void 0:$.apartment_number)||null,i.house_number=((re=k.address)==null?void 0:re.house_number)||null,i.street=((fe=k.address)==null?void 0:fe.street)||null,i.zip_code=((pe=k.address)==null?void 0:pe.zip_code)||null)}),(k,$)=>{const re=xt,fe=ts,pe=Bt,Ae=Dt,D=It;return V(),ce(D,{class:"add-address"},{default:ue(()=>[R(Ae,{class:"add-address_row"},{default:ue(()=>{var b,H;return[E("div",ns,[((b=r.countryList)==null?void 0:b.length)>1?(V(),ce(re,{key:0,modelValue:e(i).country,"onUpdate:modelValue":[$[0]||($[0]=c=>e(i).country=c),$[1]||($[1]=c=>k.$emit("changeCountryBase",c))],options:e(M),disabled:r.disabled,label:k.$t("country"),name:"country",class:"checkout-delivery_country",onBlur:$[2]||($[2]=c=>P("country"))},null,8,["modelValue","options","disabled","label"])):Ce("",!0),(H=r.country)!=null&&H.id?(V(),ce(fe,{key:1,ref:"checkoutSearchRef","with-search":"",required:"",query:r.cityQuery||"","country-value":r.country,"selected-city":r.city,disabled:r.disabled,label:k.$t("city"),class:"checkout-delivery_city",onSelect:$[3]||($[3]=c=>k.$emit("selectCityBase",c)),onChangeCountryBase:$[4]||($[4]=c=>k.$emit("changeQueryCityBase",c))},null,8,["query","country-value","selected-city","disabled","label"])):Ce("",!0)]),E("div",as,[R(pe,{modelValue:e(i).street,"onUpdate:modelValue":$[5]||($[5]=c=>e(i).street=c),label:"street","data-field":"street",errors:e(G),required:"",onBlur:$[6]||($[6]=c=>P("street"))},null,8,["modelValue","errors"])])]}),_:1}),R(Ae,{class:"add-address_row"},{default:ue(()=>[R(pe,{modelValue:e(i).house_number,"onUpdate:modelValue":$[7]||($[7]=b=>e(i).house_number=b),"data-field":"house_number",errors:e(me),label:"house_number",required:"",onBlur:$[8]||($[8]=b=>P("house_number"))},null,8,["modelValue","errors"]),R(pe,{modelValue:e(i).apartment_number,"onUpdate:modelValue":$[9]||($[9]=b=>e(i).apartment_number=b),label:"number_apartment","data-field":"apartment"},null,8,["modelValue"])]),_:1})]),_:1})}}},ls=xe(ss,[["__scopeId","data-v-b385876e"]]),Vn=()=>({getDeliveryType:(s,t)=>{var l,d,o;return(t==null?void 0:t.group)!=="pickup"?t:{...t,id:(l=s.address)==null?void 0:l.id,name:(d=s.address)==null?void 0:d.name,shopName:(o=s.shop)==null?void 0:o.name}},getDeliveryRequest:(s,t=!1)=>t?{type:s==null?void 0:s.group,name:s.name,id:(s==null?void 0:s.id)||null}:s.name}),os={key:0,class:"checkout-delivery-form"},rs={class:"checkout-delivery-form_pickup-select"},is={key:1},us={__name:"checkout-delivery-form",props:{delivery:{type:Array,required:!0},cityName:{type:String,default:""},city:{type:Object,default:()=>{},required:!1},disabled:{type:Boolean,default:!1},isPickup:{type:Boolean,default:!1},selectedValue:{type:String,default:""},country:{type:Object,default:()=>{}},cityQuery:{type:String,default:""}},emits:["change"],setup(r,{emit:B}){const s=r,t=B,l=N(()=>s.isPickup?s.delivery:[]),{getDeliveryRequest:d}=Vn(),o=u=>{const i=l.value.find(L=>L.name===u);t("change",d(i,!0))},y=u=>u.map(i=>({label:`${i.shopName||""} | ${i.name||""}`,value:i.name}));return(u,i)=>{const L=xt;return r.isPickup?(V(),ee("div",os,[E("div",rs,[R(L,ht({...u.$attrs},{disabled:r.disabled,icon:"shop",label:u.$t("pickup_department"),options:y(e(l)),"onUpdate:modelValue":i[0]||(i[0]=M=>o(M))}),null,16,["disabled","label","options"])])])):(V(),ee("div",is,[R(ls,{city:r.city,"city-name":r.cityName,country:r.country,"city-query":r.cityQuery,onUpdateBillingForm:i[1]||(i[1]=M=>u.$emit("updateBillingForm",M)),onChangeCountryBase:i[2]||(i[2]=M=>u.$emit("changeCountryBase",M)),onSelectCityBase:i[3]||(i[3]=M=>u.$emit("selectCityBase",M)),onChangeQueryCityBase:i[4]||(i[4]=M=>u.$emit("changeQueryCityBase",M))},null,8,["city","city-name","country","city-query"])]))}}},cs=xe(us,[["__scopeId","data-v-2f1beceb"]]),ds={key:0,class:"delivery-method_message"},ms={__name:"checkout-delivery-method",props:{delivery:{type:Array,default:()=>[],required:!0},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},cityName:{type:String,default:""},city:{type:Object,default:()=>{}},country:{type:Object,default:()=>{}},isPickup:{type:Boolean,default:!1},selectedValue:{type:String,default:""},cityQuery:{type:String,default:""}},setup(r){const B=r,s=gt("isShownCourierMessage"),t=w(B.selectedValue);return(l,d)=>{const o=ft;return V(),ee("div",null,[e(s)?(V(),ee("div",ds,[R(o,{icon:"warningWithBorderIcon",class:"delivery-method_icon"}),Ne(" "+oe(l.$t("warning_message_delivery_courier")),1)])):Ce("",!0),R(cs,{modelValue:e(t),"onUpdate:modelValue":d[0]||(d[0]=y=>Ie(t)?t.value=y:null),delivery:r.delivery,"city-name":r.cityName,city:r.city,country:r.country,disabled:r.disabled,"is-pickup":r.isPickup,"city-query":r.cityQuery,onChange:d[1]||(d[1]=y=>l.$emit("change",y)),onUpdateBillingForm:d[2]||(d[2]=y=>l.$emit("updateBillingForm",y)),onChangeCountryBase:d[3]||(d[3]=y=>l.$emit("changeCountryBase",y)),onSelectCityBase:d[4]||(d[4]=y=>l.$emit("selectCityBase",y)),onChangeQueryCityBase:d[5]||(d[5]=y=>l.$emit("changeQueryCityBase",y))},null,8,["modelValue","delivery","city-name","city","country","disabled","is-pickup","city-query"])])}}},ps=xe(ms,[["__scopeId","data-v-fc138847"]]),_s={class:"switch_label"},vs=Vt({__name:"UiSwitch",props:{label:{},modelValue:{type:Boolean}},emits:["update:modelValue","change"],setup(r,{emit:B}){const s=r,t=B,l=w(s.modelValue),d=()=>{l.value=!l.value,t("change"),t("update:modelValue",l.value)};return(o,y)=>(V(),ee("div",{class:Ye(["switch",{switch__active:o.modelValue}]),onClick:d},[y[0]||(y[0]=E("div",{class:"switch_control"},[E("div",{class:"switch_control-round"})],-1)),E("div",_s,oe(o.label),1)],2))}}),ys=xe(vs,[["__scopeId","data-v-bbc69e0c"]]),fs={class:"checkout-other-recipient"},hs={key:0},gs={__name:"checkout-other-recipient",props:{spaceTop:{type:Boolean,default:!1},isOtherRecipient:{type:Boolean,default:!1},showOtherRecipient:{type:Boolean,default:!0},isStateEmpty:{type:Boolean,default:!0}},emits:["changeShowRecipient","updateOtherRecipient"],setup(r,{emit:B}){const s=r,t=B,{isLoading:l}=Je(),{saveDeliveryData:d,getDeliveryData:o}=Te(),y=w(s.isOtherRecipient||s.showOtherRecipient),u=He({first_name:null,last_name:null,phone:null}),{defaultRequiredMessage:i,getErrors:L,defaultPhoneRequiredMessage:M}=mt(),de=N(()=>y.value?{first_name:{defaultRequiredMessage:i},last_name:{defaultRequiredMessage:i},phone:{defaultRequiredMessage:i,defaultPhoneRequiredMessage:M}}:{}),G=st(de,u),me=N(()=>L(G.value.first_name)),P=N(()=>L(G.value.last_name)),K=N(()=>L(G.value.phone)),I=v=>{var _,T;(T=(_=G.value)==null?void 0:_[v])==null||T.$touch()},W=Pt(v=>{const _=o();d(_?{..._,user:{...v}}:{user:{...v}})},3e3),Y=v=>{v||(u.first_name=null,u.last_name=null,u.phone=null,G.value.$reset())};return at(()=>{const v=o();if(v!=null&&v.user){const{phone:_,last_name:T,first_name:se,is_other_recipient:F}=v.user;u.phone=_,u.last_name=T,u.first_name=se,y.value=F,G.value.$touch()}}),we(y,v=>{t("changeShowRecipient",v)}),we(()=>({...u}),(v,_)=>{ze(v,_)||(t("updateOtherRecipient",v),W({...v,is_other_recipient:y.value}))}),(v,_)=>{const T=ys,se=Bt,F=Dt,ye=Sn,Se=It;return V(),ee("div",fs,[r.isStateEmpty||!r.showOtherRecipient?(V(),ee("div",hs,[R(T,{modelValue:e(y),"onUpdate:modelValue":_[0]||(_[0]=Z=>Ie(y)?y.value=Z:null),label:v.$t("recipient_another_people"),onChange:_[1]||(_[1]=Z=>Y(Z))},null,8,["modelValue","label"])])):Ce("",!0),!r.isStateEmpty&&r.showOtherRecipient||e(y)?(V(),ce(Se,{key:1,class:"checkout-other-recipient_form"},{default:ue(()=>[R(F,null,{default:ue(()=>[R(se,{modelValue:e(u).first_name,"onUpdate:modelValue":_[2]||(_[2]=Z=>e(u).first_name=Z),"data-attributes":{field:e(u).first_name},label:"name",disabled:e(l),errors:e(me),required:"",onBlur:_[3]||(_[3]=Z=>I("first_name"))},null,8,["modelValue","data-attributes","disabled","errors"]),R(se,{modelValue:e(u).last_name,"onUpdate:modelValue":_[4]||(_[4]=Z=>e(u).last_name=Z),"data-attributes":{field:e(u).last_name},label:"surname",disabled:e(l),errors:e(P),required:"",onBlur:_[5]||(_[5]=Z=>I("last_name"))},null,8,["modelValue","data-attributes","disabled","errors"])]),_:1}),R(F,null,{default:ue(()=>[R(ye,{modelValue:e(u).phone,"onUpdate:modelValue":_[6]||(_[6]=Z=>e(u).phone=Z),"data-attributes":{field:e(u).phone},label:"write_phone_number",disabled:e(l),errors:e(K),required:"",onBlur:_[7]||(_[7]=Z=>I("phone"))},null,8,["modelValue","data-attributes","disabled","errors"])]),_:1})]),_:1})):Ce("",!0)])}}},bs=xe(gs,[["__scopeId","data-v-8259f0f6"]]),Rn={__name:"delivery-saved-items",props:{value:{type:Object,required:!0},createName:{type:Function,required:!0},items:{type:Array,default:()=>[],required:!0},newType:{type:String,required:!0},newIcon:{type:String,required:!0},isShowItemIcon:{type:Boolean,default:!0},isSubtitleShown:{type:Boolean,default:!1},modelValue:{type:Object,required:!0}},emits:["change"],setup(r,{emit:B}){const s=r,t=B,l=w(s.createName(s.modelValue)||null),d=w([]),o=N(()=>{var i;const u=[...(i=s.items)==null?void 0:i.map(L=>{const M=s.newType?s.createName(L):L.title;return d.value.push({...L,markValue:M}),{label:M,value:M}})];return d.value.push({label:s.newType,value:s.newType,markValue:s.newType}),[...u,{label:s.newType,value:s.newType}]}),y=u=>{l.value=u;const i=d.value.find(L=>L.markValue===u);t("change",i)};return(u,i)=>{const L=xt;return V(),ce(L,{modelValue:e(l),"onUpdate:modelValue":[i[0]||(i[0]=M=>Ie(l)?l.value=M:null),y],options:e(o)},null,8,["modelValue","options"])}}},Cs={__name:"checkout-saved-addresses",setup(r){const{getUser:B}=Xe(),{t:s}=nt(),t=l=>{var o;return`${(o=B.value)!=null&&o.is_partner_company_employee?`${l==null?void 0:l.country_name}, `:""} ${l==null?void 0:l.city_name}, ${s("short_street")} ${l==null?void 0:l.street}, ${l==null?void 0:l.house_number}`};return(l,d)=>(V(),ce(Rn,ht({...l.$attrs},{items:l.userAddresses,"create-name":t,label:l.$t("saved_addresses"),"new-icon":"newAddress","new-type":"new_delivery","is-subtitle-shown":"",onChange:d[0]||(d[0]=o=>l.$emit("change",o))}),null,16,["items","label"]))}},ks={__name:"checkout-saved-recipients",setup(r){const B=s=>{const t=(s==null?void 0:s.first_name)||(s==null?void 0:s.name)||"",l=(s==null?void 0:s.last_name)||(s==null?void 0:s.lastname)||"",d=s!=null&&s.phone?`| ${s.phone}`:"";return`${t} ${l} ${d}`};return(s,t)=>(V(),ce(Rn,ht({...s.$attrs},{"create-name":B,label:s.$t("saved_recipients"),"new-icon":"newRecipient","is-show-item-icon":!1,"new-type":"new_recipient",onChange:t[0]||(t[0]=l=>s.$emit("change",l))}),null,16,["label"]))}},$s=()=>{const{zipCodeMaxLength:r}=Tn();return{isCourierDeliveryCarried:t=>t?t.length<r:!0,getCityProperties:(t=[],l="",d="")=>{var P,K;if(!d||!l)return null;const o=t==null?void 0:t.find(I=>l===I.category),y=(P=o==null?void 0:o.items)==null?void 0:P.find(I=>d===I.name);if(o&&y)return{item:null,group:null};const u=l.includes("express"),i=l.includes("regional"),L=I=>{const W=I.includes("regional"),Y=I.includes("express");return I.includes("courier")?u&&i?Y:u&&!i?Y&&W:!u&&i?!Y&&!W:!u&&!i?W&&!Y:!1:!1},M=t.find(I=>L(I.category)),de=(K=M==null?void 0:M.items)==null?void 0:K.find(I=>L(I.name));if(M&&de)return{item:de,group:M};const G=t[0];return{item:G==null?void 0:G.items[0],group:G}}}},ws={class:"delivery-methods"},Ss={class:"delivery-methods_title"},As={class:"delivery-methods_icon"},Vs={key:1,class:"delivery-methods_item delivery-methods_item__big-indent"},Rs={__name:"checkout-delivery-methods",props:{deliveries:{type:Array,required:!0},countryList:{type:Array,required:!0},cityQuery:{type:String,default:""},deliveryMethodsState:{type:Object,required:!0},cityName:{type:String,default:""},city:{type:Object,default:()=>{},required:!1},disabled:{type:Boolean,default:!1},country:{type:Object,default:()=>{}}},emits:["change","changeCategory","changeState"],setup(r,{emit:B}){var Ae,D,b,H;const s={first_name:null,last_name:null,phone:null},t=r,l=B,{pushGtmEvent:d}=dt(),{t:o}=nt(),{saveDeliveryData:y,getDeliveryData:u}=Te(),{getUser:i}=Xe(),{getCityProperties:L}=$s(),{getDeliveryRequest:M,getDeliveryType:de}=Vn(),G=w([]),me=w([]),P=He({selectedAddress:((Ae=t.deliveryMethodsState)==null?void 0:Ae.selectedAddress)||null,selectedRecipient:{...(D=t.deliveryMethodsState)==null?void 0:D.selectedRecipient,markValue:(H=(b=t.deliveryMethodsState)==null?void 0:b.selectedRecipient)==null?void 0:H.first_name},isOtherRecipient:!1,otherRecipient:{...s},billingForm:null}),K=w(!0),I=w(!0),W=w(!1),Y=w(!1),v=w(""),_=w(null),T=w([]),se=w({}),F=N(()=>_.value==="pickup"),ye=gt("isTradeInProductSelected"),Se=c=>{v.value=c.name||c,l("change",c);const g=u();y({...g,category:_.value,type:v.value})},Z=Pt(c=>{v.value=F.value?c.name:c,l("change",c)},1e3),k=(c=!1)=>{var j;const g=[],h={};(j=t.deliveries)!=null&&j.length||(T.value=[]),t.deliveries.forEach(m=>{var O;if(m!=null&&m.addresses&&Array.isArray(m.addresses)){({...m});const De=m.addresses.map(he=>de(he,m));g.push({category:m.name,tradeInDisabled:!m.is_trade_in,items:De}),h[m.name]=m.cost}else(O=m.group)!=null&&O.includes("pickup")||(g.push({category:m.name,tradeInDisabled:!m.is_trade_in,items:[m]}),h[m.name]=m.cost)});const C=L(g,_.value,v.value);if(C&&C.item&&C.group)_.value=C.group.category,v.value=C.item.name,l("changeCategory",C.group.category);else if(C&&!c){const m=g.find(O=>O.category===_.value).items.find(O=>O.name===v.value);m&&Se(M(m,F.value))}T.value=g,se.value={...h}},$=c=>{Y.value=(c==null?void 0:c.markValue)==="new_delivery",Y.value||(P.billingForm=null),P.selectedAddress=c},re=c=>{W.value=(c==null?void 0:c.markValue)==="new_recipient",W.value?P.otherRecipient={...s}:(P.otherRecipient={...s},P.selectedRecipient={...c,markValue:c==null?void 0:c.first_name})};let fe;const pe=()=>{fe=we(i,()=>{var c,g,h,C,j,m,O,De,he,le,Pe,a,A,S,X,J,q,te,x;if(i.value){if(K.value=!((g=(c=i.value)==null?void 0:c.addresses)!=null&&g.length),I.value=!((C=(h=i.value)==null?void 0:h.recipients)!=null&&C.length),(j=i.value)!=null&&j.addresses){const ke=(m=i.value)!=null&&m.is_partner_company_employee?`${address==null?void 0:address.country_name}, `:"";me.value=((O=i.value)==null?void 0:O.addresses)||[],P.selectedAddress=((he=(De=i.value)==null?void 0:De.addresses)==null?void 0:he.find(Ve=>Ve.is_primary))||me.value[0],P.selectedAddress&&(P.selectedAddress.markValue=`${ke} ${(le=P.selectedAddress)==null?void 0:le.city_name}, ${o("short_street")} ${(Pe=P.selectedAddress)==null?void 0:Pe.street}, ${(a=P.selectedAddress)==null?void 0:a.house_number}`)}const U={first_name:(A=i.value)==null?void 0:A.name,last_name:(S=i.value)==null?void 0:S.lastname,phone:(X=i.value)==null?void 0:X.phone,id:null,markValue:(J=i.value)==null?void 0:J.name};G.value=[U],(te=(q=i.value)==null?void 0:q.recipients)==null||te.forEach(ke=>{G.value.push({...ke,markValue:ke==null?void 0:ke.name})}),P.selectedRecipient={...U},fe&&((x=i.value)!=null&&x.addresses)&&fe()}},{immediate:!0})};return we(()=>t.deliveries,(c,g)=>{JSON.stringify(g)!==JSON.stringify(c)&&k()}),we(()=>({...P}),(c,g)=>{ze(c,g)||l("changeState",{...c})}),we(_,()=>{var m;const c=(m=T.value.find(O=>(O==null?void 0:O.category)===_.value))==null?void 0:m.items,h=(c==null?void 0:c.find(O=>O.shopName===v.value))||c[0];v.value=h.name;const C=u();d("addShippingInfo",F.value?"pickup":"delivery"),y({...C,category:_.value,type:v.value});const j=M(h,F.value);Z(j)}),at(()=>{var C,j,m;pe(),k(!0);const c=u(),g=T.value.findIndex(O=>(O==null?void 0:O.category)===(c==null?void 0:c.category)),h=g!==-1?T.value[g].items.findIndex(O=>O.name===(c==null?void 0:c.type)):-1;if(c&&c.category&&c.type&&g!==-1&&h!==-1){const O=localStorage.getItem("shop");if(O){_.value="pickup";const De=T.value.find(le=>le.category==="pickup");let he="";De.items.find(le=>le.addresses.map(Pe=>{Pe.shop.id===Number(O)&&(he=Pe.shop.name)})),he&&(v.value=he);return}_.value=c.category,l("changeCategory",c.category),v.value=c.type}else _.value=(C=T.value[0])==null?void 0:C.category,l("changeCategory",(j=T.value[0])==null?void 0:j.category),v.value=(m=T.value[0])==null?void 0:m.items[0].name}),we(()=>ye.value,c=>{if(c){const g=T.value.find(h=>!h.tradeInDisabled);g&&(_.value=g.category)}}),(c,g)=>{const h=ft,C=hn;return V(),ee("div",ws,[(V(!0),ee(Le,null,tt(e(T),j=>(V(),ce(C,{key:j.category,modelValue:e(_),"onUpdate:modelValue":g[9]||(g[9]=m=>Ie(_)?_.value=m:null),value:j.category,disabled:j.tradeInDisabled&&!!e(ye),checked:e(_)===j.category},bn({label:ue(()=>[E("div",Ss,[E("span",null,oe(c.$t(j.category)),1),E("div",As,[R(h,{icon:j.category,"container-size":""},null,8,["icon"])])])]),_:2},[e(_)===j.category?{name:"content",fn:ue(()=>[E("div",{class:Ye(["delivery-methods_shell",{"delivery-methods__column":e(Y)||e(F)||!e(I)&&e(K)}])},[e(K)?Ce("",!0):Ge((V(),ce(Cs,{key:0,modelValue:e(P).selectedAddress,"onUpdate:modelValue":g[0]||(g[0]=m=>e(P).selectedAddress=m),items:e(me),class:"delivery-methods_item__single",onChange:$},null,8,["modelValue","items"])),[[ut,!e(F)]]),e(K)||e(Y)||e(F)?(V(),ee("div",Vs,[(V(!0),ee(Le,null,tt(e(T),m=>(V(),ee(Le,null,[m.category===e(_)?(V(),ce(ps,{key:m.category,"is-pickup":m.category==="pickup",disabled:r.disabled,delivery:m.items,"selected-value":e(v),city:r.city,country:r.country,"city-name":r.cityName,"city-query":r.cityQuery,onChange:g[1]||(g[1]=O=>Se(O)),onUpdateBillingForm:g[2]||(g[2]=O=>e(P).billingForm=O),onChangeCountryBase:g[3]||(g[3]=O=>c.$emit("changeCountryBase",O)),onSelectCityBase:g[4]||(g[4]=O=>c.$emit("selectCityBase",O)),onChangeQueryCityBase:g[5]||(g[5]=O=>c.$emit("changeQueryCityBase",O))},null,8,["is-pickup","disabled","delivery","selected-value","city","country","city-name","city-query"])):Ce("",!0)],64))),256))])):Ce("",!0),!e(K)||!e(I)?(V(),ce(ks,{key:2,modelValue:e(P).selectedRecipient,"onUpdate:modelValue":g[6]||(g[6]=m=>e(P).selectedRecipient=m),items:e(G),class:Ye({"delivery-methods_item__small-indent":e(W)}),onChange:re},null,8,["modelValue","items","class"])):Ce("",!0),e(I)&&e(K)||e(W)?(V(),ce(bs,{key:3,class:"delivery-methods_item","is-other-recipient":e(P).isOtherRecipient,"show-other-recipient":e(W),"is-state-empty":e(I)&&e(K),onChangeShowRecipient:g[7]||(g[7]=m=>e(P).isOtherRecipient=m),onUpdateOtherRecipient:g[8]||(g[8]=m=>e(P).otherRecipient=m)},null,8,["is-other-recipient","show-other-recipient","is-state-empty"])):Ce("",!0)],2)]),key:"0"}:void 0]),1032,["modelValue","value","disabled","checked"]))),128))])}}},Ke={AZ:8386,GE:34338,AM:1853,MD:75207,CY:[{key:"DEVELOPMENT",value:221392},{key:"STAGE",value:21892},{key:"PRODUCTION",value:221385}],BY:8830,UA:121946,UZ:146883,SA:107820,KZ:221731},Us=()=>{const r=ta(),B=w(null),s=l=>l||(Array.isArray(Ke[r==null?void 0:r.public.iso])?Ke[r.public.currentCountry].find(d=>{var o;return d.key===((o=r==null?void 0:r.public)==null?void 0:o.nodeModel)}).value:Ke[r.public.currentCountry]);return(()=>{Object.keys(Ke).forEach(l=>{var d;(r==null?void 0:r.public.iso)===l&&(Array.isArray(Ke[l])?B.value=(d=Ke[l].find(o=>{var y;return o.key===((y=r.public)==null?void 0:y.nodeModel)}))==null?void 0:d.value:B.value=Ke[l])})})(),{city:B,getCityIdByCountryId:s}},Ds={AZ:300},Bs=r=>{const B=$n().$config.public.iso,{totalPrice:s,deliveryType:t}=r;return{isShownCourierMessage:N(()=>{const d=Ds[B];return d?s.value<=d&&t.value==="courier":!1})}},Is={class:"checkout-delivery"},xs={class:"checkout-delivery_title"},Ps={key:0,class:"checkout-delivery_hint"},Fs={__name:"checkout-delivery",props:{deliveries:{type:Array,required:!0},disabled:{type:Boolean,default:!1},dataUserErrors:{type:Array,default:()=>[]},currentCart:{type:Object,default:()=>{}}},emits:["updateForm"],setup(r,{expose:B,emit:s}){const t=r,l=s,{getCountryList:d}=yt(),{pushGtmEvent:o}=dt(),{t:y}=nt(),{getUser:u}=Xe(),{saveSearchData:i,getSearchData:L,getCountryData:M,saveCountryData:de}=Te(),{getCityIdByCountryId:G}=Us(),{fetchDefaultCountryCity:me,getDefaultCountryCity:P,fetchDeliveryPrimaryCity:K}=yt(),{requiredMessage:I}=mt(),{setCheckoutDelivery:W}=An(),{isAuthUser:Y}=Xe(),v=He({type:null,shop_address_id:null,savedData:{selectedUserAddress:null,selectedUserRecipient:null},billingForm:null,otherRecipient:null}),_=w({delivery:null}),T=N(()=>t.currentCart.total.total_price_with_discount),{isShownCourierMessage:se}=Bs({totalPrice:T,deliveryType:na(v,"type")}),F=w(!0),ye=w(!0),Se=gt("isTradeInProductSelected"),Z=w(""),k=w(null),$=w({name:"",crm_id:null,id:null}),re=w(null),fe=w(null),pe=N(()=>({type:{required:I(y("delivery_method_must_been_selected"))}}));st(pe,v);const Ae=(a,A=!0,S=!0)=>{var J,q,te,x,U,ke,Ve,We,Ee;const X={city_cms_id:a==null?void 0:a.id,country_cms_id:a==null?void 0:a.country_id,region_cms_id:a==null?void 0:a.region.id,city_crm_id:a==null?void 0:a.crm_id,country_crm_id:(J=$.value)==null?void 0:J.crm_id,region_crm_id:(q=a==null?void 0:a.region)==null?void 0:q.crm_id,city_name:a==null?void 0:a.name,country_name:(te=$.value)==null?void 0:te.name,region_name:(x=a==null?void 0:a.region)==null?void 0:x.name,zip_code:"",street:"",house_number:"",apartment_number:""};re.value={city_cms_id:a==null?void 0:a.id,country_cms_id:a==null?void 0:a.country_id,region_cms_id:(U=a==null?void 0:a.region)==null?void 0:U.id,city_crm_id:a==null?void 0:a.crm_id,country_crm_id:(ke=$.value)==null?void 0:ke.crm_id,region_crm_id:(Ve=a==null?void 0:a.region)==null?void 0:Ve.crm_id,city_name:a==null?void 0:a.name,country_name:(We=$.value)==null?void 0:We.name,region_name:(Ee=a==null?void 0:a.region)==null?void 0:Ee.name},_.value.delivery={address:{...X}},v.type&&S?(_.value.delivery.type=v.type,v.shop_address_id&&(_.value.delivery.shop_address_id=v.shop_address_id)):(_.value.delivery.type=null,_.value.delivery.shop_address_id=null),A&&l("updateForm",_.value)},D=a=>{k.value=a,Z.value=(a==null?void 0:a.name)||"",a&&(a!=null&&a.id)&&(i(k.value),Ae(a,!0,!1))},b=async a=>{if(a&&a.id){de(a);const A=G(a.id),S=await me(A);Z.value=S==null?void 0:S.name,$.value={...a},D(S)}},H=N(()=>{var a;return!d.value&&!((a=d.value)!=null&&a.length)?[]:d.value}),c=a=>{l("updateForm",{client_type:Y.value?"":"unregistered",delivery:{...a}})},g=()=>{var J;const{savedData:a,type:A,shop_address_id:S}=v,X=_.value.delivery||{};return a&&A!=="pickup"&&a.selectedUserAddress&&(X.address={...a.selectedUserAddress}),(J=a==null?void 0:a.recipient)!=null&&J.id?X.recipient={phone:a.recipient.phone||null,first_name:a.recipient.first_name||null,last_name:a.recipient.last_name||null}:X.recipient=null,X.type=A,A==="pickup"&&(X.shop_address_id=S),_.value.delivery=X,c(X),_.value},h=a=>{var J,q,te,x,U,ke,Ve,We,Ee,pt,ge;if(a!=null&&a.type&&a.type==="change")return;const A=(a==null?void 0:a.type)==="pickup";A&&typeof a!="string"?(v.type=a.type,v.shop_address_id=a.id):(v.type=a,v.shop_address_id=null);const X=typeof a=="object"&&typeof((te=(q=(J=t.currentCart)==null?void 0:J.delivery)==null?void 0:q.shop_address)==null?void 0:te.address)=="object"?((Ve=(ke=(U=(x=t.currentCart)==null?void 0:x.delivery)==null?void 0:U.shop_address)==null?void 0:ke.address)==null?void 0:Ve.id)!==a.id:((Ee=(We=t.currentCart)==null?void 0:We.delivery)==null?void 0:Ee.type)!==a;!F.value&&X&&o("shippingTier",(ge=(pt=t.currentCart)==null?void 0:pt.products)==null?void 0:ge.map(et=>({...et,quantity:(et==null?void 0:et.ordered_quantity)||1})),{deliveryType:A?a.name:`${y(a)}`}),k.value&&Ae(k.value,!1),W(g()),F.value=!1},C=a=>{var A,S,X,J;if(v.savedData.selectedUserAddress=(S=(A=a.selectedAddress)==null?void 0:A.markValue)!=null&&S.includes("new")?null:a.selectedAddress,v.savedData.selectedUserRecipient=(J=(X=a.selectedRecipient)==null?void 0:X.markValue)!=null&&J.includes("new")?null:a.selectedRecipient,v.otherRecipient=a.otherRecipient,v.billingForm=a.billingForm,v.savedData.selectedUserAddress){const q=a.selectedAddress,te={crm_id:q.country_crm_id,id:q.country_cms_id,name:q.country_name},x={country_id:q.country_cms_id,crm_id:q.city_crm_id,id:q.city_cms_id,name:q.city_name,region:{crm_id:q.region_crm_id,id:q.region_cms_id,name:q.region_name}},U=ze(te,$.value),ke=ze(x,k.value);U||($.value=te),ke||(k.value=x),!ke&&!ye.value&&D(x)}},j=()=>re.value,m=()=>v,O=()=>v.savedData.selectedUserAddress||v.billingForm,De=()=>{var A,S;return!!((A=v.otherRecipient)!=null&&A.first_name||(S=v.otherRecipient)!=null&&S.phone)?v.otherRecipient:v.savedData.selectedUserRecipient};at(()=>{if(!H.value)return;const[a]=H.value;b(a)}),B({takeInfoAboutAddress:O,takeInfoAboutRecipient:De,getLocationInfo:j,getDeliveryValue:m});const he=()=>{var J,q,te,x,U,ke;const a=(q=(J=u.value)==null?void 0:J.addresses)==null?void 0:q.find(Ve=>Ve.is_primary);let A;const S=M(),X=(te=d.value)==null?void 0:te.includes(Ve=>(Ve==null?void 0:Ve.crm_id)===(S==null?void 0:S.crm_id));return a?A={name:a==null?void 0:a.country_name,crm_id:a.country_crm_id,id:a.country_cms_id}:S&&X?A={name:S==null?void 0:S.name,crm_id:S==null?void 0:S.crm_id,id:S==null?void 0:S.id}:(x=u.value)!=null&&x.country?A=(U=u.value)==null?void 0:U.country:A=(ke=d.value)==null?void 0:ke.at(0),d.value?{country:A,cityID:G(A==null?void 0:A.id)}:null},le=async a=>{var J;const A=(J=u.value)==null?void 0:J.addresses,S=L(),X=q=>{var te;return q&&$.value?(q==null?void 0:q.country_id)===((te=$.value)==null?void 0:te.id):!0};if(A&&(A==null?void 0:A.length)>0){const q=A.find(te=>te.is_primary)||(A==null?void 0:A[0]);if(q){const te=await K(q.city_cms_id);if(te)return te}}if(S&&X(S))return S!=null&&S.searchInput?S.searchInput:S;if(!P.value||!X(P.value)){const q=await me(a);if(q)return q}else return P.value;return null};we(u,async(a,A)=>{var S,X;if(!ze(a,A)){const J=he();if(!J)return;$.value.id=J.country.id,$.value.name=J.country.name,$.value.crm_id=J.country.crm_id;const q=await le(J.cityID);((S=J.country)==null?void 0:S.id)!==((X=$.value)==null?void 0:X.id)&&A?D(q):(k.value=q,Z.value=(q==null?void 0:q.name)||""),ye.value=!1}},{immediate:!0}),we(()=>t.deliveries,(a,A)=>{var S,X,J,q,te;ze(a,A)&&A.length===a.length&&((J=(X=(S=t.currentCart)==null?void 0:S.delivery)==null?void 0:X.address)!=null&&J.city)&&!((te=(q=t.currentCart)==null?void 0:q.delivery)!=null&&te.type)&&v.type&&c({..._.value.delivery,type:v.type,shop_address_id:v.shop_address_id})});const Pe=N(()=>H.value.length>=2);return ct("isChangeSearchView",Pe),ct("isShownCourierMessage",se),(a,A)=>(V(),ee("div",Is,[E("h3",xs,oe(a.$t("delivery")),1),e(Se)?(V(),ee("p",Ps,oe(a.$t("delivery_trade_in_disabled")),1)):Ce("",!0),r.deliveries&&e($)?(V(),ce(Rs,{key:1,ref_key:"deliveryMethodsRef",ref:fe,deliveries:r.deliveries,"delivery-methods-state":e(v).savedData,city:e(k),country:e($),disabled:r.disabled,"city-name":e(k)&&e(k).name||"","country-list":e(H),"city-query":e(Z),onChange:A[0]||(A[0]=S=>h(S)),onChangeCategory:A[1]||(A[1]=S=>a.$emit("changeCategory",S)),onChangeState:C,onChangeCountryBase:A[2]||(A[2]=S=>b(S)),onSelectCityBase:A[3]||(A[3]=S=>D(S)),onChangeQueryCityBase:A[4]||(A[4]=S=>Z.value=S)},null,8,["deliveries","delivery-methods-state","city","country","disabled","city-name","country-list","city-query"])):Ce("",!0)]))}},qs=xe(Fs,[["__scopeId","data-v-5f03f81f"]]),Es=()=>({updatePrimaryStatus:(s,t)=>s.map(l=>({...l,is_primary:l.id===t})),hasPrimaryStatusChanged:(s,t)=>s.length!==t.length?!1:s.some((l,d)=>{const o=t[d];return l.is_primary&&!o.is_primary})}),Ms={key:1,class:"checkout-view"},Os={class:"checkout-view_order-summary-mobile"},Ns={class:"checkout-view_container"},Ls={class:"checkout-view_main-content"},Ts={class:"checkout-view_order-summary"},js={class:"checkout-view_order-summary-content"},Qs={__name:"checkout-view",async setup(r){var jt,Qt;let B,s;const{pushGtmEvent:t}=dt(),{getUser:l,setUser:d,isAuthUser:o}=Xe(),y=$n(),{t:u,locale:i}=nt(),L=Cn(),{isLoading:M,startLoading:de,stopLoading:G}=Je(),{isLoading:me,startLoading:P,stopLoading:K}=Je(),{isLoading:I,startLoading:W,stopLoading:Y}=Je(),{isLoading:v}=Je(),{fetchCart:_,fetchCartProducts:T,getCartProducts:se,getCart:F}=yt(),{updatePrimaryStatus:ye,hasPrimaryStatusChanged:Se}=Es(),{getCheckoutState:Z}=An(),{getBaseData:k,getClientData:$,saveBaseData:re,saveSearchData:fe,saveClientData:pe,savePaymentData:Ae,saveDeliveryData:D,getRedirectUrl:b}=Te(),{filterPayments:H}=zn(),c=w(null),g=w(null),{userDevices:h}=gn(),C=w([]),j=w([]),m=w([]),O=w(null),De=w("authRef"),he=pn("paymentRef"),le=pn("deliveryRef"),Pe=w([]),a=w(""),A=w(""),S=w(""),X=w(""),J=w(!1),q=w(null),te=w(!1),x=He({text:"",buttonText:"",title:"",redirectUrl:"",actionAfterRedirect:null,shouldBeAgreed:!1}),U=He({comment:null,credit:null,delivery:null,is_call_back:!1,is_trade_in:!1,payment_type:null,promocode:null,selectCredit:null,shipping:null}),ke=N(()=>{var p;const n=(p=F.value)==null?void 0:p.products;return!!(n!=null&&n.length)&&!!(n!=null&&n.find(f=>f==null?void 0:f.is_trade_in))&&!!m.value.find(f=>(f==null?void 0:f.name)==="cash")&&!!j.value.find(f=>(f==null?void 0:f.group)==="pickup"&&!!(f!=null&&f.enabled))}),Ve=N(()=>{var n;return c.value==="pickup"&&((n=U.payment_type)==null?void 0:n.type)==="cash"}),We=N(()=>U.is_trade_in&&!!h.value.length),Ee=async()=>{await _(),await T()},pt=N(()=>{var n;return((n=U.payment_type)==null?void 0:n.main_type)==="installment"}),ge=N(()=>O.value??F.value),et=N(()=>{var f,z;if(!((f=ge==null?void 0:ge.value)!=null&&f.products))return[];let n=ge.value.products.map(Q=>{var be,_e;const ae=((be=Q==null?void 0:Q.name)==null?void 0:be[i.value])??((_e=Q.name)==null?void 0:_e.en)??(Q==null?void 0:Q.name)??"";return{...Q,name:ae}});const p=g.value?n.find(Q=>{var ae;return(Q==null?void 0:Q.sku)===((ae=g.value)==null?void 0:ae.exchange_device_sku)}):[];return(z=h.value)!=null&&z.length&&(n=n.filter(Q=>{var be;return Number((be=h.value.filter(_e=>{var Me;return((Me=_e==null?void 0:_e.exchangeProduct)==null?void 0:Me.sku)===(Q==null?void 0:Q.sku)}))==null?void 0:be.length)<Q.available_quantity?!0:!h.value.find(_e=>(_e==null?void 0:_e.exchange_device_sku)===(Q==null?void 0:Q.sku))})),g.value&&p.length&&n.unshift(p),n.filter(Q=>!!(Q!=null&&Q.is_trade_in))}),Ft=N(()=>{var n,p,f;return((n=l.value)==null?void 0:n.name)??((f=(p=ge.value)==null?void 0:p.user)==null?void 0:f.name)}),qt=N(()=>{var n,p,f;return((n=l.value)==null?void 0:n.email)??((f=(p=ge.value)==null?void 0:p.user)==null?void 0:f.email)}),Et=N(()=>{var n,p,f;return((n=l.value)==null?void 0:n.phone)??((f=(p=ge.value)==null?void 0:p.user)==null?void 0:f.phone)}),Mt=N(()=>{var n,p,f;return((n=l.value)==null?void 0:n.lastname)??((f=(p=ge.value)==null?void 0:p.user)==null?void 0:f.lastname)}),Un=N(()=>{var n;return(n=j.value.find(p=>{var f;return p.name===((f=U.delivery)==null?void 0:f.type)}))==null?void 0:n.name}),Dn=n=>{U&&(U.is_trade_in=n)},Bn=n=>{O.value=n},Ot=N(()=>{var p;const n=U.comment?U.comment:"";return((p=he.value)==null?void 0:p.getFormattedComment(n))||n}),bt=n=>{j.value=n==null?void 0:n.filter(p=>p==null?void 0:p.enabled)},Ct=n=>{m.value=H(n)},Nt=n=>{Ct(n);const p=m.value.find(f=>f.default&&f.enabled);U.payment_type={type:p==null?void 0:p.name,main_type:p==null?void 0:p.type}},In=async()=>{var p;F.value===null&&await _();const n=(p=F.value)==null?void 0:p.config;bt(n.delivery_types)},xn=()=>{C.value=[]};In();const Pn=(n,p,f,z=!1)=>{x.title=n,x.text=p,x.buttonText=u("service_error_btn_text"),z&&(x.shouldBeAgreed=!0),J.value=!0},Fn=(n=!1,p=null)=>{Pn(u("service_error_title"),u("service_error_text")),n&&t("checkoutError",{message:p})},Lt=n=>{const p={"user.email":u("email_is_not_valid"),"user.phone":u("enter_valid_phone_number")};C.value=[],Object.entries(p).forEach(([f,z])=>{(n[f==="user.phone"?"user":f]||[]).length&&C.value.push({key:f,message:z})})},lt=async(n,p=!0)=>{var ae,be,_e,Me,Ze;C.value=[],p&&P();let f=null,z=null;const Q={email:qt.value,name:Ft.value,lastname:Mt.value,phone:Et.value};z=n!=null&&n.userForm?{user:{...n}}:{...n,user:Q},z.comment=Ot.value;try{f=await vn.updateCheckout(z),n.client_type&&n.client_type==="unregistered"&&(l.value?d({...l.value,...n}):d(n))}catch(Re){console.error(Re);const{data:$e}=Re.response;Lt($e.errors)}finally{p&&K()}if(((ae=f==null?void 0:f.status)==null?void 0:ae.value)==="success"){const Re=(Me=(_e=(be=f==null?void 0:f.data)==null?void 0:be.value)==null?void 0:_e.data)==null?void 0:Me.cart,$e=ha(Re.products);Bn({...Re,products:$e}),Re.delivery&&(U.delivery={address:{...Re.delivery.address},type:Re.delivery.type}),bt(Re.config.delivery_types),Ct(Re.config.payment_types)}return((Ze=f==null?void 0:f.status)==null?void 0:Ze.value)==="success"},kt=w({}),qn=n=>{U.payment_type=n.payment_type,U.selectCredit=n.selectCredit,U.credit=n.credit,kt.value=n.formConfig},$t=st(),En=()=>{var p;const n=(p=q.value)==null?void 0:p.querySelector(".error");ua(n==null?void 0:n.offsetTop)},Mn=()=>{var n;return(n=he.value)==null||n.validateDefaultForm(),$t.value.$reset(),$t.value.$touch(),$t.value.$invalid?(setTimeout(()=>{En()}),!1):!0},On=n=>{var ae,be;const{errors:p,message:f}=((ae=n==null?void 0:n.response)==null?void 0:ae.data)||{},z=((be=n==null?void 0:n.response)==null?void 0:be.status)===422;z&&Lt(p),(z?!C.value.length:!0)&&Fn(!0,f||u("something_went_wrong"))},wt=async()=>{var z,Q,ae,be,_e,Me,Ze,Re,$e,Gt,zt,Wt,Zt,Kt,Jt,Yt,Ht,Xt,en,tn,nn,an,sn,ln,on,rn,un,cn;const n=$();if(!Mn())return;const f=((z=he.value)==null?void 0:z.createSortAdditionalFields())||{};if(!I.value){if(pt.value&&!he.value.validateInstallmentForm()||U.payment_type.main_type==="credit"&&!U.credit)return;P(),W();try{const Oe=k();let ie={payment:{...U.payment_type.type==="credit"?{...U.selectCredit,form:{...kt.value,values:f}}:{...U.payment_type,form:{...kt.value,values:f}}},marks:{is_call_back:typeof(Oe==null?void 0:Oe.isNoCallback)=="boolean"?!Oe.isNoCallback:!0,is_trade_in:!!(U!=null&&U.is_trade_in)},comment:Ot.value,delivery:U.delivery,user:{email:qt.value??(n==null?void 0:n.email),name:Ft.value??(n==null?void 0:n.name),lastname:Mt.value??(n==null?void 0:n.lastname),phone:Et.value??(n==null?void 0:n.phone)},...U.userCart};if((Q=ie==null?void 0:ie.marks)!=null&&Q.is_trade_in&&((ae=h.value)!=null&&ae.length)){const ne={additional_data:{trade_in_sets:h.value.map(Qe=>{const{exchangeProduct:Be,...ve}=Qe;return ve.grade.price=ve.totalPriceWithTopUp-ve.totalPriceTopUp,ve})}};ie={...ie,...ne}}const ot=le.value.takeInfoAboutAddress(),je=le.value.takeInfoAboutRecipient(),rt=le.value.getLocationInfo();if(ie.delivery.address=ot?{...rt,...ot}:{...rt},ie.delivery.recipient=!je||(je==null?void 0:je.id)===null?null:{...je},(be=ie.delivery.type)!=null&&be.includes("pickup")&&(ie.delivery.address.floor=null,ie.delivery.address.street=null,ie.delivery.address.zip_code=null,ie.delivery.address.apartment_number=null,ie.delivery.address.house_number=null),!ie.delivery.type||!ie.delivery.shop_address_id){const ne=le.value.getDeliveryValue();ie.delivery.type=ne.type,ie.delivery.shop_address_id=ne==null?void 0:ne.shop_address_id}await lt(ie,!1);const qe=await vn.submitCheckout(ie),vt=(ne,Qe)=>{let Be=[...ne];const{id:ve,...Ue}=ie.delivery[Qe]||{};return ve?Be=Se(Be,ve):(Be=Be.map(Fe=>({...Fe,is_primary:!1})),Be.push({...Ue,is_primary:!0})),Be};let it=((_e=l.value)==null?void 0:_e.recipients)||[],St=((Me=l.value)==null?void 0:Me.addresses)||[];if(o.value){ie.delivery.recipient&&(it=vt(it,"recipient")),(Ze=ie.delivery.type)!=null&&Ze.includes("pickup")||(St=vt(St,"address"));const ne={name:n==null?void 0:n.name,lastname:n==null?void 0:n.lastname,recipients:it,addresses:St},Qe={name:l.value.name,lastname:l.value.lastname,recipients:((Re=l.value)==null?void 0:Re.recipients)||[],addresses:(($e=l.value)==null?void 0:$e.addresses)||[]},Be={};Object.keys(Qe).forEach(ve=>{const Ue=Qe[ve],Fe=ne[ve],dn=Array.isArray(Ue);(dn&&(Ue.length!==Fe.length||ye(Ue,Fe))||!dn&&Ue!==Fe)&&(Be[ve]=Fe)}),Object.keys(Be).length&&pa.patchProfile(Be).then(ve=>{var Ue,Fe;(Ue=ve==null?void 0:ve.data)!=null&&Ue.data&&d((Fe=ve==null?void 0:ve.data)==null?void 0:Fe.data)}).catch(ve=>{Pe.value=[ve.response.data.message]})}if(S.value=qe.status.value,X.value=((Zt=(Wt=(zt=(Gt=qe==null?void 0:qe.data)==null?void 0:Gt.value)==null?void 0:zt.data)==null?void 0:Wt.payment)==null?void 0:Zt.status)||"",qe.status.value==="success"){const ne=(Jt=(Kt=qe==null?void 0:qe.data)==null?void 0:Kt.value)==null?void 0:Jt.data,Qe=(Xt=(Ht=(Yt=ne==null?void 0:ne.checkout)==null?void 0:Yt.order)==null?void 0:Ht.user)==null?void 0:Xt.crm_id;if(A.value=b(ne==null?void 0:ne.checkout.id,Qe,ne.payment),ia("checkout",ne.checkout),ne.payment&&ne.payment.status==="success"){const Be=new Map(F.value.products.map(Ue=>[Ue.id,Ue])),ve=(en=se.value)==null?void 0:en.map(Ue=>{var Fe;return{...Ue,quantity:((Fe=Be.get(Ue.id))==null?void 0:Fe.ordered_quantity)??1}});t("checkoutGA",ve,{orderId:ne.checkout.order.crm_id,deliveryType:Un.value,paymentType:U.payment_type.type,phone:(an=(nn=(tn=ne==null?void 0:ne.checkout)==null?void 0:tn.order)==null?void 0:nn.user)==null?void 0:an.phone,email:(on=(ln=(sn=ne==null?void 0:ne.checkout)==null?void 0:sn.order)==null?void 0:ln.user)==null?void 0:on.email,name:(cn=(un=(rn=ne==null?void 0:ne.checkout)==null?void 0:rn.order)==null?void 0:un.user)==null?void 0:cn.name}),Ee()}}ie.delivery.type==="international_agreed"&&qe.status.value==="success"&&(te.value=!0,x.title=u("quote_succes_title"),x.text=u("should_be_agreed"),x.buttonText=u("quote_succes_text_btn"),x.redirectUrl="/program-partners",x.actionAfterRedirect=()=>Ee(),x.shouldBeAgreed=!0)}catch(Oe){On(Oe),console.error(Oe)}finally{if(fe(null),pe(null),Ae(null),D(null),re(null),I.value=!1,K(),Y(),S.value==="success"&&U.delivery.type!=="international_agreed"&&X.value!=="error"){const Oe=_t=>{var ie,ot,je;return(je=(ot=(ie=_t==null?void 0:_t.split("?"))==null?void 0:ie[1])==null?void 0:ot.split("&"))==null?void 0:je.reduce((rt,qe)=>{const[vt,it]=qe.split("=");return rt[vt]=it,rt},{})};L.push(y.$localeRoute({path:A.value,query:Oe(A.value)}))}S.value==="success"&&X.value==="error"&&(te.value=!0,x.title=u("payment_service_error_title"),x.text=u("payment_service_error_text"),x.buttonText=u("payment_service_error_btn"),x.redirectUrl="",x.actionAfterRedirect=null,x.shouldBeAgreed=!1)}}},Tt=async(n,p=!1)=>{var f,z,Q;if(n)try{let ae={...n};ae.delivery.type.indexOf("pickup")!==-1&&(ae.delivery.address.street=null,ae.delivery.address.apartment_number=null,ae.delivery.address.house_number=null,ae.delivery.address.zip_code=null);const be=await lt({...ae,...U.userCart,payment_type:null,comment:U.comment});U.payment_type===null&&Nt((f=ge.value)==null?void 0:f.config.payment_types),be&&!p&&((z=n==null?void 0:n.delivery)==null?void 0:z.type)==="international_agreed"&&(Nt((Q=ge.value)==null?void 0:Q.config.payment_types),wt(),te.value=!0,x.title=u("quote_succes_title"),x.text=u("should_be_agreed"),x.buttonText=u("quote_succes_text_btn"),x.redirectUrl="/program-partners",x.actionAfterRedirect=null,x.shouldBeAgreed=!0)}catch(ae){console.error(ae)}},Nn=async n=>{Tt(n,!0)};we(F,(n,p)=>{var f,z,Q,ae,be,_e;(n==null?void 0:n.products.length)===0&&L.push(y.$localeRoute({path:"/cart"})),(n==null?void 0:n.products.toString())!==(p==null?void 0:p.products.toString())&&T(),(z=(f=F==null?void 0:F.value)==null?void 0:f.config)!=null&&z.delivery_types&&!((Q=j.value)!=null&&Q.length)&&bt([...F.value.config.delivery_types||[]]),(be=(ae=F==null?void 0:F.value)==null?void 0:ae.config)!=null&&be.payment_types&&!((_e=m.value)!=null&&_e.length)&&Ct([...F.value.config.payment_types||[]])},{immediate:!0,deep:!0}),kn(async()=>{var p,f;const n=z=>JSON.stringify(z);try{de(),F.value||await Ee(),(p=se.value)!=null&&p.length||await T(),Z.value&&n(Z.value)!==n(U)&&Object.keys(Z.value).forEach(z=>{Object.keys(U).find(Q=>Q===z)&&n(Z.value[z])!==n(U[z])&&(U[z]=Z.value[z])}),F.value&&(a.value=(f=F.value.payment)==null?void 0:f.currency)}catch(z){console.error(z)}finally{G()}});{const n=k();U.comment=(n==null?void 0:n.comment)??null,U.is_call_back=(n==null?void 0:n.isNoCallback)??!1,U.is_trade_in=localStorage.getItem("showCheckoutTradeIn")==="true"}if([B,s]=_n(()=>Ee()),await B,s(),[B,s]=_n(()=>aa()),await B,s(),(jt=se.value)!=null&&jt.length){const n=new Map((Qt=ge==null?void 0:ge.value)==null?void 0:Qt.products.map(f=>[f.crm_id,f])),p=se.value.map(f=>{const z=n.get(f.crm_id);return{...f,quantity:z==null?void 0:z.available_quantity}});t("loadCheckoutPageGA",p)}return ct("isTradeInProductSelected",We),(n,p)=>{const f=Ln,z=jn,Q=Va,ae=Qn,be=Ua,_e=Ba,Me=la,Ze=Gn,Re=Fa;return V(),ee(Le,null,[e(M)?(V(),ce(f,{key:0})):(V(),ee("div",Ms,[E("div",Os,[R(z,{order:e(ge),"is-order-summary-top":!0,"is-open-content":!1,"show-header":!0,"is-trade-in":e(U).is_trade_in},null,8,["order","is-trade-in"])]),E("div",Ns,[E("div",{ref_key:"checkoutContainer",ref:q,class:"checkout-view_main"},[E("div",Ls,[R(Ta,{ref_key:"authRef",ref:De,onUpdateForm:lt},null,512),R(qa,{modelValue:e(U).comment,"onUpdate:modelValue":p[0]||(p[0]=$e=>e(U).comment=$e),class:"checkout-view_comment"},null,8,["modelValue"]),e(o)&&e(Pe).length?(V(),ce(va,{key:0,errors:e(Pe)},null,8,["errors"])):Ce("",!0),e(ke)?(V(),ce(Q,{key:1,disabled:!e(Ve),"exchange-items":e(et),currency:e(a),onChangeProduct:p[1]||(p[1]=$e=>g.value=$e),onChange:Dn},null,8,["disabled","exchange-items","currency"])):Ce("",!0),!e(v)&&e(ge)?(V(),ce(qs,{key:2,ref_key:"deliveryRef",ref:le,deliveries:e(j),disabled:e(me),"data-user-errors":e(C),"current-cart":e(ge),onChangeDeliveryPrice:Nn,onResetUserDataError:xn,onUpdateForm:lt,onChangeCategory:p[2]||(p[2]=$e=>c.value=$e),onUpdateDeliveryData:p[3]||(p[3]=$e=>Tt($e,!1))},null,8,["deliveries","disabled","data-user-errors","current-cart"])):Ce("",!0),R(ae,{ref_key:"paymentRef",ref:he,currency:e(a),"current-cart":e(ge),loading:e(me),"payment-config":e(m),onUpdate:lt,onUpdateState:qn},null,8,["currency","current-cart","loading","payment-config"]),R(be,{value:e(U).is_call_back,name:"checkout-callback",disabled:e(me),onUpdateCallback:p[4]||(p[4]=$e=>e(U).is_call_back=$e)},null,8,["value","disabled"]),R(_e,{disabled:e(me),loading:e(I),"show-on-mobile":!1,onSubmit:p[5]||(p[5]=$e=>wt())},null,8,["disabled","loading"])])],512),E("div",Ts,[E("div",js,[R(z,{order:e(ge),"show-header":!0,"is-trade-in":e(U).is_trade_in},null,8,["order","is-trade-in"])]),R(_e,{disabled:e(me),loading:e(I),"show-on-mobile":!0,onSubmit:p[6]||(p[6]=$e=>wt())},null,8,["disabled","loading"])])]),R(Me)])),R(Ze,{"is-modal-opened":e(J),"button-text":e(x).buttonText,text:e(x).text,title:e(x).title,onClose:p[7]||(p[7]=$e=>J.value=!1)},null,8,["is-modal-opened","button-text","text","title"]),R(Re,{opened:e(te),title:e(x).title,text:e(x).text,"button-text":e(x).buttonText,"redirect-url":e(x).redirectUrl,onActionAfterRedirect:e(x).actionAfterRedirect,onClose:p[8]||(p[8]=$e=>te.value=!1)},null,8,["opened","title","text","button-text","redirect-url","onActionAfterRedirect"])],64)}}},Gs=xe(Qs,[["__scopeId","data-v-393ce1ff"]]),xl={__name:"index",setup(r){const{saveLocale:B,getLocale:s}=Te(),t=s(),{pushGtmEvent:l}=dt(),{locale:d}=nt();return at(()=>{d.value!==t&&B(d.value),l("pageview")}),(o,y)=>{const u=Gs;return V(),ce(u)}}};export{xl as default};
